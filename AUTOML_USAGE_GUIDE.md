# AutoML 예측 사용 가이드

## 🎯 예측 방식

### 데이터 사용 전략
AutoML 예측은 **고객사 전체 굴뚝의 데이터를 통합하여 학습**합니다.

#### 왜 이렇게 하나요?
- ✅ **데이터 충분성**: 특정 굴뚝만 사용하면 데이터가 1-2개로 부족할 수 있음
- ✅ **예측 정확도**: 더 많은 데이터로 학습하면 더 정확한 예측 가능
- ✅ **패턴 학습**: 같은 고객사의 여러 굴뚝 데이터에서 공통 패턴 추출

#### 예시
```
고려아연 - 먼지(EA-I-0001) 예측 시:
  
  ❌ 특정 굴뚝만 사용:
     #A2020007: 2개 데이터 → 예측 불가 (최소 10개 필요)
  
  ✅ 전체 굴뚝 통합:
     #A2020007: 2개
     #A2020009: 15개
     #A2020010: 48개
     #A2020011: 32개
     ... (기타 굴뚝)
     ────────────────
     합계: 173개 → 예측 성공! ✅
```

---

## 📱 사용 방법

### 1. 대시보드 접속
http://localhost:3000/dashboard

### 2. 필터 설정
- **고객사**: 선택 (필수)
- **굴뚝**: 선택 안 해도 됨 (차트 표시용)
- **항목**: 선택 (필수)
- **기간**: 선택 (차트 표시용)

### 3. AutoML 예측 실행
1. **🤖 AutoML 예측** 버튼 클릭
2. 10-30초 대기 (학습 중)
3. 예측 완료 알림 확인
   ```
   ✅ AutoML 예측 완료!
   
   모델: Prophet AutoML
   학습 데이터: 173건 (고객사 전체 굴뚝)
   RMSE: 5.34
   R²: 0.181
   
   ※ 정확한 예측을 위해 해당 고객사의 
      모든 굴뚝 데이터를 사용했습니다.
   ```

### 4. 예측 결과 확인
- **AI 예측** 체크박스 자동 활성화
- 체크박스 클릭하여 녹색 예측선 표시
- 신뢰구간 (연한 녹색 영역) 확인

---

## 🔍 예측 결과 해석

### 차트 요소
```
━━━━━━━━━━━━━━━━━━━  파란색 실선: 실제 측정값
              ╌╌╌╌╌╌╌╌╌╌╌  녹색 점선: AI 예측값
              ▒▒▒▒▒▒▒▒▒▒▒  연한 녹색: 신뢰구간
```

### 신뢰구간 의미
- **예측값**: 가장 가능성 높은 값
- **상한**: 예측값이 이보다 높을 확률 5%
- **하한**: 예측값이 이보다 낮을 확률 5%
- **신뢰구간**: 90% 확률로 실제값이 이 범위 안에 있음

### 예시
```
날짜: 2025-09-25
예측값: 2.45
상한: 9.84
하한: -4.79

해석: 
90% 확률로 실제 측정값이 -4.79 ~ 9.84 범위에 있을 것으로 예상됨
가장 가능성 높은 값은 2.45
```

---

## ⚠️ 주의사항

### 최소 데이터 요구사항
- **필요**: 최소 10개 이상의 측정 데이터
- **권장**: 50개 이상 (더 정확한 예측)

### 데이터 부족 시
```
❌ 예측 실패

학습 데이터가 부족합니다. (최소 10개 필요, 현재 3개)

해당 고객사/항목의 측정 데이터가 부족할 수 있습니다.
```

**해결 방법**:
1. 다른 고객사 선택 (데이터가 더 많은)
2. 다른 측정항목 선택
3. 측정 데이터 추가 입력

---

## 📊 정확도 지표 설명

### RMSE (Root Mean Square Error)
- **의미**: 예측 오차의 평균 크기
- **단위**: 측정값과 동일 (예: mg/S㎥)
- **해석**: 낮을수록 좋음
- **예시**: RMSE 5.34 → 평균적으로 ±5.34 정도 오차

### MAE (Mean Absolute Error)
- **의미**: 절대 오차의 평균
- **단위**: 측정값과 동일
- **해석**: 낮을수록 좋음
- **예시**: MAE 3.63 → 평균적으로 3.63 정도 차이

### R² (결정계수)
- **의미**: 모델이 데이터를 얼마나 잘 설명하는지
- **범위**: -∞ ~ 1
- **해석**: 
  - 1에 가까울수록 완벽한 예측
  - 0: 평균값 예측과 동일
  - 음수: 평균값보다 나쁨
- **예시**: R² 0.181 → 데이터 변동의 18.1% 설명

---

## 🎓 AutoML 기술 설명

### 자동화된 기능
1. **하이퍼파라미터 튜닝** (Optuna)
   - 20가지 조합 자동 시도
   - 최적 파라미터 자동 선택

2. **계절성 탐지** (Prophet)
   - 연간 패턴 자동 감지
   - 주간 패턴 자동 감지

3. **트렌드 분석**
   - 변화점 자동 탐지
   - 장기 추세 학습

4. **외부 변수 학습**
   - 기온, 습도, 풍속 자동 반영
   - 상관관계 자동 학습

### 학습 과정
```
1. 데이터 수집 (고객사 전체 굴뚝)
   ↓
2. 전처리 (결측치, 이상치 처리)
   ↓
3. AutoML 튜닝 (20회 시도)
   ↓
4. 최적 모델 선택
   ↓
5. 전체 데이터로 재학습
   ↓
6. 30일 예측 생성
```

---

## 💡 활용 팁

### 1. 여러 항목 비교
- 먼지, 황산화물, 질소산화물 등 각각 예측
- 어떤 항목이 기준 초과 위험이 높은지 파악

### 2. 고객사별 비교
- 여러 고객사의 같은 항목 예측
- 고객사별 관리 우선순위 결정

### 3. 계절성 파악
- 예측 그래프에서 반복 패턴 확인
- 특정 시기에 농도가 높아지는지 분석

### 4. 신뢰구간 활용
- 신뢰구간이 넓으면 불확실성 높음
- 신뢰구간이 좁으면 안정적인 예측

---

## 🔧 문제 해결

### Q: "학습 데이터가 부족합니다" 에러
**A**: 해당 고객사/항목의 측정 데이터가 10개 미만입니다.
- 다른 고객사 선택
- 다른 측정항목 선택
- 측정 데이터 추가 입력

### Q: 예측값이 음수로 나옴
**A**: 정상입니다. 신뢰구간 하한이 음수일 수 있습니다.
- 실제 측정값은 0 이상이지만
- 통계적 신뢰구간은 음수 포함 가능
- 예측값(중간값)이 양수면 문제없음

### Q: 예측이 너무 오래 걸림
**A**: 데이터가 많거나 서버 성능에 따라 30초 이상 걸릴 수 있습니다.
- 정상: 10-30초
- 느림: 30-60초 (데이터 많음)
- 1분 이상: 서버 확인 필요

### Q: 예측선이 차트에 안 보임
**A**: 
1. **AI 예측** 체크박스 클릭했는지 확인
2. 차트 Y축 범위 확인 (예측값이 범위 밖일 수 있음)
3. 브라우저 새로고침

---

## 📞 추가 정보

### API 문서
http://localhost:8000/docs

### 헬스 체크
http://localhost:8000/health

### 로그 확인
백엔드 터미널에서 실시간 로그 확인 가능

---

**작성일**: 2025-10-28
**버전**: 1.0.0
