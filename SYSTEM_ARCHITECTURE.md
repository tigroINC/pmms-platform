# 시스템 아키텍처

## 개요
티그로(Tigro)가 소유한 대기오염물질 측정 관리 플랫폼으로, 여러 측정 대행 업체(공급회사)가 사용하는 멀티테넌트 SaaS 시스템입니다.

## 사용자 계층 구조

### 1. 티그로 (시스템 소유 회사)
플랫폼을 소유하고 운영하는 회사

#### SUPER_ADMIN (시스템 관리자)
- **역할**: 플랫폼 전체 관리자
- **권한**:
  - 공급회사(Organization) 계정 생성 및 승인
  - 모든 공급회사 데이터 조회 및 관리
  - 구독 플랜 관리
  - 청구서 발행 및 결제 관리
  - 시스템 설정 및 모니터링
- **접근 범위**: 전체 시스템

---

### 2. 공급회사 (Organization)
측정 대행 업체 (예: 보아스환경기술, ABC환경, XYZ측정 등)

#### ORG_ADMIN (공급회사 관리자)
- **역할**: 공급회사의 관리자
- **권한**:
  - 자사 직원(OPERATOR) 관리
  - 고객사(Customer) 등록 및 관리
  - 측정 데이터 전체 조회 및 관리
  - 배출허용기준 설정
  - 측정항목 관리
  - 굴뚝 관리
- **접근 범위**: 자사 데이터만

#### OPERATOR (공급회사 실무자)
- **역할**: 측정 담당자
- **권한**:
  - 측정 데이터 입력
  - 측정 이력 조회
  - 담당 고객사 데이터만 접근
- **접근 범위**: 담당 고객사 데이터만

---

### 3. 고객사 (Customer)
측정 서비스를 받는 업체 (예: 고려아연, 포스코 등)

#### CUSTOMER_ADMIN (고객사 관리자)
- **역할**: 고객사의 관리자
- **권한**:
  - 자사 측정 데이터 조회
  - 자사 직원 관리
  - 대시보드 및 리포트 조회
- **접근 범위**: 자사 데이터만

#### CUSTOMER_USER (고객사 일반 사용자)
- **역할**: 고객사의 일반 직원
- **권한**:
  - 자사 측정 데이터 조회만
  - 대시보드 조회
- **접근 범위**: 자사 데이터만 (읽기 전용)

---

## 데이터 격리 (Multi-tenancy)

### Organization 레벨 격리
- 각 공급회사는 독립된 Organization으로 관리
- 공급회사는 자신의 고객사와 데이터만 접근 가능
- SUPER_ADMIN만 모든 Organization 데이터 접근 가능

### Customer 레벨 격리
- 각 고객사는 자신의 데이터만 접근 가능
- 공급회사는 자신이 관리하는 고객사 데이터만 접근

---

## 회원가입 및 승인 프로세스

### 공급회사 등록
1. 공급회사가 회원가입 신청 (회사명, 사업자등록번호 등)
2. SUPER_ADMIN이 승인/거부
3. 승인 시 Organization 생성 및 ORG_ADMIN 계정 활성화
4. 공급회사 CI(로고, 회사명)가 시스템에 표시됨

### 공급회사 직원 등록
1. ORG_ADMIN이 직원(OPERATOR) 계정 생성
2. 즉시 활성화 (별도 승인 불필요)

### 고객사 사용자 등록
1. 고객사 사용자가 회원가입 신청
2. 해당 공급회사의 ORG_ADMIN이 승인/거부
3. 승인 시 계정 활성화

---

## 구독 및 결제

### 구독 대상
- 공급회사(Organization) 단위로 구독

### 구독 플랜
- FREE: 무료 체험 (제한적 기능)
- BASIC: 기본 (고객사 10개, 사용자 5명)
- STANDARD: 표준 (고객사 30개, 사용자 15명)
- PREMIUM: 프리미엄 (고객사 100개, 사용자 50명)
- ENTERPRISE: 엔터프라이즈 (무제한)

### 결제 관리
- SUPER_ADMIN이 청구서 발행
- 공급회사별 월별/연간 결제
- 사용량 기반 과금 가능

---

## 메뉴 접근 권한

| 메뉴 | SUPER_ADMIN | ORG_ADMIN | OPERATOR | CUSTOMER_ADMIN | CUSTOMER_USER |
|------|-------------|-----------|----------|----------------|---------------|
| 대시보드 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 측정입력 | ✓ | ✓ | ✓ | ✗ | ✗ |
| 측정이력 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 고객사 관리 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 굴뚝 관리 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 측정항목 관리 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 배출허용기준 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 사용자 관리 | ✓ | ✓ (자사만) | ✗ | ✓ (자사만) | ✗ |
| 공급회사 관리 | ✓ | ✗ | ✗ | ✗ | ✗ |
| 구독 관리 | ✓ | ✗ | ✗ | ✗ | ✗ |

---

## 브랜딩

### 공급회사별 브랜딩
- 각 공급회사는 자체 로고와 회사명 설정 가능
- 로그인 시 소속 공급회사의 CI 표시
- 고객사 사용자에게는 해당 공급회사의 브랜딩 표시

### 시스템 브랜딩
- SUPER_ADMIN에게는 "티그로" 브랜딩 표시
- 공급회사 관리 페이지에서는 티그로 브랜딩

---

## 예시 시나리오

### 시나리오 1: 보아스환경기술 등록
1. 보아스환경기술이 공급회사로 회원가입
2. 티그로 SUPER_ADMIN이 승인
3. 보아스환경기술 Organization 생성
4. 보아스환경기술 ORG_ADMIN 계정 활성화
5. 시스템에 "보아스환경기술" CI 표시

### 시나리오 2: 고려아연 측정 서비스
1. 보아스환경기술 ORG_ADMIN이 고려아연을 고객사로 등록
2. 보아스환경기술 OPERATOR가 고려아연 측정 데이터 입력
3. 고려아연 직원이 회원가입 신청
4. 보아스환경기술 ORG_ADMIN이 승인
5. 고려아연 사용자가 자사 데이터 조회

### 시나리오 3: 데이터 격리
- 보아스환경기술은 자사 고객사(고려아연, 포스코 등) 데이터만 조회
- ABC환경은 자사 고객사 데이터만 조회
- 티그로 SUPER_ADMIN은 모든 공급회사 데이터 조회 가능
