# 전체 시스템 테스트 가이드

데이터베이스가 초기화되었습니다. 처음부터 끝까지 전체 플로우를 테스트할 수 있습니다.

## 초기 상태

✅ **시스템 관리자 계정만 존재**
- 이메일: `tigrofin@gmail.com`
- 비밀번호: `tigrofin1018*`
- 역할: SUPER_ADMIN

✅ **측정항목(Item) 데이터: 45개 유지** (필수 마스터 데이터)

---

## 테스트 시나리오

### Phase 1: 환경측정기업 회원가입 및 승인

#### 1-1. 환경측정기업 회원가입
1. 로그인 페이지 → "회원가입" 클릭
2. **Step 1**: "환경측정업체 🏢" 선택
3. **Step 2**: "회사 신규 등록" 클릭
4. 회사 정보 입력:
   ```
   법인명: 보아스환경기술
   사업자등록번호: 123-45-67890
   대표자명: 김대표
   전화번호: 02-1234-5678
   이메일: info@boaz.com
   주소: 서울시 강남구 테헤란로 123
   ```
5. 관리자 정보 입력:
   ```
   이메일: admin@boaz.com
   비밀번호: boaz1234!
   이름: 김관리
   전화번호: 010-1234-5678
   부서: 관리팀
   직책: 팀장
   ```
6. "등록 신청" → 확인 모달 → "확인"
7. **승인 대기 화면 표시 확인** ✅

#### 1-2. 시스템 관리자 승인
1. `tigrofin@gmail.com`으로 로그인
2. 관리자 대시보드 → "공급회사 관리" 클릭
3. "보아스환경기술" 찾기 → "승인" 버튼 클릭
4. 승인 완료 확인 ✅

#### 1-3. 환경측정기업 로그인
1. 로그아웃
2. `admin@boaz.com` / `boaz1234!`로 로그인
3. 대시보드 접근 확인 ✅

---

### Phase 2: 고객사 일괄업로드

#### 2-1. CSV 파일 준비
다음 내용으로 `customers.csv` 파일 생성:

```csv
고객사코드,고객사명(약칭),고객사명(정식),사업장구분,주소,업종,사업장종별
CUST001,고려아연,고려아연㈜온산제련소,-,울산광역시 울주군 온산읍 이진로 139,연 및 아연 제련 정련 및 합금 제조업,1종
CUST002,삼양사1공장,㈜삼양사 울산1공장,-,울산광역시 남구 장생포로 285,설탕 이온교환수지 합성수지 제조업,1종
CUST003,삼양사2공장,㈜삼양사 울산2공장,-,울산광역시 남구 매압로 115,전분 및 당류 제조업,1종
```

#### 2-2. 일괄업로드 실행
1. 환경측정기업 계정(`admin@boaz.com`)으로 로그인
2. 좌측 메뉴 → "고객사 관리" 클릭
3. "일괄업로드" 버튼 클릭
4. CSV 파일 선택 → "업로드" 클릭
5. **성공 메시지 확인**: "3건 등록 완료" ✅

#### 2-3. 고객사 목록 확인
1. "📋 내부" 탭 클릭 → 3개 고객사 표시 확인 ✅
2. "📊 전체" 탭 클릭 → 3개 고객사 표시 확인 ✅
3. "🤝 연결" 탭 클릭 → 0개 (아직 연결 안 됨) ✅

---

### Phase 3: 고객사 초대 및 회원가입

#### 3-1. 초대 링크 생성
1. "📋 내부" 탭에서 "고려아연" 찾기
2. "초대 링크" 버튼 클릭
3. 초대 정보 입력:
   ```
   담당자 이름: 박고객
   담당자 이메일: admin@koreazinc.com
   담당자 전화번호: 010-2345-6789
   메모: 환경안전팀 과장
   ```
4. "초대 링크 생성" 클릭
5. **초대 링크 복사** (예: `http://localhost:3000/register/invite/abc123...`)

#### 3-2. 고객사 회원가입 (초대 링크 사용)
1. 새 시크릿 창 열기
2. 초대 링크 붙여넣기
3. 초대 정보 확인 화면:
   ```
   회사: 고려아연
   초대자: 보아스환경기술
   ```
4. 사용자 정보 입력:
   ```
   이메일: admin@koreazinc.com (자동 입력됨)
   비밀번호: customer1234!
   이름: 박고객 (자동 입력됨)
   전화번호: 010-2345-6789 (자동 입력됨)
   부서: 환경안전팀
   직책: 과장
   ```
5. "가입하기" 클릭
6. **자동 로그인 및 대시보드 접근 확인** ✅

#### 3-3. 연결 상태 확인
1. 환경측정기업 계정으로 돌아가기
2. "🤝 연결" 탭 클릭 → "고려아연" 표시 확인 ✅
3. 상태: APPROVED ✅

---

### Phase 4: 굴뚝 일괄업로드

#### 4-1. CSV 파일 준비
다음 내용으로 `stacks.csv` 파일 생성:

```csv
고객사코드,굴뚝번호,굴뚝코드,굴뚝명칭,시설종류,위치,높이(m),직경(m),좌표,설명
CUST001,S001,STACK-001,1호 배출구,제련로,제련동 1층,25.5,1.2,"37.123,129.456",주 배출구
CUST001,S002,STACK-002,2호 배출구,정련로,정련동 2층,30.0,1.5,"37.124,129.457",부 배출구
CUST002,S001,STACK-001,보일러 배출구,보일러,보일러실,20.0,1.0,"37.125,129.458",증기 보일러
```

#### 4-2. 일괄업로드 실행
1. 환경측정기업 계정(`admin@boaz.com`)으로 로그인
2. 좌측 메뉴 → "굴뚝 관리" 클릭
3. "일괄업로드" 버튼 클릭
4. CSV 파일 선택 → "업로드" 클릭
5. **성공 메시지 확인**: "3건 등록 완료" ✅

#### 4-3. 굴뚝 목록 확인
1. 고객사 필터에서 "고려아연" 선택
2. 2개 굴뚝 표시 확인 ✅
3. 고객사 필터에서 "삼양사1공장" 선택
4. 1개 굴뚝 표시 확인 ✅

---

### Phase 5: 측정 데이터 일괄업로드

#### 5-1. CSV 파일 준비
다음 내용으로 `measurements.csv` 파일 생성:

```csv
고객사코드,굴뚝번호,측정일시,항목코드,측정값,기온,습도,풍속,가스온도,산소농도
CUST001,S001,2024-11-01 10:00,EA-I-0001,15.5,20.5,65.0,2.3,150.0,12.5
CUST001,S001,2024-11-01 11:00,EA-I-0001,16.2,21.0,63.0,2.5,152.0,12.3
CUST001,S002,2024-11-01 10:00,EA-I-0001,14.8,20.5,65.0,2.3,148.0,12.7
```

#### 5-2. 일괄업로드 실행
1. 환경측정기업 계정(`admin@boaz.com`)으로 로그인
2. 좌측 메뉴 → "측정 이력" 클릭
3. "일괄업로드" 버튼 클릭
4. CSV 파일 선택 → "업로드" 클릭
5. **성공 메시지 확인**: "3건 등록 완료" ✅

#### 5-3. 측정 데이터 확인
1. 고객사 필터에서 "고려아연" 선택
2. 3건의 측정 데이터 표시 확인 ✅
3. 대시보드로 이동 → 차트에 데이터 표시 확인 ✅

---

### Phase 6: 고객사 사용자 데이터 조회

#### 6-1. 고객사 로그인
1. 로그아웃
2. `admin@koreazinc.com` / `customer1234!`로 로그인
3. 대시보드 접근 확인 ✅

#### 6-2. 데이터 확인
1. 대시보드 → 자사 데이터만 표시 확인 ✅
2. "측정 이력" 메뉴 → 자사 측정 데이터만 표시 확인 ✅
3. "굴뚝 관리" 메뉴 → 자사 굴뚝만 표시 확인 ✅

---

## 체크리스트

### 회원가입 및 승인
- [ ] 환경측정기업 회원가입 (승인 대기)
- [ ] 시스템 관리자 승인
- [ ] 환경측정기업 로그인

### 데이터 업로드
- [ ] 고객사 일괄업로드 (3건)
- [ ] 고객사 목록 확인 (내부 탭)
- [ ] 초대 링크 생성
- [ ] 고객사 회원가입 (초대 링크)
- [ ] 연결 상태 확인 (APPROVED)
- [ ] 굴뚝 일괄업로드 (3건)
- [ ] 굴뚝 목록 확인
- [ ] 측정 데이터 일괄업로드 (3건)
- [ ] 측정 데이터 확인

### 권한 및 격리
- [ ] 고객사 사용자 로그인
- [ ] 자사 데이터만 조회 확인
- [ ] 타사 데이터 접근 불가 확인

---

## 문제 발생 시

### 데이터 재초기화
```bash
cd frontend
npx tsx scripts/reset-database.ts
```

### 로그 확인
- 브라우저 개발자 도구 → Console 탭
- 터미널 → 개발 서버 로그

### 일반적인 문제
1. **"조직 정보를 불러올 수 없습니다"** → 로그아웃 후 재로그인
2. **일괄업로드 실패** → CSV 파일 인코딩 확인 (UTF-8)
3. **데이터 안 보임** → 브라우저 새로고침 (Ctrl + F5)

---

## 성공 기준

✅ 모든 회원가입 및 승인 프로세스 정상 작동
✅ 고객사/굴뚝/측정 데이터 일괄업로드 성공
✅ 초대 링크를 통한 고객사 회원가입 성공
✅ 데이터 격리 (조직별, 고객사별) 정상 작동
✅ 권한 체크 정상 작동
