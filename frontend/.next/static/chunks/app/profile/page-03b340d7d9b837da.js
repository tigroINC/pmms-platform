(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4178],{9734:function(e,t,s){Promise.resolve().then(s.bind(s,1380))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},1380:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(7437),r=s(2265),n=s(605),d=s(9376),l=s(2827),i=s(6334);function c(){let{data:e,status:t}=(0,n.useSession)(),s=(0,d.useRouter)(),[c,o]=(0,r.useState)(null),[x,m]=(0,r.useState)(!0),[u,h]=(0,r.useState)(!1),[g,p]=(0,r.useState)({name:"",phone:"",department:"",position:""}),[y,b]=(0,r.useState)(""),[w,j]=(0,r.useState)(""),[f,N]=(0,r.useState)(!1),[v,k]=(0,r.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[P,C]=(0,r.useState)(""),[D,S]=(0,r.useState)("");(0,r.useEffect)(()=>{"unauthenticated"===t?s.push("/login"):"authenticated"===t&&Z()},[t,s]);let Z=async()=>{try{var t;m(!0);let s=null==e?void 0:null===(t=e.user)||void 0===t?void 0:t.id,a=await fetch("/api/users/".concat(s)),r=await a.json();a.ok?(o(r.user),p({name:r.user.name,phone:r.user.phone||"",department:r.user.department||"",position:r.user.position||""})):b(r.error||"프로필을 불러오는데 실패했습니다.")}catch(e){b("프로필을 불러오는데 실패했습니다.")}finally{m(!1)}},E=e=>{let{name:t,value:s}=e.target;p(e=>({...e,[t]:s}))},A=async t=>{t.preventDefault(),b(""),j("");try{var s;let t=null==e?void 0:null===(s=e.user)||void 0===s?void 0:s.id,a=await fetch("/api/users/".concat(t),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}),r=await a.json();a.ok?(j("프로필이 수정되었습니다."),h(!1),Z()):b(r.error||"프로필 수정에 실패했습니다.")}catch(e){b("프로필 수정 중 오류가 발생했습니다.")}},R=e=>({SUPER_ADMIN:"시스템 관리자 (티그로)",ORG_ADMIN:"환경측정기업 관리자",OPERATOR:"환경측정기업 임직원",CUSTOMER_ADMIN:"고객사 관리자",CUSTOMER_USER:"고객사 사용자"})[e]||e,O=e=>({PENDING:"승인 대기",APPROVED:"승인됨",REJECTED:"거부됨",SUSPENDED:"정지됨",WITHDRAWN:"탈퇴"})[e]||e,_=e=>{let{name:t,value:s}=e.target;k(e=>({...e,[t]:s}))},T=async e=>{if(e.preventDefault(),C(""),S(""),v.newPassword!==v.confirmPassword){C("새 비밀번호가 일치하지 않습니다.");return}if(v.newPassword.length<8){C("비밀번호는 최소 8자 이상이어야 합니다.");return}try{let e=await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:v.currentPassword,newPassword:v.newPassword})}),t=await e.json();e.ok?(S("비밀번호가 변경되었습니다."),N(!1),k({currentPassword:"",newPassword:"",confirmPassword:""})):C(t.error||"비밀번호 변경에 실패했습니다.")}catch(e){C("비밀번호 변경 중 오류가 발생했습니다.")}};return"loading"===t||x?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"text-lg",children:"로딩 중..."})}):c?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto p-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"내 정보"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"개인 정보를 확인하고 수정할 수 있습니다."})]}),y&&(0,a.jsx)("div",{className:"mb-4 rounded-md bg-red-50 dark:bg-red-900/20 p-4",children:(0,a.jsx)("div",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:y})}),w&&(0,a.jsx)("div",{className:"mb-4 rounded-md bg-green-50 dark:bg-green-900/20 p-4",children:(0,a.jsx)("div",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:w})}),(0,a.jsxs)("div",{className:"hidden md:block bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden mb-6",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"계정 정보"}),!u&&(0,a.jsx)(i.Z,{onClick:()=>h(!0),className:"px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"정보 수정"})]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"이메일"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"이름"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"전화번호"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"역할"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"부서/직책"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"상태"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"가입일"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"마지막 로그인"})]})}),(0,a.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:c.email}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:u?(0,a.jsx)(l.Z,{name:"name",type:"text",value:g.name,onChange:E,className:"w-full min-w-[100px]"}):c.name}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:u?(0,a.jsx)(l.Z,{name:"phone",type:"tel",value:g.phone,onChange:E,className:"w-full min-w-[120px]"}):c.phone||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:R(c.role)})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:u?(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(l.Z,{name:"department",type:"text",value:g.department,onChange:E,placeholder:"부서",className:"w-full min-w-[100px]"}),(0,a.jsx)(l.Z,{name:"position",type:"text",value:g.position,onChange:E,placeholder:"직책",className:"w-full min-w-[100px]"})]}):(0,a.jsxs)("div",{children:[c.department||"-",c.position&&" / ".concat(c.position)]})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:O(c.status)})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(c.createdAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:c.lastLoginAt?new Date(c.lastLoginAt).toLocaleString():"없음"})]})})]})}),u&&(0,a.jsx)("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.Z,{onClick:A,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"저장"}),(0,a.jsx)(i.Z,{onClick:()=>{h(!1),p({name:c.name,phone:c.phone||"",department:c.department||"",position:c.position||""})},className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-md",children:"취소"})]})})]}),(0,a.jsx)("div",{className:"md:hidden space-y-3 mb-6",children:(0,a.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"계정 정보"}),!u&&(0,a.jsx)(i.Z,{onClick:()=>h(!0),className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"수정"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCE7 이메일:"})," ",c.email]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDC64 이름:"}),u?(0,a.jsx)(l.Z,{name:"name",type:"text",value:g.name,onChange:E,className:"w-full mt-1"}):" ".concat(c.name)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCF1 전화번호:"}),u?(0,a.jsx)(l.Z,{name:"phone",type:"tel",value:g.phone,onChange:E,className:"w-full mt-1"}):" ".concat(c.phone||"-")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFAD 역할:"}),(0,a.jsx)("span",{className:"ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:R(c.role)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFE2 부서:"}),u?(0,a.jsx)(l.Z,{name:"department",type:"text",value:g.department,onChange:E,className:"w-full mt-1"}):" ".concat(c.department||"-")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCBC 직책:"}),u?(0,a.jsx)(l.Z,{name:"position",type:"text",value:g.position,onChange:E,className:"w-full mt-1"}):" ".concat(c.position||"-")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"✅ 상태:"}),(0,a.jsx)("span",{className:"ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:O(c.status)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCC5 가입일:"})," ",new Date(c.createdAt).toLocaleDateString()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDD50 마지막 로그인:"})," ",c.lastLoginAt?new Date(c.lastLoginAt).toLocaleString():"없음"]})]}),u&&(0,a.jsxs)("div",{className:"flex flex-col gap-2 pt-2",children:[(0,a.jsx)("button",{onClick:A,className:"w-full px-3 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded text-sm",children:"저장"}),(0,a.jsx)("button",{onClick:()=>{h(!1),p({name:c.name,phone:c.phone||"",department:c.department||"",position:c.position||""})},className:"w-full px-3 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded text-sm",children:"취소"})]})]})}),(0,a.jsx)("div",{className:"hidden md:block bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"비밀번호 변경"}),!f&&(0,a.jsx)(i.Z,{onClick:()=>N(!0),className:"px-4 py-2 text-sm bg-yellow-600 hover:bg-yellow-700 text-white rounded-md",children:"비밀번호 변경"})]}),D&&(0,a.jsx)("div",{className:"mb-4 rounded-md bg-green-50 dark:bg-green-900/20 p-4",children:(0,a.jsx)("div",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:D})}),f&&(0,a.jsx)("form",{onSubmit:T,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"현재 비밀번호"}),(0,a.jsx)(l.Z,{id:"currentPassword",name:"currentPassword",type:"password",required:!0,value:v.currentPassword,onChange:_,placeholder:"현재 비밀번호",className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"새 비밀번호"}),(0,a.jsx)(l.Z,{id:"newPassword",name:"newPassword",type:"password",required:!0,value:v.newPassword,onChange:_,placeholder:"새 비밀번호 (최소 8자)",className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"새 비밀번호 확인"}),(0,a.jsx)(l.Z,{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,value:v.confirmPassword,onChange:_,placeholder:"새 비밀번호 확인",className:"w-full"})]}),P&&(0,a.jsx)("div",{className:"rounded-md bg-red-50 dark:bg-red-900/20 p-4",children:(0,a.jsx)("div",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:P})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.Z,{type:"submit",className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-md",children:"변경"}),(0,a.jsx)(i.Z,{type:"button",onClick:()=>{N(!1),k({currentPassword:"",newPassword:"",confirmPassword:""}),C("")},className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-md",children:"취소"})]})]})})]})}),(0,a.jsxs)("div",{className:"md:hidden rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"비밀번호 변경"}),!f&&(0,a.jsx)(i.Z,{onClick:()=>N(!0),className:"px-3 py-1 text-sm bg-yellow-600 hover:bg-yellow-700 text-white rounded-md",children:"변경"})]}),D&&(0,a.jsx)("div",{className:"rounded-md bg-green-50 dark:bg-green-900/20 p-3",children:(0,a.jsx)("div",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:D})}),f&&(0,a.jsxs)("form",{onSubmit:T,className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"현재 비밀번호"}),(0,a.jsx)(l.Z,{name:"currentPassword",type:"password",required:!0,value:v.currentPassword,onChange:_,placeholder:"현재 비밀번호",className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"새 비밀번호"}),(0,a.jsx)(l.Z,{name:"newPassword",type:"password",required:!0,value:v.newPassword,onChange:_,placeholder:"새 비밀번호 (최소 8자)",className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"새 비밀번호 확인"}),(0,a.jsx)(l.Z,{name:"confirmPassword",type:"password",required:!0,value:v.confirmPassword,onChange:_,placeholder:"새 비밀번호 확인",className:"w-full"})]}),P&&(0,a.jsx)("div",{className:"rounded-md bg-red-50 dark:bg-red-900/20 p-3",children:(0,a.jsx)("div",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:P})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("button",{type:"submit",className:"w-full px-3 py-2 bg-yellow-500 text-white hover:bg-yellow-600 rounded text-sm",children:"변경"}),(0,a.jsx)("button",{type:"button",onClick:()=>{N(!1),k({currentPassword:"",newPassword:"",confirmPassword:""}),C("")},className:"w-full px-3 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded text-sm",children:"취소"})]})]})]})]})}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"text-lg text-red-600",children:"프로필을 불러올 수 없습니다."})})}},6334:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var a=s(7437);s(2265);let r={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},n={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function d(e){let{variant:t="primary",size:s="md",className:d="",...l}=e;return(0,a.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(r[t]," ").concat(n[s]," ").concat(d),...l})}},2827:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{className:t="",...s}=e;return(0,a.jsx)("input",{className:"".concat("rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20"," ").concat(t),...s})}s(2265)}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=9734)}),_N_E=e.O()}]);