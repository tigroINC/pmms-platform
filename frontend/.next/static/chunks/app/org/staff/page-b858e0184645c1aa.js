(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1889],{8744:function(e,t,a){Promise.resolve().then(a.bind(a,1806))},1806:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(7437),s=a(2265),i=a(605),l=a(9376),d=a(7648),n=a(6334),c=a(2827),x=a(682),o=a(2891);function g(){let{data:e,status:t}=(0,i.useSession)(),a=(0,l.useRouter)(),{selectedOrg:g}=(0,o.o)(),[u,h]=(0,s.useState)([]),[p,m]=(0,s.useState)(!0),[y,f]=(0,s.useState)(!1),[b,v]=(0,s.useState)(""),[j,N]=(0,s.useState)("ALL"),[k,w]=(0,s.useState)("ALL");(0,s.useEffect)(()=>{if("unauthenticated"===t){a.push("/login");return}if(null==e?void 0:e.user){let t=e.user.role;if("ORG_ADMIN"!==t&&"SUPER_ADMIN"!==t){a.push("/dashboard");return}g&&D()}},[e,t,a,g]);let D=async()=>{if(g)try{m(!0);let e=new URLSearchParams({search:b,status:j,role:k,organizationId:g.id}),t=await fetch("/api/org/staff?".concat(e)),a=await t.json();t.ok?h(a.staff||[]):alert(a.error||"직원 목록을 불러오는데 실패했습니다.")}catch(e){alert("직원 목록을 불러오는데 실패했습니다.")}finally{m(!1)}};(0,s.useEffect)(()=>{(null==e?void 0:e.user)&&g&&D()},[b,j,k,g]);let S=e=>(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat({SUPER_ADMIN:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",ORG_ADMIN:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",OPERATOR:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}[e]||"bg-gray-100 text-gray-800"),children:{SUPER_ADMIN:"시스템 관리자",ORG_ADMIN:"조직 관리자",OPERATOR:"실무자"}[e]||e});return p?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})})}):(0,r.jsxs)("section",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-2.5",children:[(0,r.jsx)("h1",{className:"text-lg font-semibold mb-2",children:"직원 관리"}),(0,r.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"검색"}),(0,r.jsx)(c.Z,{className:"text-sm h-8",style:{width:"352px",minWidth:"352px"},type:"text",placeholder:"이름, 이메일 검색",value:b,onChange:e=>v(e.target.value)})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"상태"}),(0,r.jsxs)("select",{value:j,onChange:e=>N(e.target.value),className:"text-sm h-8 border border-gray-300 dark:border-gray-600 rounded-md px-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"ALL",children:"전체"}),(0,r.jsx)("option",{value:"ACTIVE",children:"활성"}),(0,r.jsx)("option",{value:"INACTIVE",children:"비활성"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"역할"}),(0,r.jsxs)("select",{value:k,onChange:e=>w(e.target.value),className:"text-sm h-8 border border-gray-300 dark:border-gray-600 rounded-md px-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"ALL",children:"전체"}),(0,r.jsx)("option",{value:"ORG_ADMIN",children:"조직 관리자"}),(0,r.jsx)("option",{value:"OPERATOR",children:"실무자"})]})]}),(0,r.jsx)("div",{className:"flex gap-1.5 mb-1.5 ml-auto",children:(0,r.jsx)(n.Z,{size:"sm",onClick:()=>f(!0),children:"+ 직원 초대"})})]})]}),(0,r.jsx)("div",{className:"hidden md:block rounded-lg border overflow-x-auto max-h-[calc(100vh-180px)] overflow-y-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,r.jsx)("thead",{className:"bg-gray-50 dark:bg-white/10 sticky top-0 z-10",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800",children:"상태"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800",children:"이름"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800",children:"이메일"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800",children:"역할"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800",children:"부서/직책"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800",children:"담당 고객사"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800",children:"마지막 로그인"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800",children:"액션"})]})}),(0,r.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===u.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:"직원이 없습니다."})}):u.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:e.isActive?"활성":"비활성"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900 dark:text-white",children:e.name}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.email}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:S(e.role)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.department&&e.position?"".concat(e.department," / ").concat(e.position):e.department||e.position||"-"}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e._count.assignedCustomers,"개"]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.lastLoginAt?new Date(e.lastLoginAt).toLocaleDateString("ko-KR"):"없음"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,r.jsx)(d.default,{href:"/org/staff/".concat(e.id),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:"상세"})})]},e.id))})]})}),(0,r.jsx)("div",{className:"md:hidden space-y-3",children:0===u.length?(0,r.jsx)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-6 text-center text-gray-500",children:"직원이 없습니다."}):u.map(e=>(0,r.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:e.isActive?"활성":"비활성"}),(0,r.jsx)(d.default,{href:"/org/staff/".concat(e.id),className:"text-xs text-blue-600 hover:underline",children:"상세"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDC64 이름:"})," ",(0,r.jsx)("span",{className:"font-medium",children:e.name})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCE7 이메일:"})," ",e.email]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFF7️ 역할:"})," ",S(e.role)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFE2 부서/직책:"})," ",e.department&&e.position?"".concat(e.department," / ").concat(e.position):e.department||e.position||"-"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCD 담당:"})," ",e._count.assignedCustomers,"개"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDD50 로그인:"})," ",e.lastLoginAt?new Date(e.lastLoginAt).toLocaleDateString("ko-KR"):"없음"]})]})]},e.id))}),y&&(0,r.jsx)(x.Z,{isOpen:y,onClose:()=>f(!1),onSuccess:()=>{f(!1),D()}})]})}},2891:function(e,t,a){"use strict";a.d(t,{OrganizationProvider:function(){return d},o:function(){return n}});var r=a(7437),s=a(2265),i=a(605);let l=(0,s.createContext)(void 0);function d(e){var t,a,d;let{children:n}=e,{data:c,status:x}=(0,i.useSession)(),[o,g]=(0,s.useState)(null),[u,h]=(0,s.useState)([]),[p,m]=(0,s.useState)(!0),y=(null==c?void 0:null===(t=c.user)||void 0===t?void 0:t.role)==="SUPER_ADMIN",f=null==c?void 0:null===(a=c.user)||void 0===a?void 0:a.role,b=null==c?void 0:null===(d=c.user)||void 0===d?void 0:d.organizationId,v="CUSTOMER_ADMIN"===f||"CUSTOMER_USER"===f;(0,s.useEffect)(()=>{if("loading"!==x){if(!c||v){m(!1);return}y&&sessionStorage.getItem("viewAsOrganization"),y?j():b?N(b):m(!1)}},[c,x,y,b,v]),(0,s.useEffect)(()=>{if(!y)return;let e=sessionStorage.getItem("viewAsOrganization");e&&(null==o?void 0:o.id)!==e&&j();let t=setInterval(()=>{let e=sessionStorage.getItem("viewAsOrganization");if(e&&(null==o?void 0:o.id)!==e)j();else if(!e&&o){let e=localStorage.getItem("selectedOrgId");e&&o.id!==e&&j()}},500);return()=>clearInterval(t)},[y,o]);let j=async()=>{try{let e=await fetch("/api/organizations?status=APPROVED"),t=await e.json();if(e.ok){let e=t.organizations||[];h(e);let a=sessionStorage.getItem("viewAsOrganization");if(a){let t=e.find(e=>e.id===a);if(t){g(t);return}}let r=localStorage.getItem("selectedOrgId");if(r){let t=e.find(e=>e.id===r);t?g(t):e.length>0&&g(e[0])}else e.length>0&&g(e[0])}}catch(e){}finally{m(!1)}},N=async e=>{try{let t=await fetch("/api/organizations/".concat(e)),a=await t.json();if(t.ok){let e=a.organization;h([e]),g(e)}}catch(e){}finally{m(!1)}};return(0,r.jsx)(l.Provider,{value:{selectedOrg:o,setSelectedOrg:e=>{g(e),e?localStorage.setItem("selectedOrgId",e.id):localStorage.removeItem("selectedOrgId")},organizations:u,loading:p,isSuperAdmin:y},children:n})}function n(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useOrganization must be used within OrganizationProvider");return e}}},function(e){e.O(0,[605,3448,682,2971,2117,1744],function(){return e(e.s=8744)}),_N_E=e.O()}]);