(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[722],{4378:function(e,t,r){Promise.resolve().then(r.bind(r,7776))},7776:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var a=r(7437),s=r(2265),d=r(605),n=r(9376),i=r(7648),l=r(6334),c=r(2827);function o(e){let{isOpen:t,staffId:r,currentAssignments:d,onClose:n,onSuccess:i}=e,[o,x]=(0,s.useState)([]),[m,g]=(0,s.useState)(new Set),[h,u]=(0,s.useState)(null),[b,y]=(0,s.useState)(""),[f,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(t){j(),g(new Set(d.map(e=>e.customer.id)));let e=d.find(e=>e.isPrimary);u((null==e?void 0:e.customer.id)||null)}},[t,d]);let j=async()=>{try{let e=await fetch("/api/customers"),t=await e.json();e.ok&&x(t.customers||[])}catch(e){}},k=e=>{let t=new Set(m);t.has(e)?(t.delete(e),h===e&&u(null)):t.add(e),g(t)},v=e=>{m.has(e)&&u(e)},N=async()=>{try{p(!0);let e=await fetch("/api/org/staff/".concat(r,"/assign-customers"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerIds:Array.from(m),primaryCustomerId:h})}),t=await e.json();e.ok?(alert("담당 고객사가 할당되었습니다."),i()):alert(t.error||"할당에 실패했습니다.")}catch(e){alert("할당 중 오류가 발생했습니다.")}finally{p(!1)}};if(!t)return null;let w=o.filter(e=>e.name.toLowerCase().includes(b.toLowerCase())||e.businessNumber.includes(b));return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] flex flex-col",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"담당 고객사 할당"})}),(0,a.jsxs)("div",{className:"p-6 flex-1 overflow-y-auto",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(c.Z,{type:"text",placeholder:"고객사명 또는 사업자등록번호 검색...",value:b,onChange:e=>y(e.target.value)})}),(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:(0,a.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:["선택: ",m.size,"개",h&&" (주 담당 설정됨)"]})}),(0,a.jsx)("div",{className:"space-y-2",children:0===w.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"고객사가 없습니다."}):w.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,a.jsxs)("label",{className:"flex items-center flex-1 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.has(e.id),onChange:()=>k(e.id),className:"mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.businessNumber})]})]}),m.has(e.id)&&(0,a.jsx)("button",{onClick:()=>v(e.id),className:"ml-3 px-3 py-1 rounded text-xs font-medium ".concat(h===e.id?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 dark:bg-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500"),children:h===e.id?"주 담당":"주 담당 설정"})]},e.id))}),(0,a.jsx)("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\uD83D\uDCA1 주 담당으로 설정된 고객사는 알림 및 보고서에서 기본 담당자로 표시됩니다."})})]}),(0,a.jsxs)("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex gap-2",children:[(0,a.jsx)("button",{onClick:n,disabled:f,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"취소"}),(0,a.jsx)(l.Z,{onClick:N,disabled:f,className:"flex-1",children:f?"저장 중...":"저장"})]})]})})}function x(){var e;let{data:t,status:r}=(0,d.useSession)(),x=(0,n.useRouter)(),m=(0,n.useParams)(),g=null==m?void 0:m.id,[h,u]=(0,s.useState)(null),[b,y]=(0,s.useState)(!0),[f,p]=(0,s.useState)(!1),[j,k]=(0,s.useState)(!1),[v,N]=(0,s.useState)({name:"",phone:"",department:"",position:"",role:""});(0,s.useEffect)(()=>{if("unauthenticated"===r){x.push("/login");return}if(null==t?void 0:t.user){let e=t.user.role;if("ORG_ADMIN"!==e&&"SUPER_ADMIN"!==e){x.push("/dashboard");return}w()}},[t,r,x,g]);let w=async()=>{try{y(!0);let e=await fetch("/api/org/staff/".concat(g)),t=await e.json();e.ok?(u(t.staff),N({name:t.staff.name||"",phone:t.staff.phone||"",department:t.staff.department||"",position:t.staff.position||"",role:t.staff.role||""})):(alert(t.error||"직원 정보를 불러오는데 실패했습니다."),x.push("/org/staff"))}catch(e){alert("직원 정보를 불러오는데 실패했습니다.")}finally{y(!1)}},C=async()=>{try{let e=await fetch("/api/org/staff/".concat(g),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}),t=await e.json();e.ok?(alert("저장되었습니다."),p(!1),w()):alert(t.error||"저장에 실패했습니다.")}catch(e){alert("저장 중 오류가 발생했습니다.")}},A=async()=>{if(!h)return;let e=h.isActive?"비활성화":"활성화";if(confirm("이 직원을 ".concat(e,"하시겠습니까?")))try{let t=h.isActive?"deactivate":"activate",r=await fetch("/api/org/staff/".concat(g,"/").concat(t),{method:"PATCH"}),a=await r.json();r.ok?(alert(a.message),w()):alert(a.error||"".concat(e,"에 실패했습니다."))}catch(t){alert("".concat(e," 중 오류가 발생했습니다."))}},S=async()=>{if(h){if(h.assignedCustomers.length>0){alert("담당 고객사가 ".concat(h.assignedCustomers.length,"개 있는 직원은 삭제할 수 없습니다.\n먼저 담당 고객사를 해제해주세요."));return}if(confirm('"'.concat(h.name,'" 직원을 완전히 삭제하시겠습니까?\n\n⚠️ 이 작업은 되돌릴 수 없습니다.')))try{let e=await fetch("/api/org/staff/".concat(g),{method:"DELETE"}),t=await e.json();e.ok?(alert("삭제되었습니다."),x.push("/org/staff")):alert(t.error||"삭제에 실패했습니다.")}catch(e){alert("삭제 중 오류가 발생했습니다.")}}};return b?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})})}):h?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"직원 상세"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"직원 정보 및 담당 고객사 관리"})]}),(0,a.jsx)(i.default,{href:"/org/staff",children:(0,a.jsx)("button",{className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"← 목록으로"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"기본 정보"}),f?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{p(!1),N({name:h.name||"",phone:h.phone||"",department:h.department||"",position:h.position||"",role:h.role||""})},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"취소"}),(0,a.jsx)(l.Z,{onClick:C,children:"저장"})]}):(0,a.jsx)(l.Z,{onClick:()=>p(!0),children:"수정"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"이름"}),f?(0,a.jsx)(c.Z,{value:v.name,onChange:e=>N({...v,name:e.target.value})}):(0,a.jsx)("div",{className:"text-gray-900 dark:text-white",children:h.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"이메일"}),(0,a.jsx)("div",{className:"text-gray-900 dark:text-white",children:h.email}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"이메일은 변경할 수 없습니다."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"전화번호"}),f?(0,a.jsx)(c.Z,{value:v.phone,onChange:e=>N({...v,phone:e.target.value}),placeholder:"010-1234-5678"}):(0,a.jsx)("div",{className:"text-gray-900 dark:text-white",children:h.phone||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"역할"}),f?(0,a.jsxs)("select",{value:v.role,onChange:e=>N({...v,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,a.jsx)("option",{value:"ORG_ADMIN",children:"조직 관리자"}),(0,a.jsx)("option",{value:"OPERATOR",children:"실무자"})]}):(0,a.jsx)("div",{children:(e=h.role,(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat({SUPER_ADMIN:"bg-purple-100 text-purple-800",ORG_ADMIN:"bg-red-100 text-red-800",OPERATOR:"bg-blue-100 text-blue-800"}[e]||"bg-gray-100 text-gray-800"),children:{SUPER_ADMIN:"시스템 관리자",ORG_ADMIN:"조직 관리자",OPERATOR:"실무자"}[e]||e}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"부서"}),f?(0,a.jsx)(c.Z,{value:v.department,onChange:e=>N({...v,department:e.target.value}),placeholder:"개발팀"}):(0,a.jsx)("div",{className:"text-gray-900 dark:text-white",children:h.department||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"직책"}),f?(0,a.jsx)(c.Z,{value:v.position,onChange:e=>N({...v,position:e.target.value}),placeholder:"팀장"}):(0,a.jsx)("div",{className:"text-gray-900 dark:text-white",children:h.position||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"상태"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(h.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:h.isActive?"활성":"비활성"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"가입일"}),(0,a.jsx)("div",{className:"text-gray-900 dark:text-white",children:new Date(h.createdAt).toLocaleDateString("ko-KR")})]})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["담당 고객사 (",h.assignedCustomers.length,"개)"]}),(0,a.jsx)(l.Z,{onClick:()=>k(!0),children:"담당 할당"})]}),0===h.assignedCustomers.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"담당 고객사가 없습니다."}):(0,a.jsx)("div",{className:"space-y-2",children:h.assignedCustomers.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.customer.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.customer.businessNumber})]}),e.isPrimary&&(0,a.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded text-xs font-medium",children:"주 담당"})]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"계정 관리"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white",children:h.isActive?"계정 비활성화":"계정 활성화"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:h.isActive?"비활성화하면 로그인할 수 없습니다. 데이터는 유지됩니다.":"활성화하면 다시 로그인할 수 있습니다."})]}),(0,a.jsx)("button",{onClick:A,className:"px-4 py-2 rounded-md whitespace-nowrap ".concat(h.isActive?"bg-orange-600 hover:bg-orange-700 text-white":"bg-green-600 hover:bg-green-700 text-white"),children:h.isActive?"비활성화":"활성화"})]}),!h.isActive&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 rounded-md",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-red-900 dark:text-red-200",children:"계정 삭제"}),(0,a.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:"⚠️ 삭제하면 모든 데이터가 영구적으로 삭제됩니다. 이 작업은 되돌릴 수 없습니다."}),h.assignedCustomers.length>0&&(0,a.jsxs)("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:["담당 고객사 ",h.assignedCustomers.length,"개를 먼저 해제해야 삭제할 수 있습니다."]})]}),(0,a.jsx)("button",{onClick:S,disabled:h.assignedCustomers.length>0,className:"px-4 py-2 rounded-md whitespace-nowrap bg-red-600 hover:bg-red-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"삭제"})]})]})]})]}),j&&(0,a.jsx)(o,{isOpen:j,staffId:g,currentAssignments:h.assignedCustomers,onClose:()=>k(!1),onSuccess:()=>{k(!1),w()}})]}):null}},6334:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(7437);r(2265);let s={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},d={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function n(e){let{variant:t="primary",size:r="md",className:n="",...i}=e;return(0,a.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(s[t]," ").concat(d[r]," ").concat(n),...i})}},2827:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(7437);function s(e){let{className:t="",...r}=e;return(0,a.jsx)("input",{className:"".concat("rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20"," ").concat(t),...r})}r(2265)}},function(e){e.O(0,[605,3448,2971,2117,1744],function(){return e(e.s=4378)}),_N_E=e.O()}]);