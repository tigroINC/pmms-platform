(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6121],{1847:function(e,t,s){Promise.resolve().then(s.bind(s,526))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},526:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var a=s(7437),l=s(2265),r=s(605),n=s(9376);function i(e){let{isOpen:t,onClose:s,onSuccess:n}=e,{data:i}=(0,r.useSession)(),[d,c]=(0,l.useState)([]),[x,u]=(0,l.useState)(""),[o,m]=(0,l.useState)(""),[p,h]=(0,l.useState)(""),[g,y]=(0,l.useState)(""),[b,j]=(0,l.useState)(""),[N,f]=(0,l.useState)(""),[v,w]=(0,l.useState)(""),[S,E]=(0,l.useState)(""),[P,k]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t&&C()},[t]);let C=async()=>{try{var e;let t=null==i?void 0:null===(e=i.user)||void 0===e?void 0:e.organizationId,s=await fetch("/api/connections/by-organization?organizationId=".concat(t)),a=await s.json();if(s.ok){let e=a.connections.filter(e=>"APPROVED"===e.status).map(e=>e.customer);c(e)}}catch(e){}},D=async()=>{if(!x||!o||!g){alert("고객사, 굴뚝명, 위치는 필수입니다.");return}try{k(!0);let e=await fetch("/api/stack-assignments/request-new",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:x,stackName:o,stackCode:p||null,location:g,height:b?parseFloat(b):null,diameter:N?parseFloat(N):null,coordinates:v||null,description:S||null})}),t=await e.json();e.ok?(alert("굴뚝 등록 요청이 전송되었습니다."),n(),R()):alert(t.error||"요청 전송 실패")}catch(e){alert("요청 전송 중 오류가 발생했습니다.")}finally{k(!1)}},R=()=>{u(""),m(""),h(""),y(""),j(""),f(""),w(""),E(""),s()};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-[600px] max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"신규 굴뚝 등록 요청"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["고객사 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:x,onChange:e=>u(e.target.value),className:"w-full border rounded px-3 py-2",required:!0,children:[(0,a.jsx)("option",{value:"",children:"고객사 선택"}),d.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.businessNumber,")"]},e.id))]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["굴뚝명 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:o,onChange:e=>m(e.target.value),placeholder:"예: 1호 소각로",className:"w-full border rounded px-3 py-2",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"굴뚝코드"}),(0,a.jsx)("input",{type:"text",value:p,onChange:e=>h(e.target.value),placeholder:"예: ST-001",className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["위치 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>y(e.target.value),placeholder:"예: 공장 동쪽",className:"w-full border rounded px-3 py-2",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4 grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"높이 (m)"}),(0,a.jsx)("input",{type:"number",step:"0.1",value:b,onChange:e=>j(e.target.value),placeholder:"예: 25.5",className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"직경 (m)"}),(0,a.jsx)("input",{type:"number",step:"0.1",value:N,onChange:e=>f(e.target.value),placeholder:"예: 1.2",className:"w-full border rounded px-3 py-2"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"좌표"}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>w(e.target.value),placeholder:"예: 37.5665,126.9780",className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"설명"}),(0,a.jsx)("textarea",{value:S,onChange:e=>E(e.target.value),placeholder:"추가 설명이 있으면 입력해주세요",rows:3,className:"w-full border rounded px-3 py-2"})]}),(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-50 rounded text-sm text-blue-800",children:"\uD83D\uDCA1 요청을 전송하면 고객사 관리자가 승인할 수 있습니다."}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:R,className:"flex-1 bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",disabled:P,children:"취소"}),(0,a.jsx)("button",{onClick:D,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400",disabled:P,children:P?"전송 중...":"등록 요청"})]})]})}):null}function d(){var e;let{data:t,status:s}=(0,r.useSession)(),d=(0,n.useRouter)(),[c,x]=(0,l.useState)([]),[u,o]=(0,l.useState)(!0),[m,p]=(0,l.useState)("ALL"),[h,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if("unauthenticated"===s){d.push("/login");return}if(null==t?void 0:t.user){let e=t.user.role;if("ORG_ADMIN"!==e&&"OPERATOR"!==e&&"SUPER_ADMIN"!==e){d.push("/dashboard");return}y()}},[t,s,d]);let y=async()=>{try{var e;o(!0);let s=null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.organizationId,a=await fetch("/api/stack-requests?organizationId=".concat(s)),l=await a.json();a.ok&&x(l.requests||[])}catch(e){}finally{o(!1)}},b=c.filter(e=>"ALL"===m||e.status===m),j=e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat({PENDING:"bg-yellow-100 text-yellow-800",APPROVED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800"}[e]),children:{PENDING:"대기중",APPROVED:"승인됨",REJECTED:"거부됨"}[e]}),N=e=>"NEW_STACK"===e?(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"신규 등록"}):(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800",children:"담당 추가"}),f=null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.role;return u?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"굴뚝 등록 요청"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"고객사 굴뚝 등록 및 담당 요청 관리"})]}),(0,a.jsxs)("div",{className:"mb-4 flex flex-wrap gap-3 items-center",children:[(0,a.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"ALL",children:"전체"}),(0,a.jsx)("option",{value:"PENDING",children:"대기중"}),(0,a.jsx)("option",{value:"APPROVED",children:"승인됨"}),(0,a.jsx)("option",{value:"REJECTED",children:"거부됨"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["총 ",b.length,"건"]}),("ORG_ADMIN"===f||"OPERATOR"===f)&&(0,a.jsx)("button",{onClick:()=>g(!0),className:"ml-auto bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"+ 신규 굴뚝 등록 요청"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"상태"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"요청유형"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"고객사"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"굴뚝명"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"굴뚝코드"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"위치"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"제원"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"요청일"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===b.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,className:"px-6 py-4 text-center text-gray-500",children:"굴뚝 등록 요청이 없습니다."})}):b.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:j(e.status)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:N(e.requestType)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:e.customer.name}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-900",children:e.stackName}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500",children:e.stackCode||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500",children:e.location}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.height&&e.diameter?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:["높이: ",e.height,"m"]}),(0,a.jsxs)("div",{children:["직경: ",e.diameter,"m"]})]}):"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]},e.id))})]})}),(0,a.jsx)(i,{isOpen:h,onClose:()=>g(!1),onSuccess:y})]})}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=1847)}),_N_E=e.O()}]);