(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7226],{6354:function(e,t,a){Promise.resolve().then(a.bind(a,1341))},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},1341:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(7437),r=a(2265),n=a(2397),l=a(9376),i=a(6334);function c(){let{user:e}=(0,n.a)(),t=(0,l.useRouter)(),[a,c]=(0,r.useState)(!1),[d,o]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[h,x]=(0,r.useState)(""),[f,b]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),[v,y]=(0,r.useState)([]),j=(0,r.useMemo)(()=>{let e=f.find(e=>(e.code?"[".concat(e.code,"] ").concat(e.name):e.name)===d||e.name===d);return null==e?void 0:e.id},[f,d]);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/customers?tab=all"),t=await e.json();b(t.customers||t.data||[])}catch(e){b([])}})()},[]),(0,r.useEffect)(()=>{if(!j){g([]);return}(async()=>{try{let e=await fetch("/api/stacks?customerId=".concat(j)),t=await e.json();g(t.stacks||t.data||[])}catch(e){g([])}})()},[j]),(0,r.useEffect)(()=>{var e,t;if(!j||!u){y([]);return}let a=(null===(e=u.match(/\[(.*?)\]/))||void 0===e?void 0:e[1])||u,s=null===(t=p.find(e=>e.name===a||u.includes(e.name)))||void 0===t?void 0:t.id;s&&(async()=>{try{let e=await fetch("/api/measurements?customerId=".concat(j,"&stackId=").concat(s)),t=((await e.json()).data||[]).map(e=>new Date(e.measuredAt).toISOString().split("T")[0]).filter((e,t,a)=>a.indexOf(e)===t).sort((e,t)=>t.localeCompare(e));y(t)}catch(e){y([])}})()},[j,u,p]);let N=async()=>{var e,a;if(!j||!u||!h){alert("고객사, 굴뚝, 측정일자를 모두 선택해주세요.");return}let s=(null===(e=u.match(/\[(.*?)\]/))||void 0===e?void 0:e[1])||u,r=null===(a=p.find(e=>e.name===s||u.includes(e.name)))||void 0===a?void 0:a.id;if(!r){alert("굴뚝을 찾을 수 없습니다.");return}c(!0);try{let e=await fetch("/api/reports",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:j,stackId:r,measuredAt:h})}),a=await e.json();e.ok?t.push("/reports/".concat(a.data.id)):alert(a.error||"보고서 생성 실패")}catch(e){alert(e.message||"보고서 생성 중 오류가 발생했습니다.")}finally{c(!1)}};return(0,s.jsxs)("div",{className:"p-6 max-w-2xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"신규 보고서 작성"}),(0,s.jsx)(i.Z,{variant:"secondary",onClick:()=>t.push("/reports"),children:"취소"})]}),(0,s.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-6 space-y-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"기본 정보 선택"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"text-sm font-medium",children:["고객사 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{list:"customers-list",value:d,onChange:e=>{o(e.target.value),m("")},placeholder:"고객사를 검색하거나 선택하세요",className:"w-full border rounded px-3 py-2 dark:bg-gray-800"}),(0,s.jsx)("datalist",{id:"customers-list",children:f.map(e=>{let t=e.code?"[".concat(e.code,"] ").concat(e.name):e.name;return(0,s.jsx)("option",{value:t,children:e.fullName||e.name},e.id)})})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝명 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{list:"stacks-list",value:u,onChange:e=>m(e.target.value),disabled:!j,placeholder:"굴뚝을 검색하거나 선택하세요",className:"w-full border rounded px-3 py-2 dark:bg-gray-800 disabled:opacity-50"}),(0,s.jsx)("datalist",{id:"stacks-list",children:p.map(e=>{let t="[".concat(e.name,"] ").concat(e.fullName||e.name);return(0,s.jsx)("option",{value:t,children:t},e.id)})})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"text-sm font-medium",children:["측정일자 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("select",{value:h,onChange:e=>x(e.target.value),disabled:0===v.length,className:"w-full border rounded px-3 py-2 dark:bg-gray-800 disabled:opacity-50",children:[(0,s.jsx)("option",{value:"",children:"측정일자를 선택하세요"}),v.map(e=>(0,s.jsx)("option",{value:e,children:new Date(e).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})},e))]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:0===v.length&&u?"해당 굴뚝의 측정 데이터가 없습니다.":"측정 데이터가 있는 날짜만 표시됩니다."})]}),(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded p-3",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["\uD83D\uDCA1 보고서는 선택한 측정일자의 데이터를 자동으로 불러옵니다.",(0,s.jsx)("br",{}),"생성 후 모든 항목을 수정할 수 있습니다."]})}),(0,s.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,s.jsx)(i.Z,{onClick:N,disabled:a,className:"flex-1",children:a?"생성 중...":"보고서 생성"}),(0,s.jsx)(i.Z,{variant:"secondary",onClick:()=>t.push("/reports"),className:"flex-1",children:"취소"})]})]})]})}},6334:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(7437);a(2265);let r={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},n={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function l(e){let{variant:t="primary",size:a="md",className:l="",...i}=e;return(0,s.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(r[t]," ").concat(n[a]," ").concat(l),...i})}},2397:function(e,t,a){"use strict";a.d(t,{H:function(){return d},a:function(){return o}});var s=a(7437),r=a(2265),n=a(605),l=a(9376);function i(){return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900",children:[(0,s.jsxs)("div",{className:"mb-16",children:[(0,s.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-white text-center",children:"오염물질 측정 관리 시스템"}),(0,s.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:"Pollutant Measurement Management System"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-gray-200 dark:border-gray-700 border-t-blue-600 rounded-full animate-spin"})}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm font-medium",children:"로딩 중..."})]}),(0,s.jsx)("div",{className:"mt-16"})]})}let c=(0,r.createContext)(null);function d(e){let{children:t}=e,{data:a,status:d}=(0,n.useSession)(),[o,u]=(0,r.useState)(null),[m,h]=(0,r.useState)(!0),x=(0,l.usePathname)();(0,r.useEffect)(()=>{"loading"!==d&&h(!1),(null==a?void 0:a.user)?u(a.user):"unauthenticated"===d&&u(null)},[a,d]);let f="loading"===d||m;return!f||"/login"===x||(null==x?void 0:x.startsWith("/register"))||(null==x?void 0:x.startsWith("/invite"))||(null==x?void 0:x.startsWith("/auth"))?(0,s.jsx)(c.Provider,{value:{user:o,loading:f},children:t}):(0,s.jsx)(i,{})}function o(){let e=(0,r.useContext)(c);if(!e)throw Error("AuthProvider is missing");return e}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=6354)}),_N_E=e.O()}]);