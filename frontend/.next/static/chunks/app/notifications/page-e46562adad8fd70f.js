(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5193],{527:function(e,t,a){Promise.resolve().then(a.bind(a,3267))},8930:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9205).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},3267:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var s=a(7437),r=a(2265),n=a(9376),i=a(2834),c=a(3782),l=a(8930);function o(){let e=(0,n.useRouter)(),{notifications:t,unreadCount:a,loading:o,fetchNotifications:d,markAllAsRead:u,deleteNotification:m}=(0,i.z)(),[x,h]=(0,r.useState)("all");(0,r.useEffect)(()=>{d(100)},[]);let f="unread"===x?t.filter(e=>!e.isRead):t,g=async e=>{confirm("이 알림을 삭제하시겠습니까?")&&await m(e)};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"알림"}),(0,s.jsx)("button",{onClick:()=>e.back(),className:"text-sm text-gray-600 hover:text-gray-900",children:"← 뒤로 가기"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("button",{onClick:()=>h("all"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("all"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["전체 (",t.length,")"]}),(0,s.jsxs)("button",{onClick:()=>h("unread"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("unread"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["읽지 않음 (",a,")"]})]}),a>0&&(0,s.jsx)("button",{onClick:u,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"모두 읽음 처리"})]})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:o?(0,s.jsxs)("div",{className:"p-12 text-center text-gray-500",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{children:"알림을 불러오는 중..."})]}):0===f.length?(0,s.jsxs)("div",{className:"p-12 text-center text-gray-500",children:[(0,s.jsx)("p",{className:"text-lg mb-2",children:"unread"===x?"읽지 않은 알림이 없습니다":"알림이 없습니다"}),(0,s.jsx)("p",{className:"text-sm",children:"unread"===x&&"모든 알림을 확인했습니다."})]}):(0,s.jsx)("div",{className:"divide-y divide-gray-100",children:f.map(e=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)(c.Z,{notification:e}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),g(e.id)},className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"삭제",children:(0,s.jsx)(l.Z,{className:"w-4 h-4"})})]},e.id))})})]})})}},3782:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var s=a(7437),r=a(9376),n=a(4747),i=a(6410),c=a(4766),l=a(1671),o=a(6865),d=a(2834);function u(e){let{notification:t,onClose:a}=e,u=(0,r.useRouter)(),{markAsRead:m}=(0,d.z)(),x=()=>{switch(t.type){case"STACK_CREATED_BY_CUSTOMER":case"STACK_UPDATED_BY_CUSTOMER":case"STACK_INTERNAL_CODE_NEEDED":return"/masters/stacks?stackId=".concat(t.stackId);case"STACK_CREATED_BY_ORG":return"/customer/stacks?tab=unverified&stackId=".concat(t.stackId);case"STACK_VERIFIED_BY_CUSTOMER":return"/masters/stacks/".concat(t.stackId);default:return null}},h=async()=>{t.isRead||await m(t.id);let e=x();e&&(u.push(e),null==a||a())};return(0,s.jsx)("div",{onClick:h,className:"p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors ".concat(t.isRead?"":"bg-blue-50"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-1",children:(()=>{switch(t.type){case"STACK_CREATED_BY_CUSTOMER":case"STACK_UPDATED_BY_CUSTOMER":case"STACK_CREATED_BY_ORG":return(0,s.jsx)(c.Z,{className:"w-5 h-5 text-blue-500"});case"STACK_VERIFIED_BY_CUSTOMER":return(0,s.jsx)(l.Z,{className:"w-5 h-5 text-green-500"});case"STACK_INTERNAL_CODE_NEEDED":return(0,s.jsx)(o.Z,{className:"w-5 h-5 text-orange-500"});default:return(0,s.jsx)(c.Z,{className:"w-5 h-5 text-gray-500"})}})()}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-sm text-gray-900 mb-1",children:t.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:t.message}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:(()=>{try{return(0,n.Q)(new Date(t.createdAt),{addSuffix:!0,locale:i.ko})}catch(e){return"방금 전"}})()})]}),!t.isRead&&(0,s.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-2"})]})})}},2397:function(e,t,a){"use strict";a.d(t,{H:function(){return o},a:function(){return d}});var s=a(7437),r=a(2265),n=a(605),i=a(9376);function c(){return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900",children:[(0,s.jsxs)("div",{className:"mb-16",children:[(0,s.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-white text-center",children:"오염물질 측정 관리 시스템"}),(0,s.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:"Pollutant Measurement Management System"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-gray-200 dark:border-gray-700 border-t-blue-600 rounded-full animate-spin"})}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm font-medium",children:"로딩 중..."})]}),(0,s.jsx)("div",{className:"mt-16"})]})}let l=(0,r.createContext)(null);function o(e){let{children:t}=e,{data:a,status:o}=(0,n.useSession)(),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(!0),h=(0,i.usePathname)();(0,r.useEffect)(()=>{"loading"!==o&&x(!1),(null==a?void 0:a.user)?u(a.user):"unauthenticated"===o&&u(null)},[a,o]);let f="loading"===o||m;return!f||"/login"===h||(null==h?void 0:h.startsWith("/register"))||(null==h?void 0:h.startsWith("/invite"))||(null==h?void 0:h.startsWith("/auth"))?(0,s.jsx)(l.Provider,{value:{user:d,loading:f},children:t}):(0,s.jsx)(c,{})}function d(){let e=(0,r.useContext)(l);if(!e)throw Error("AuthProvider is missing");return e}},2834:function(e,t,a){"use strict";a.d(t,{z:function(){return n}});var s=a(2265),r=a(2397);function n(){let{user:e}=(0,r.a)(),[t,a]=(0,s.useState)([]),[n,i]=(0,s.useState)(0),[c,l]=(0,s.useState)(!1),o=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;if(e)try{l(!0);let e=await fetch("/api/notifications?limit=".concat(t)),s=await e.json();e.ok&&(a(s.notifications||[]),i(s.unreadCount||0))}catch(e){}finally{l(!1)}},d=async()=>{if(e)try{let e=await fetch("/api/notifications/unread-count"),t=await e.json();e.ok&&i(t.count||0)}catch(e){}},u=async e=>{try{(await fetch("/api/notifications/".concat(e,"/read"),{method:"PATCH"})).ok&&(a(t=>t.map(t=>t.id===e?{...t,isRead:!0,readAt:new Date().toISOString()}:t)),i(e=>Math.max(0,e-1)))}catch(e){}},m=async()=>{try{(await fetch("/api/notifications/mark-all-read",{method:"PATCH"})).ok&&(a(e=>e.map(e=>({...e,isRead:!0,readAt:new Date().toISOString()}))),i(0))}catch(e){}},x=async e=>{try{if((await fetch("/api/notifications/".concat(e),{method:"DELETE"})).ok){let s=t.find(t=>t.id===e);a(t=>t.filter(t=>t.id!==e)),s&&!s.isRead&&i(e=>Math.max(0,e-1))}}catch(e){}};return(0,s.useEffect)(()=>{e&&o()},[e]),(0,s.useEffect)(()=>{if(!e)return;let t=setInterval(()=>{d()},12e4);return()=>clearInterval(t)},[e]),{notifications:t,unreadCount:n,loading:c,fetchNotifications:o,fetchUnreadCount:d,markAsRead:u,markAllAsRead:m,deleteNotification:x}}}},function(e){e.O(0,[605,3577,2971,2117,1744],function(){return e(e.s=527)}),_N_E=e.O()}]);