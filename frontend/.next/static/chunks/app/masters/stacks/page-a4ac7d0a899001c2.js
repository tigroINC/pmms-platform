(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6227],{3676:function(e,a,s){Promise.resolve().then(s.bind(s,3102))},9205:function(e,a,s){"use strict";s.d(a,{Z:function(){return m}});var t=s(2265);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,s)=>s?s.toUpperCase():a.toLowerCase()),c=e=>{let a=l(e);return a.charAt(0).toUpperCase()+a.slice(1)},n=function(){for(var e=arguments.length,a=Array(e),s=0;s<e;s++)a[s]=arguments[s];return a.filter((e,a,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===a).join(" ").trim()},i=e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0};var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,t.forwardRef)((e,a)=>{let{color:s="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:c,className:o="",children:m,iconNode:x,...u}=e;return(0,t.createElement)("svg",{ref:a,...d,width:r,height:r,stroke:s,strokeWidth:c?24*Number(l)/Number(r):l,className:n("lucide",o),...!m&&!i(u)&&{"aria-hidden":"true"},...u},[...x.map(e=>{let[a,s]=e;return(0,t.createElement)(a,s)}),...Array.isArray(m)?m:[m]])}),m=(e,a)=>{let s=(0,t.forwardRef)((s,l)=>{let{className:i,...d}=s;return(0,t.createElement)(o,{ref:l,iconNode:a,className:n("lucide-".concat(r(c(e))),"lucide-".concat(e),i),...d})});return s.displayName=c(e),s}},5685:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(9205).Z)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2489:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(9205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9376:function(e,a,s){"use strict";var t=s(5475);s.o(t,"useParams")&&s.d(a,{useParams:function(){return t.useParams}}),s.o(t,"usePathname")&&s.d(a,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(a,{useSearchParams:function(){return t.useSearchParams}})},3102:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return g}});var t=s(7437),r=s(2265),l=s(2397),c=s(1515),n=s(6334),i=s(2827);function d(e){var a,s;let{isOpen:l,onClose:c,onSuccess:d,stack:o}=e,m=!!o,[x,u]=(0,r.useState)([]),[h,g]=(0,r.useState)({customerId:(null==o?void 0:o.customerId)||"",name:(null==o?void 0:o.name)||"",code:(null==o?void 0:o.code)||"",fullName:(null==o?void 0:o.fullName)||"",facilityType:(null==o?void 0:o.facilityType)||"",height:(null==o?void 0:null===(a=o.height)||void 0===a?void 0:a.toString())||"",diameter:(null==o?void 0:null===(s=o.innerDiameter)||void 0===s?void 0:s.toString())||"",category:(null==o?void 0:o.category)||""}),[y,p]=(0,r.useState)(!1),[j,b]=(0,r.useState)("");(0,r.useEffect)(()=>{l&&f()},[l]),(0,r.useEffect)(()=>{if(o){var e,a;g({customerId:o.customerId||"",name:o.name||"",code:o.code||"",fullName:o.fullName||"",facilityType:o.facilityType||"",height:(null===(e=o.height)||void 0===e?void 0:e.toString())||"",diameter:(null===(a=o.innerDiameter)||void 0===a?void 0:a.toString())||"",category:o.category||""})}else g({customerId:"",name:"",code:"",fullName:"",facilityType:"",height:"",diameter:"",category:""});b("")},[o,l]);let f=async()=>{try{let e=await fetch("/api/customers?tab=all"),a=await e.json(),s=(a.customers||a.data||[]).filter(e=>!1!==e.isActive);u(s.sort((e,a)=>"CUST999"===e.code?1:"CUST999"===a.code?-1:(e.code||e.name).localeCompare(a.code||a.name)))}catch(e){}},N=(e,a)=>{g(s=>({...s,[e]:a}))},v=async e=>{if(e.preventDefault(),b(""),!h.customerId){b("고객사를 선택해주세요.");return}if(!h.name){b("굴뚝번호는 필수입니다.");return}p(!0);try{let e={customerId:h.customerId,name:h.name};h.code&&(e.code=h.code),h.fullName&&(e.fullName=h.fullName),h.facilityType&&(e.facilityType=h.facilityType),h.height&&(e.height=parseFloat(h.height)),h.diameter&&(e.diameter=parseFloat(h.diameter)),h.category&&(e.category=h.category);let a=m?"/api/stacks/".concat(o.id):"/api/stacks",s=await fetch(a,{method:m?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();throw Error(e.error||"저장 실패")}m||g({customerId:"",name:"",code:"",fullName:"",facilityType:"",height:"",diameter:"",category:""}),d(),c()}catch(e){b(e.message)}finally{p(!1)}};return l?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:c,children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b px-6 py-4 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:m?"굴뚝 정보 수정":"신규 굴뚝 추가"}),(0,t.jsx)("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"✕"})]}),(0,t.jsxs)("form",{onSubmit:v,className:"p-6 space-y-4",children:[j&&(0,t.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-4 py-3 rounded",children:j}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["고객사 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{value:h.customerId,onChange:e=>N("customerId",e.target.value),className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-700",required:!0,children:[(0,t.jsx)("option",{value:"",children:"고객사를 선택하세요"}),x.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.code||"코드없음",")"]},e.id))]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝번호 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(i.Z,{value:h.name,onChange:e=>N("name",e.target.value),placeholder:"예: #A2020007",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝코드 ",(0,t.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,t.jsx)(i.Z,{value:h.code,onChange:e=>N("code",e.target.value),placeholder:"예: CUST001-#A2020007"})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝 정식 명칭 ",(0,t.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,t.jsx)(i.Z,{value:h.fullName,onChange:e=>N("fullName",e.target.value),placeholder:"예: Silp PC 300 B/F"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["배출시설 종류 ",(0,t.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,t.jsx)(i.Z,{value:h.facilityType,onChange:e=>N("facilityType",e.target.value),placeholder:"예: 고체입자상물질 저장시설"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝 높이(m) ",(0,t.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,t.jsx)(i.Z,{type:"number",step:"0.1",value:h.height,onChange:e=>N("height",e.target.value),placeholder:"예: 19.6"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝 안지름(m) ",(0,t.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,t.jsx)(i.Z,{type:"number",step:"0.01",value:h.diameter,onChange:e=>N("diameter",e.target.value),placeholder:"예: 0.30"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝 종별(종) ",(0,t.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,t.jsx)(i.Z,{value:h.category,onChange:e=>N("category",e.target.value),placeholder:"예: 5"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsx)(n.Z,{type:"button",variant:"secondary",onClick:c,className:"flex-1",children:"취소"}),(0,t.jsx)(n.Z,{type:"submit",disabled:y,className:"flex-1",children:y?"저장 중...":"저장"})]})]})]})}):null}var o=s(3158),m=s(5685),x=s(2489);function u(e){var a,s,l;let{stack:n,role:i,onRefetch:d,onEdit:o}=e,[m,x]=(0,r.useState)(!1),u=async()=>{if(!m){x(!0);try{(await fetch("/api/stacks/".concat(n.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!n.isActive})})).ok?d():alert("상태 변경 실패")}catch(e){alert("오류 발생")}finally{x(!1)}}},h=async()=>{var e;if((null===(e=n._count)||void 0===e?void 0:e.measurements)&&n._count.measurements>0){alert("측정 기록이 있는 굴뚝은 삭제할 수 없습니다. 비활성화를 사용하세요.");return}if(confirm('"'.concat(n.name,'" 굴뚝을 삭제하시겠습니까?'))){x(!0);try{let e=await fetch("/api/stacks/".concat(n.id),{method:"DELETE"});if(e.ok)d();else{let a=await e.json();alert(a.error||"삭제 실패")}}catch(e){alert("오류 발생")}finally{x(!1)}}},g=!1!==n.isActive,y=!1!==n.customer.isActive;return(0,t.jsxs)(c.Tr,{className:g&&y?"":"opacity-50 bg-gray-50 dark:bg-gray-900/20",children:[(0,t.jsx)(c.Td,{children:g?(0,t.jsx)("span",{className:"inline-block px-2 py-0.5 rounded bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 text-xs",children:"활성"}):(0,t.jsx)("span",{className:"inline-block px-2 py-0.5 rounded bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 text-xs",children:"비활성"})}),(0,t.jsx)(c.Td,{className:"font-mono text-xs break-words",children:n.name}),(0,t.jsx)(c.Td,{className:"font-mono text-xs break-words",children:n.code||"-"}),(0,t.jsx)(c.Td,{className:"text-sm break-words",children:n.fullName||"-"}),(0,t.jsx)(c.Td,{className:"text-sm break-words",children:n.facilityType||"-"}),(0,t.jsx)(c.Td,{className:"text-center break-words",children:null!==(s=n.height)&&void 0!==s?s:"-"}),(0,t.jsx)(c.Td,{className:"text-center break-words",children:null!==(l=n.diameter)&&void 0!==l?l:"-"}),(0,t.jsx)(c.Td,{className:"text-center break-words",children:n.category||"-"}),(0,t.jsxs)(c.Td,{className:"break-words",children:[(0,t.jsx)("span",{className:"font-medium",children:n.customer.name}),n.customer.code&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[" (",n.customer.code,")"]}),!y&&(0,t.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 ml-1",children:"비활성"})]}),(0,t.jsx)(c.Td,{className:"text-center text-sm break-words",children:new Date(n.createdAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\. /g,"-").replace(".","")}),("SUPER_ADMIN"===i||"ORG_ADMIN"===i)&&(0,t.jsx)(c.Td,{children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>o(n),disabled:m,className:"text-xs text-green-600 hover:underline disabled:opacity-50",children:"수정"}),(0,t.jsx)("button",{onClick:u,disabled:m,className:"text-xs text-blue-600 hover:underline disabled:opacity-50",children:g?"비활성화":"활성화"}),!g&&!(null===(a=n._count)||void 0===a?void 0:a.measurements)&&(0,t.jsx)("button",{onClick:h,disabled:m,className:"text-xs text-red-600 hover:underline disabled:opacity-50",children:"삭제"})]})})]})}function h(){let[e,a]=(0,r.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.Z,{size:"sm",variant:"secondary",onClick:()=>a(!0),children:[(0,t.jsx)(m.Z,{className:"w-4 h-4 mr-1"}),"도움말"]}),e&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>a(!1),children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b p-4 flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"굴뚝 관리 도움말"}),(0,t.jsx)("button",{onClick:()=>a(!1),className:"text-gray-500 hover:text-gray-700",children:(0,t.jsx)(x.Z,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"font-semibold text-base mb-2",children:"\uD83D\uDCCB 기본 기능"}),(0,t.jsxs)("ul",{className:"list-disc list-inside text-gray-600 dark:text-gray-400 space-y-1",children:[(0,t.jsx)("li",{children:"담당 고객사의 모든 굴뚝 정보를 조회하고 관리할 수 있습니다"}),(0,t.jsx)("li",{children:"검색 기능으로 굴뚝번호, 코드, 명칭, 배출시설, 고객사로 검색 가능합니다"}),(0,t.jsx)("li",{children:"고객사 필터로 특정 고객사의 굴뚝만 조회할 수 있습니다"}),(0,t.jsx)("li",{children:"확인필요 항목이 우선 정렬되며, 날짜 최신순으로 표시됩니다"}),(0,t.jsx)("li",{children:"Excel 버튼으로 목록을 다운로드할 수 있습니다"})]})]}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"font-semibold text-base mb-2",children:"➕ 굴뚝 신규 추가"}),(0,t.jsxs)("div",{className:"space-y-2 text-gray-600 dark:text-gray-400",children:[(0,t.jsx)("p",{children:'"+ 신규 추가" 버튼을 클릭하여 새로운 굴뚝을 등록할 수 있습니다.'}),(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded",children:[(0,t.jsx)("p",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"필수 입력 항목:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"고객사"}),": 굴뚝이 속한 고객사 선택"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"굴뚝번호"}),": 환경측정기업 내부 코드 (예: S-001)"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"현장 명칭"}),": 굴뚝의 명칭 (예: 1호 소각로)"]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 p-3 rounded",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-300 mb-2",children:"선택 입력 항목:"}),(0,t.jsx)("ul",{className:"list-disc list-inside space-y-1",children:(0,t.jsx)("li",{children:"굴뚝코드, 배출시설 종류, 높이, 안지름, 종별 등"})})]}),(0,t.jsx)("p",{className:"text-sm italic",children:"\uD83D\uDCA1 등록한 굴뚝은 고객사의 검토대기 탭에 표시되며, 고객사에 알림이 전송됩니다."})]})]}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"font-semibold text-base mb-2",children:"✏️ 굴뚝 정보 수정"}),(0,t.jsxs)("div",{className:"space-y-2 text-gray-600 dark:text-gray-400",children:[(0,t.jsx)("p",{children:'"수정" 버튼을 클릭하여 굴뚝 정보를 수정할 수 있습니다.'}),(0,t.jsx)("p",{className:"text-sm italic",children:"⚠️ 수정 시 고객사에 알림이 전송되며, 모든 수정 이력이 자동으로 기록됩니다."})]})]}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"font-semibold text-base mb-2",children:"\uD83D\uDCE4 일괄업로드"}),(0,t.jsxs)("div",{className:"space-y-2 text-gray-600 dark:text-gray-400",children:[(0,t.jsx)("p",{children:'"일괄업로드" 버튼을 클릭하여 CSV 파일로 여러 굴뚝을 한 번에 등록할 수 있습니다.'}),(0,t.jsx)("p",{className:"text-sm italic",children:"\uD83D\uDCA1 양식 다운로드 후 작성하여 업로드하세요."})]})]}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"font-semibold text-base mb-2",children:"\uD83D\uDD14 알림 기능"}),(0,t.jsxs)("ul",{className:"list-disc list-inside text-gray-600 dark:text-gray-400 space-y-1",children:[(0,t.jsx)("li",{children:"고객사가 굴뚝 정보를 수정하면 실시간 알림을 받습니다"}),(0,t.jsx)("li",{children:"고객사가 굴뚝 확인 완료 시 알림을 받습니다"}),(0,t.jsx)("li",{children:"우측 상단 알림 아이콘에서 확인할 수 있습니다"})]})]})]})]})})]})}function g(){let{user:e}=(0,l.a)(),a=null==e?void 0:e.role,[s,m]=(0,r.useState)([]),[x,g]=(0,r.useState)(""),[y,p]=(0,r.useState)("전체"),[j,b]=(0,r.useState)(!1),[f,N]=(0,r.useState)(!1),[v,k]=(0,r.useState)(!1),[w,C]=(0,r.useState)(null),[D,T]=(0,r.useState)(!1),S=e=>{C(e),k(!0)};(0,r.useEffect)(()=>{A()},[]);let A=async()=>{try{let e=await fetch("/api/stacks"),a=await e.json();m(a.data||[])}catch(e){}},E=(0,r.useMemo)(()=>Array.from(new Map(s.map(e=>[e.customer.id,e.customer])).values()).sort((e,a)=>"CUST999"===e.code?1:"CUST999"===a.code?-1:(e.code||e.name).localeCompare(a.code||a.name)),[s]),Z=(0,r.useMemo)(()=>s.filter(e=>{if(!x){let a="전체"===y||e.customer.name===y,s=!!j||!1!==e.customer.isActive,t=!!f||!1!==e.isActive;return a&&s&&t}let a=x.toLowerCase(),s=e.name&&e.name.toLowerCase().includes(a)||e.code&&e.code.toLowerCase().includes(a)||e.fullName&&e.fullName.toLowerCase().includes(a)||e.facilityType&&e.facilityType.toLowerCase().includes(a)||e.customer.name&&e.customer.name.toLowerCase().includes(a)||e.customer.code&&e.customer.code.toLowerCase().includes(a),t="전체"===y||e.customer.name===y,r=!!j||!1!==e.customer.isActive,l=!!f||!1!==e.isActive;return s&&t&&r&&l}).sort((e,a)=>{if(e.isVerified!==a.isVerified)return e.isVerified?1:-1;let s=e.verifiedAt||e.createdAt||e.id,t=a.verifiedAt||a.createdAt||a.id;if(s!==t)return t.localeCompare(s);let r=(e.customer.code||e.customer.name).localeCompare(a.customer.code||a.customer.name);return 0!==r?r:(e.name||"").localeCompare(a.name||"")}),[s,x,y,j,f]),P=async e=>{try{let a=await e.text(),s=await fetch("/api/stacks/bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvText:a})}),t=await s.json();if(!s.ok||!t.success)return{success:!1,message:t.error||t.message||"업로드 실패"};if(A(),t.errors&&t.errors.length>0){let e=t.errors.join("\n");return{success:!0,message:"".concat(t.message,"\n\n실패 상세:\n").concat(e),count:t.count}}return{success:!0,message:t.message||"업로드 성공",count:t.count}}catch(e){return{success:!1,message:e.message||"오류 발생"}}};return(0,t.jsxs)("section",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-2.5",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,t.jsx)("h1",{className:"text-lg font-semibold whitespace-nowrap mb-1.5",children:"굴뚝 관리"}),(0,t.jsx)("span",{className:"text-gray-300 dark:text-gray-600 mb-1.5",children:"|"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"검색"}),(0,t.jsx)(i.Z,{className:"text-sm h-8",style:{width:"352px",minWidth:"352px"},value:x,onChange:e=>g(e.target.value),placeholder:"굴뚝번호, 코드, 명칭, 배출시설, 고객사 등"})]}),(0,t.jsxs)("div",{className:"flex flex-col",style:{width:"176px",minWidth:"176px"},children:[(0,t.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"고객사"}),(0,t.jsxs)("select",{className:"text-sm h-8 w-full border rounded px-2 bg-white dark:bg-gray-800",value:y,onChange:e=>p(e.target.value),children:[(0,t.jsx)("option",{children:"전체"}),E.map(e=>(0,t.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer mb-1.5 whitespace-nowrap ml-auto",children:[(0,t.jsx)("input",{type:"checkbox",checked:j,onChange:e=>b(e.target.checked),className:"rounded"}),"비활성 고객사"]}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer mb-1.5 whitespace-nowrap",children:[(0,t.jsx)("input",{type:"checkbox",checked:f,onChange:e=>N(e.target.checked),className:"rounded"}),"비활성 굴뚝"]}),(0,t.jsxs)("div",{className:"flex gap-1.5 mb-1.5",children:[(0,t.jsx)(h,{}),("SUPER_ADMIN"===a||"ORG_ADMIN"===a)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Z,{size:"sm",variant:"secondary",onClick:()=>{let e=new Blob(["\uFEFF"+[["굴뚝번호","굴뚝코드","굴뚝 정식 명칭","배출시설 종류","굴뚝 높이(m)","굴뚝 안지름(m)","굴뚝 종별(종)","고객사","고객사코드","생성일"],...Z.map(e=>[e.name||"",e.code||"",e.fullName||"",e.facilityType||"",e.height||"",e.diameter||"",e.category||"",e.customer.name||"",e.customer.code||"",new Date(e.createdAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\. /g,"-").replace(".","")])].map(e=>e.map(e=>'"'.concat(String(null!=e?e:"").replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download="stacks_".concat(new Date().toISOString().slice(0,10),".csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},children:"Excel"}),(0,t.jsx)(n.Z,{size:"sm",variant:"secondary",onClick:()=>T(!0),children:"일괄업로드"}),(0,t.jsx)(n.Z,{size:"sm",onClick:()=>k(!0),children:"+ 신규 추가"})]})]})]})}),("SUPER_ADMIN"===a||"ORG_ADMIN"===a)&&Z.length>0&&(x||"전체"!==y)&&(0,t.jsxs)("div",{className:"flex gap-2 items-center bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,t.jsxs)("span",{className:"text-sm text-blue-700 dark:text-blue-300 font-medium",children:["검색 결과 ",Z.length,"건"]}),(0,t.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,t.jsx)(n.Z,{size:"sm",variant:"secondary",onClick:async()=>{if(!confirm("검색된 ".concat(Z.length,"개 굴뚝을 모두 비활성화하시겠습니까?")))return;let e=0;for(let a of Z)try{(await fetch("/api/stacks/".concat(a.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!1})})).ok&&e++}catch(e){}alert("".concat(e,"개 굴뚝을 비활성화했습니다.")),A()},children:"전체 비활성화"}),(0,t.jsx)(n.Z,{size:"sm",variant:"secondary",onClick:async()=>{if(Z.some(e=>{var a;return(null===(a=e._count)||void 0===a?void 0:a.measurements)&&e._count.measurements>0})){alert("측정 기록이 있는 굴뚝이 포함되어 있어 삭제할 수 없습니다. 비활성화를 사용하세요.");return}if(!confirm("검색된 ".concat(Z.length,"개 굴뚝을 모두 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.")))return;let e=0;for(let a of Z)try{(await fetch("/api/stacks/".concat(a.id),{method:"DELETE"})).ok&&e++}catch(e){}alert("".concat(e,"개 굴뚝을 삭제했습니다.")),A()},className:"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",children:"전체 삭제"})]})]}),(0,t.jsx)("div",{className:"hidden md:block rounded-lg border max-h-[calc(100vh-180px)] overflow-y-auto",children:(0,t.jsxs)(c.iA,{className:"w-full table-fixed",children:[(0,t.jsx)(c.hr,{className:"bg-gray-50 dark:bg-white/10 sticky top-0 z-10",children:(0,t.jsxs)(c.Tr,{children:[(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"상태"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"굴뚝번호"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"굴뚝코드"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"굴뚝 정식 명칭"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"배출시설 종류"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"높이(m)"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"안지름(m)"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"종별"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"고객사"}),(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"생성일"}),("SUPER_ADMIN"===a||"ORG_ADMIN"===a)&&(0,t.jsx)(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"액션"})]})}),(0,t.jsx)(c.p3,{children:0===Z.length?(0,t.jsx)(c.Tr,{children:(0,t.jsx)(c.Td,{colSpan:"SUPER_ADMIN"===a||"ORG_ADMIN"===a?11:10,className:"text-center text-gray-500 py-8",children:"등록된 굴뚝이 없습니다"})}):Z.map(e=>(0,t.jsx)(u,{stack:e,role:a,onRefetch:A,onEdit:S},e.id))})]})}),(0,t.jsx)("div",{className:"md:hidden space-y-3",children:0===Z.length?(0,t.jsx)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-6 text-center text-gray-500",children:"등록된 굴뚝이 없습니다"}):Z.map(e=>{var s,r,l;let c=!1!==e.isActive,n=!1!==e.customer.isActive;return(0,t.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-2 ".concat(c&&n?"":"opacity-50"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"inline-block px-2 py-0.5 rounded text-xs ".concat(c?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:c?"활성":"비활성"}),("SUPER_ADMIN"===a||"ORG_ADMIN"===a)&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>S(e),className:"text-xs text-blue-600 hover:underline",children:"수정"}),(0,t.jsx)("button",{onClick:async()=>{try{(await fetch("/api/stacks/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!e.isActive})})).ok?A():alert("상태 변경 실패")}catch(e){alert("오류 발생")}},className:"text-xs text-blue-600 hover:underline",children:c?"비활성화":"활성화"}),!c&&!(null===(s=e._count)||void 0===s?void 0:s.measurements)&&(0,t.jsx)("button",{onClick:async()=>{if(confirm('"'.concat(e.name,'" 굴뚝을 삭제하시겠습니까?')))try{(await fetch("/api/stacks/".concat(e.id),{method:"DELETE"})).ok?A():alert("삭제 실패")}catch(e){alert("오류 발생")}},className:"text-xs text-gray-600 hover:underline",children:"삭제"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFED 번호:"})," ",e.name]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCB 코드:"})," ",e.code||"-"]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCD 정식명:"})," ",e.fullName||"-"]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"⚙️ 시설:"})," ",e.facilityType||"-"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCF 높이:"})," ",null!==(r=e.height)&&void 0!==r?r:"-","m"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"⭕ 안지름:"})," ",null!==(l=e.diameter)&&void 0!==l?l:"-","m"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFF7️ 종별:"})," ",e.category||"-"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCC5 생성:"})," ",new Date(e.createdAt).toLocaleDateString("ko-KR",{month:"2-digit",day:"2-digit"})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFE2 고객사:"})," ",e.customer.name,e.customer.code&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[" (",e.customer.code,")"]}),!n&&(0,t.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 ml-1",children:"비활성"})]})]})]},e.id)})}),(0,t.jsx)(d,{isOpen:v,onClose:()=>{k(!1),C(null)},onSuccess:()=>{A(),k(!1),C(null)},stack:w}),(0,t.jsx)(o.Z,{isOpen:D,onClose:()=>T(!1),title:"굴뚝 일괄업로드",templateHeaders:["고객사코드","굴뚝번호","굴뚝코드","굴뚝 정식 명칭","배출시설 종류","위치","굴뚝 높이(m)","굴뚝 안지름(m)","굴뚝 종별(종)"],exampleRow:["CUST001","ST-001","C-ST01001","1호 소각로 굴뚝","소각시설","공장동 옥상","25.5","0.8","1종"],templateFileName:"굴뚝_일괄업로드_양식.csv",onUpload:P,parseInstructions:"고객사코드와 굴뚝번호는 필수 항목입니다. 고객사코드는 기존에 등록된 고객사의 코드여야 합니다."})]})}},3158:function(e,a,s){"use strict";s.d(a,{Z:function(){return c}});var t=s(7437),r=s(2265),l=s(6334);function c(e){let{isOpen:a,onClose:s,title:c,templateHeaders:n,exampleRow:i,templateFileName:d,onUpload:o,parseInstructions:m="양식에 맞게 작성한 CSV 파일을 업로드하세요."}=e,[x,u]=(0,r.useState)(null),[h,g]=(0,r.useState)(!1),[y,p]=(0,r.useState)(""),j=async()=>{if(!x){p("파일을 선택해주세요.");return}g(!0),p("");try{let e=await o(x);if(e.success){let a=e.message||"업로드 완료";p("✅ ".concat(a)),u(null)}else p("❌ ".concat(e.message||"업로드 실패"))}catch(e){p("❌ 오류: ".concat(e.message||"업로드 중 문제가 발생했습니다."))}finally{g(!1)}},b=()=>{h||(u(null),p(""),s())};return a?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:b,children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:c}),(0,t.jsx)("button",{onClick:b,disabled:h,className:"text-gray-500 hover:text-gray-700 disabled:opacity-50",children:"✕"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"\uD83D\uDCCB 업로드 절차"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-xs",children:[(0,t.jsx)("li",{children:'아래 "업로드 양식 다운로드" 버튼을 클릭하여 CSV 양식을 다운로드합니다.'}),(0,t.jsx)("li",{children:"다운로드한 양식에 데이터를 입력합니다. (예시 행 참고)"}),(0,t.jsx)("li",{children:'"파일 선택" 버튼을 클릭하여 작성한 CSV 파일을 선택합니다.'}),(0,t.jsx)("li",{children:'"업로드" 버튼을 클릭하여 데이터를 등록합니다.'})]})]}),(0,t.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:m}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(l.Z,{variant:"secondary",onClick:()=>{let e=new Blob(["\uFEFF"+n.map(e=>'"'.concat(e,'"')).join(",")+"\n"+i.map(e=>'"'.concat(e,'"')).join(",")+"\n"],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download=d,s.click(),URL.revokeObjectURL(a)},disabled:h,className:"flex-1",children:"\uD83D\uDCE5 업로드 양식 다운로드"})}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)("label",{className:"flex-1",children:[(0,t.jsx)("div",{className:"px-4 py-2 border-2 border-dashed rounded cursor-pointer text-center transition-colors ".concat(x?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400"," ").concat(h?"opacity-50 cursor-not-allowed":""),children:x?(0,t.jsxs)("span",{className:"text-sm",children:["\uD83D\uDCC4 ",x.name]}):(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"\uD83D\uDCC1 파일 선택 (CSV)"})}),(0,t.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>{var a;let s=null===(a=e.target.files)||void 0===a?void 0:a[0];s&&(u(s),p(""))},disabled:h})]})}),(0,t.jsx)(l.Z,{onClick:j,disabled:!x||h,className:"w-full",children:h?"업로드 중...":"업로드"})]}),y&&(0,t.jsx)("div",{className:"text-sm p-4 rounded border-2 ".concat(y.startsWith("✅")?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border-green-500":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border-red-500"),children:(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("pre",{className:"whitespace-pre-wrap font-sans",children:y}),(0,t.jsx)(l.Z,{size:"sm",onClick:()=>{p(""),b()},className:"self-end",children:"확인"})]})})]}),!y&&(0,t.jsx)("div",{className:"mt-6 flex justify-end gap-2",children:(0,t.jsx)(l.Z,{variant:"secondary",onClick:b,disabled:h,children:"닫기"})})]})}):null}},6334:function(e,a,s){"use strict";s.d(a,{Z:function(){return c}});var t=s(7437);s(2265);let r={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},l={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function c(e){let{variant:a="primary",size:s="md",className:c="",...n}=e;return(0,t.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(r[a]," ").concat(l[s]," ").concat(c),...n})}},2827:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});var t=s(7437);function r(e){let{className:a="",...s}=e;return(0,t.jsx)("input",{className:"".concat("rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20"," ").concat(a),...s})}s(2265)},1515:function(e,a,s){"use strict";s.d(a,{Td:function(){return d},Th:function(){return i},Tr:function(){return n},hr:function(){return l},iA:function(){return r},p3:function(){return c}});var t=s(7437);function r(e){let{className:a="",...s}=e;return(0,t.jsx)("table",{className:"w-full text-sm border-collapse ".concat(a),...s})}function l(e){return(0,t.jsx)("thead",{...e})}function c(e){return(0,t.jsx)("tbody",{...e})}function n(e){return(0,t.jsx)("tr",{className:"border-b last:border-0 border-gray-200 dark:border-white/10",...e})}function i(e){let{className:a="",...s}=e;return(0,t.jsx)("th",{className:"text-left py-2 px-3 font-medium text-gray-600 dark:text-gray-300 ".concat(a),...s})}function d(e){let{className:a="",...s}=e;return(0,t.jsx)("td",{className:"py-2 px-3 ".concat(a),...s})}s(2265)},2397:function(e,a,s){"use strict";s.d(a,{H:function(){return d},a:function(){return o}});var t=s(7437),r=s(2265),l=s(605),c=s(9376);function n(){return(0,t.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900",children:[(0,t.jsxs)("div",{className:"mb-16",children:[(0,t.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-white text-center",children:"오염물질 측정 관리 시스템"}),(0,t.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:"Pollutant Measurement Management System"})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-gray-200 dark:border-gray-700 border-t-blue-600 rounded-full animate-spin"})}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm font-medium",children:"로딩 중..."})]}),(0,t.jsx)("div",{className:"mt-16"})]})}let i=(0,r.createContext)(null);function d(e){let{children:a}=e,{data:s,status:d}=(0,l.useSession)(),[o,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(!0),h=(0,c.usePathname)();(0,r.useEffect)(()=>{"loading"!==d&&u(!1),(null==s?void 0:s.user)?m(s.user):"unauthenticated"===d&&m(null)},[s,d]);let g="loading"===d||x;return!g||"/login"===h||(null==h?void 0:h.startsWith("/register"))||(null==h?void 0:h.startsWith("/invite"))||(null==h?void 0:h.startsWith("/auth"))?(0,t.jsx)(i.Provider,{value:{user:o,loading:g},children:a}):(0,t.jsx)(n,{})}function o(){let e=(0,r.useContext)(i);if(!e)throw Error("AuthProvider is missing");return e}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=3676)}),_N_E=e.O()}]);