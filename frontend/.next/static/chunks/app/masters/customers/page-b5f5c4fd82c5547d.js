(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8201],{7644:function(e,t,s){Promise.resolve().then(s.bind(s,3241))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},3241:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(7437),r=s(2265),n=s(2397),l=s(2891);function i(){let{user:e}=(0,n.a)(),[t,s]=(0,r.useState)(new Set),[a,l]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!(null==e?void 0:e.id)){s(new Set),l(!1);return}if("SUPER_ADMIN"===e.role){s(new Set(["*"])),l(!1);return}(async()=>{try{let t=await fetch("/api/users/".concat(e.id,"/permissions"));if(t.ok){let e=await t.json();s(new Set(e.permissions||[]))}}catch(e){}finally{l(!1)}})()},[null==e?void 0:e.id,null==e?void 0:e.role]);let i=e=>{if(a)return!1;if(t.has("*")||t.has(e))return!0;let s=e.split(".")[0];return!!t.has("".concat(s,".*"))};return{hasPermission:i,hasAnyPermission:e=>e.some(e=>i(e)),hasAllPermissions:e=>e.every(e=>i(e)),loading:a,permissions:Array.from(t)}}var d=s(2827),c=s(6334),o=s(1515);function x(e){let{isOpen:t,onClose:s,onSuccess:n,customer:l}=e,i=!!l,[o,x]=(0,r.useState)({code:(null==l?void 0:l.code)||"",name:(null==l?void 0:l.name)||"",businessNumber:(null==l?void 0:l.businessNumber)||"",corporateNumber:(null==l?void 0:l.corporateNumber)||"",fullName:(null==l?void 0:l.fullName)||"",representative:(null==l?void 0:l.representative)||"",siteType:(null==l?void 0:l.siteType)||"",address:(null==l?void 0:l.address)||"",businessType:(null==l?void 0:l.businessType)||"",industry:(null==l?void 0:l.industry)||"",siteCategory:(null==l?void 0:l.siteCategory)||""}),[u,m]=(0,r.useState)(!1),[g,h]=(0,r.useState)("");(0,r.useEffect)(()=>{l?x({code:l.code||"",name:l.name||"",businessNumber:l.businessNumber||"",corporateNumber:l.corporateNumber||"",fullName:l.fullName||"",representative:l.representative||"",siteType:l.siteType||"",address:l.address||"",businessType:l.businessType||"",industry:l.industry||"",siteCategory:l.siteCategory||""}):x({code:"",name:"",businessNumber:"",corporateNumber:"",fullName:"",representative:"",siteType:"",address:"",businessType:"",industry:"",siteCategory:""}),h("")},[l,t]);let p=(e,t)=>{x(s=>{let a={...s,[e]:t};return!i&&"businessNumber"===e&&t&&(a.code=t),a})},y=async e=>{if(e.preventDefault(),h(""),!o.name){h("고객사명은 필수입니다.");return}if(!i&&!o.businessNumber){h("사업자등록번호는 필수입니다.");return}m(!0);try{let e=i?"/api/customers/".concat(l.id):"/api/customers",t=await fetch(e,{method:i?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok){let e=await t.json();throw Error(e.error||"저장 실패")}i||x({code:"",name:"",businessNumber:"",corporateNumber:"",fullName:"",representative:"",siteType:"",address:"",businessType:"",industry:"",siteCategory:""}),n(),s()}catch(e){h(e.message)}finally{m(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:s,children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b px-6 py-4 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:i?"고객사 정보 수정":"신규 고객사 추가"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"✕"})]}),(0,a.jsxs)("form",{onSubmit:y,className:"p-6 space-y-4",children:[g&&(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-4 py-3 rounded",children:g}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["고객사명 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(d.Z,{value:o.name,onChange:e=>p("name",e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["사업자등록번호 ",!i&&(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(d.Z,{value:o.businessNumber,onChange:e=>p("businessNumber",e.target.value),placeholder:"123-45-67890",required:!i,disabled:i})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["고객사 코드 ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)(d.Z,{value:o.code,onChange:e=>p("code",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["고객사명(정식) ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)(d.Z,{value:o.fullName,onChange:e=>p("fullName",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["대표자 ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)(d.Z,{value:o.representative,onChange:e=>p("representative",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["사업장 구분 ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)(d.Z,{value:o.siteType,onChange:e=>p("siteType",e.target.value)})]}),(0,a.jsxs)("div",{className:"col-span-2 space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["주소 ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)(d.Z,{value:o.address,onChange:e=>p("address",e.target.value),className:"w-full"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["업태 ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)(d.Z,{value:o.businessType,onChange:e=>p("businessType",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["업종 ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)("textarea",{value:o.industry,onChange:e=>p("industry",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:2})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["사업장 종별 ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)(d.Z,{value:o.siteCategory,onChange:e=>p("siteCategory",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["법인등록번호 ",(0,a.jsx)("span",{className:"text-gray-400",children:"(선택)"})]}),(0,a.jsx)(d.Z,{value:o.corporateNumber,onChange:e=>p("corporateNumber",e.target.value),placeholder:"123456-1234567"})]})]}),!i&&(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["\uD83D\uDCA1 고객사 정보만 저장됩니다. 저장 후 ",(0,a.jsx)("strong",{children:"초대 링크"}),"를 생성하여 고객사 관리자를 초대하세요."]})}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)(c.Z,{type:"button",variant:"secondary",onClick:s,className:"flex-1",children:"취소"}),(0,a.jsx)(c.Z,{type:"submit",disabled:u,className:"flex-1",children:u?"저장 중...":"저장"})]})]})]})}):null}function u(e){let{isOpen:t,onClose:s,customer:n,onSuccess:l}=e,[i,d]=(0,r.useState)(""),[c,o]=(0,r.useState)(""),[x,u]=(0,r.useState)(""),[m,g]=(0,r.useState)("ADMIN"),[h,p]=(0,r.useState)(""),[y,b]=(0,r.useState)(7),[f,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(""),k=(null==n?void 0:n.siteType)||"-";if(!t||!n)return null;let w=async e=>{e.preventDefault(),j(!0);try{let e=await fetch("/api/customer-invitations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:n.id,adminEmail:i,adminName:c,adminPhone:x,suggestedRole:m,roleNote:h,siteType:null==n?void 0:n.siteType,expiryDays:y})}),t=await e.json();if(e.ok){if(t.isExistingEmail){alert(t.autoConnectMessage),D();return}N(t.inviteUrl),l()}else 400===e.status&&t.inviteUrl?confirm("이미 활성화된 초대 링크가 있습니다.\n\n기존 링크를 사용하시겠습니까?\n(취소를 누르면 기존 링크를 무효화하고 새 링크를 생성합니다)")?(N(t.inviteUrl),l()):await C():alert(t.error||"초대 링크 생성 실패")}catch(e){alert("초대 링크 생성 중 오류가 발생했습니다.")}finally{j(!1)}},C=async()=>{j(!0);try{let e=await fetch("/api/customer-invitations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:n.id,adminEmail:i,adminName:c,adminPhone:x,suggestedRole:m,roleNote:h,siteType:null==n?void 0:n.siteType,expiryDays:y,forceCreate:!0})}),t=await e.json();if(e.ok){if(t.isExistingEmail){alert(t.autoConnectMessage),D();return}N(t.inviteUrl),l()}else alert(t.error||"초대 링크 생성 실패")}catch(e){alert("초대 링크 생성 중 오류가 발생했습니다.")}finally{j(!1)}},D=()=>{d(""),o(""),u(""),g("ADMIN"),p(""),b(7),N(""),s()};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"고객사 초대 링크 생성"}),v?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded",children:[(0,a.jsx)("p",{className:"text-sm text-green-800 mb-2",children:"✅ 초대 링크가 생성되었습니다!"}),(0,a.jsx)("div",{className:"bg-white p-3 rounded border break-all text-sm",children:v})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"이 링크를 고객사 담당자에게 전달하세요. 링크를 통해 회원가입하면 자동으로 연결됩니다."})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(v),alert("링크가 복사되었습니다!")},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"\uD83D\uDCCB 링크 복사"}),(0,a.jsx)("button",{onClick:D,className:"flex-1 px-4 py-2 border rounded hover:bg-gray-50",children:"닫기"})]})]}):(0,a.jsxs)("form",{onSubmit:w,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"고객사"}),(0,a.jsxs)("div",{className:"p-3 bg-gray-50 rounded border",children:[(0,a.jsx)("div",{className:"font-medium",children:n.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:n.businessNumber})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["담당자 이메일 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"email",value:i,onChange:e=>d(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"example@company.com",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"해당 이메일로만 가입이 가능합니다."})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"담당자 이름 (선택)"}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>o(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"홍길동"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"담당자 전화번호 (선택)"}),(0,a.jsx)("input",{type:"tel",value:x,onChange:e=>u(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"010-1234-5678"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"권장 역할"}),(0,a.jsxs)("select",{value:m,onChange:e=>g(e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"ADMIN",children:"관리자 (CUSTOMER_ADMIN)"}),(0,a.jsx)("option",{value:"USER",children:"일반 사용자 (CUSTOMER_USER)"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"초대받은 사람이 가입 시 이 역할로 기본 설정됩니다."})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"역할 설명 (선택)"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"예: 환경안전팀장급"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"담당자의 직급이나 역할을 메모할 수 있습니다."})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"사업장구분"}),(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded border text-gray-700",children:k}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"고객사 정보의 사업장구분이 자동으로 표시됩니다."})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"링크 유효기간"}),(0,a.jsxs)("select",{value:y,onChange:e=>b(Number(e.target.value)),className:"w-full border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:1,children:"1일"}),(0,a.jsx)("option",{value:3,children:"3일"}),(0,a.jsx)("option",{value:7,children:"7일 (권장)"}),(0,a.jsx)("option",{value:14,children:"14일"}),(0,a.jsx)("option",{value:30,children:"30일"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:D,className:"flex-1 px-4 py-2 border rounded hover:bg-gray-50",disabled:f,children:"취소"}),(0,a.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",disabled:f,children:f?"생성 중...":"초대 링크 생성"})]})]})]})})}var m=s(3158);function g(e){let{isOpen:t,onClose:s}=e,{hasPermission:n}=i(),[l,d]=(0,r.useState)([]),[c,o]=(0,r.useState)(!1),[x,u]=(0,r.useState)(null),[m,g]=(0,r.useState)({startDate:"",endDate:"",memo:""});n("contract.view");let h=n("contract.create"),p=n("contract.update"),y=n("contract.delete");(0,r.useEffect)(()=>{t&&b()},[t]);let b=async()=>{o(!0);try{let e=await fetch("/api/contracts/customers"),t=await e.json();e.ok?d(t.customers||[]):alert(t.error||"고객사 목록 조회 실패")}catch(e){alert("고객사 목록 조회 중 오류가 발생했습니다.")}finally{o(!1)}},f=(e,t)=>{u(e),t?g({startDate:new Date(t.startDate).toISOString().split("T")[0],endDate:new Date(t.endDate).toISOString().split("T")[0],memo:t.memo||""}):g({startDate:"",endDate:"",memo:""})},j=async e=>{if(!m.startDate||!m.endDate){alert("계약 시작일과 종료일을 입력해주세요.");return}o(!0);try{let t=await fetch("/api/contracts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e,startDate:m.startDate,endDate:m.endDate,memo:m.memo})}),s=await t.json();t.ok?(alert("계약이 저장되었습니다."),u(null),b()):alert(s.error||"저장 실패")}catch(e){alert("저장 중 오류가 발생했습니다.")}finally{o(!1)}},v=async e=>{if(confirm("계약을 삭제하시겠습니까?")){o(!0);try{let t=await fetch("/api/contracts/".concat(e),{method:"DELETE"});if(t.ok)alert("계약이 삭제되었습니다."),b();else{let e=await t.json();alert(e.error||"삭제 실패")}}catch(e){alert("삭제 중 오류가 발생했습니다.")}finally{o(!1)}}},N=e=>{if(!e)return(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300",children:"미등록"});let{daysRemaining:t}=e;return t<0?(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200",children:"만료"}):t<=7?(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-200",children:"긴급"}):t<=28?(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-200",children:"주의"}):(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200",children:"정상"})};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-[95vw] max-h-[95vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"계약 관리"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"✕"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["총 ",l.length,"개 고객사 (잔여일 짧은 순)"]})}),c?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"로딩 중..."}):0===l.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"연결된 고객사가 없습니다."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"고객사"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"계약 시작일"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"계약 종료일"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"잔여일"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"상태"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"메모"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"액션"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:l.map(e=>{let{customer:t,contract:s}=e,r=x===t.id;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,a.jsxs)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:[t.name,t.code&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",t.code,")"]})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:r?(0,a.jsx)("input",{type:"date",value:m.startDate,onChange:e=>g({...m,startDate:e.target.value}),className:"border rounded px-2 py-1 text-sm w-full dark:bg-gray-700 dark:border-gray-600"}):s?(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:new Date(s.startDate).toLocaleDateString()}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:r?(0,a.jsx)("input",{type:"date",value:m.endDate,onChange:e=>g({...m,endDate:e.target.value}),className:"border rounded px-2 py-1 text-sm w-full dark:bg-gray-700 dark:border-gray-600"}):s?(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:new Date(s.endDate).toLocaleDateString()}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:s?(0,a.jsx)("span",{className:s.daysRemaining<0?"text-red-600 font-semibold":s.daysRemaining<=28?"text-orange-600 font-semibold":"text-gray-600 dark:text-gray-300",children:s.daysRemaining<0?"".concat(Math.abs(s.daysRemaining),"일 초과"):"".concat(s.daysRemaining,"일")}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:N(s)}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:r?(0,a.jsx)("input",{type:"text",value:m.memo,onChange:e=>g({...m,memo:e.target.value}),placeholder:"메모",className:"border rounded px-2 py-1 text-sm w-full dark:bg-gray-700 dark:border-gray-600"}):(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:(null==s?void 0:s.memo)||"-"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:r?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>j(t.id),className:"text-green-600 hover:text-green-800 dark:text-green-400 font-medium",disabled:c,children:"저장"}),(0,a.jsx)("button",{onClick:()=>u(null),className:"text-gray-600 hover:text-gray-800 dark:text-gray-400",children:"취소"})]}):(0,a.jsxs)("div",{className:"flex gap-2",children:[(h||p)&&(0,a.jsx)("button",{onClick:()=>f(t.id,s),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400",children:s?"수정":"등록"}),y&&s&&(0,a.jsx)("button",{onClick:()=>v(s.id),className:"text-red-600 hover:text-red-800 dark:text-red-400",children:"삭제"}),!h&&!p&&!y&&(0,a.jsx)("span",{className:"text-gray-400",children:"조회만"})]})})]},t.id)})})]})}),(0,a.jsx)("div",{className:"md:hidden space-y-3",children:l.map(e=>{let{customer:t,contract:s}=e,r=x===t.id;return(0,a.jsxs)("div",{className:"rounded-lg border bg-gray-50 dark:bg-gray-700 p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),t.code&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["(",t.code,")"]})]}),N(s)]}),r?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-500",children:"시작일"}),(0,a.jsx)("input",{type:"date",value:m.startDate,onChange:e=>g({...m,startDate:e.target.value}),className:"border rounded px-2 py-1 text-sm w-full dark:bg-gray-700 dark:border-gray-600 mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-500",children:"종료일"}),(0,a.jsx)("input",{type:"date",value:m.endDate,onChange:e=>g({...m,endDate:e.target.value}),className:"border rounded px-2 py-1 text-sm w-full dark:bg-gray-700 dark:border-gray-600 mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-500",children:"메모"}),(0,a.jsx)("input",{type:"text",value:m.memo,onChange:e=>g({...m,memo:e.target.value}),placeholder:"메모",className:"border rounded px-2 py-1 text-sm w-full dark:bg-gray-700 dark:border-gray-600 mt-1"})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,a.jsx)("button",{onClick:()=>j(t.id),className:"flex-1 px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:c,children:"저장"}),(0,a.jsx)("button",{onClick:()=>u(null),className:"flex-1 px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"취소"})]})]}):(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCC5 시작:"})," ",s?new Date(s.startDate).toLocaleDateString():"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCC5 종료:"})," ",s?new Date(s.endDate).toLocaleDateString():"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"⏱️ 잔여:"})," ",s?s.daysRemaining<0?"".concat(Math.abs(s.daysRemaining),"일 초과"):"".concat(s.daysRemaining,"일"):"-"]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCDD 메모:"})," ",(null==s?void 0:s.memo)||"-"]}),(0,a.jsxs)("div",{className:"col-span-2 flex gap-2 pt-2",children:[(h||p)&&(0,a.jsx)("button",{onClick:()=>f(t.id,s),className:"flex-1 px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:s?"수정":"등록"}),y&&s&&(0,a.jsx)("button",{onClick:()=>v(s.id),className:"flex-1 px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 text-sm",children:"삭제"})]})]})]},t.id)})})]})]})]})}):null}function h(e){let{isOpen:t,onClose:s,organizationId:n,onSuccess:l}=e,[i,o]=(0,r.useState)(""),[x,u]=(0,r.useState)([]),[m,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[y,b]=(0,r.useState)(null),[f,j]=(0,r.useState)(null);if(!t)return null;let v=x.filter(e=>e.isPublic),N=x.filter(e=>!e.isPublic&&e.createdBy),k=async()=>{if(!i.trim()){alert("검색어를 입력하세요.");return}p(!0);try{let e=await fetch("/api/customers?tab=search&organizationId=".concat(n,"&q=").concat(encodeURIComponent(i))),t=await e.json();e.ok?u(t.customers||[]):alert(t.error||"검색 실패")}catch(e){alert("검색 중 오류가 발생했습니다.")}finally{p(!1)}},w=async(e,t)=>{if(confirm(t?'"'.concat(e.name,'" 고객사와 내부 고객사 정보를 병합하여 연결 요청을 보내시겠습니까?'):'"'.concat(e.name,'" 고객사에 연결 요청을 보내시겠습니까?'))){g(!0);try{let s={customerId:e.id,organizationId:n};t&&(s.proposedData={internalCustomerId:t.id,code:t.code,corporateNumber:t.corporateNumber,fullName:t.fullName,representative:t.representative,siteType:t.siteType,address:t.address,businessType:t.businessType,industry:t.industry,siteCategory:t.siteCategory});let a=await fetch("/api/customer-organizations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await a.json();a.ok?(alert(r.message||"연결 요청을 보냈습니다."),C(),l()):alert(r.error||"연결 요청 실패")}catch(e){alert("연결 요청 중 오류가 발생했습니다.")}finally{g(!1)}}},C=()=>{o(""),u([]),b(null),j(null),s()};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"고객사 검색 및 연결"}),(0,a.jsx)("button",{onClick:C,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"✕"})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d.Z,{value:i,onChange:e=>o(e.target.value),placeholder:"회사명 또는 사업자번호 입력",className:"flex-1",onKeyPress:e=>"Enter"===e.key&&k()}),(0,a.jsx)(c.Z,{onClick:k,disabled:h,children:h?"검색 중...":"검색"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"\uD83D\uDCA1 회사명 일부 또는 사업자번호(하이픈 유무 무관)로 검색하세요."})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:0===x.length?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:h?"검색 중...":"검색 결과가 없습니다."}):(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300",children:["고객사(가입) (",v.length,")"]}),(0,a.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,a.jsxs)("div",{onClick:()=>b(e),className:"border rounded-lg p-3 cursor-pointer transition-colors ".concat((null==y?void 0:y.id)===e.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:e.name}),e.siteType&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.siteType,")"]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.businessNumber||"-"})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300",children:["고객사(내부) (",N.length,")"]}),(0,a.jsx)("div",{className:"space-y-2",children:N.map(e=>(0,a.jsxs)("div",{onClick:()=>j(e),className:"border rounded-lg p-3 cursor-pointer transition-colors ".concat((null==f?void 0:f.id)===e.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:e.name}),e.siteType&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.siteType,")"]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.businessNumber||"-"})]},e.id))})]})]})}),(0,a.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[y&&f&&(0,a.jsx)("span",{className:"text-blue-600 dark:text-blue-400",children:"\uD83D\uDCA1 병합 연결: 내부 정보가 가입 고객사에 추가됩니다"}),y&&!f&&(0,a.jsx)("span",{children:"일반 연결 요청"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.Z,{variant:"secondary",onClick:C,children:"닫기"}),(0,a.jsx)(c.Z,{onClick:()=>{if(!y){alert("공개 고객사를 선택하세요.");return}w(y,f)},disabled:!y||m,children:f?"병합 연결":"연결 요청"})]})]})]})})}var p=s(8653);function y(e){let{isOpen:t,onClose:s}=e;return(0,a.jsx)(p.Z,{isOpen:t,onClose:s,title:"고객사 관리 도움말",sections:[{id:"create",title:"신규 생성",content:'\n<h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; font-weight: 600;">개별 생성</h3>\n<ol style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li><strong>신규 등록</strong> 버튼 클릭</li>\n  <li>필수 정보 입력:\n    <ul style="margin: 8px 0; padding-left: 24px;">\n      <li>고객사명</li>\n      <li>사업자등록번호</li>\n      <li>사업장 구분 (1사업장, 2사업장 등)</li>\n    </ul>\n  </li>\n  <li>선택 정보 입력 (주소, 대표자, 업태/업종 등)</li>\n  <li><strong>등록</strong> 버튼으로 저장</li>\n</ol>\n\n<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">일괄 업로드</h3>\n<ol style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li><strong>일괄 업로드</strong> 버튼 클릭</li>\n  <li>Excel/CSV 템플릿 다운로드</li>\n  <li>고객사 정보 입력</li>\n  <li>파일 업로드</li>\n  <li>검증 후 일괄 등록</li>\n</ol>\n\n<div style="padding: 12px 16px; background-color: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px; margin-top: 16px;">\n  <strong>\uD83D\uDCA1 참고:</strong> 같은 사업자번호로 여러 사업장 생성 가능\n</div>\n      '.trim()},{id:"invitation",title:"초대 링크 연결",content:'\n<h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; font-weight: 600;">초대 링크 생성</h3>\n<ol style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li><strong>내부</strong> 탭에서 고객사 선택</li>\n  <li><strong>초대 링크</strong> 버튼 클릭</li>\n  <li>관리자 정보 입력:\n    <ul style="margin: 8px 0; padding-left: 24px;">\n      <li>이메일</li>\n      <li>이름</li>\n      <li>연락처</li>\n      <li>권한 (관리자/일반)</li>\n    </ul>\n  </li>\n  <li>유효기간 설정 (기본 7일)</li>\n</ol>\n\n<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">기존 계정이 있는 경우</h3>\n<div style="margin-bottom: 24px; line-height: 1.8;">\n  <p style="margin: 0 0 12px 0;"><strong>같은 사업자번호 내 동일 이메일</strong>이 이미 가입되어 있으면:</p>\n  <ul style="margin: 0; padding-left: 24px;">\n    <li>초대 링크가 생성되지 않음</li>\n    <li>안내 메시지 표시: "이미 연결된 계정입니다. 고객시스템에서 승인하면 자동 연결됩니다."</li>\n    <li>고객사 시스템의 <strong>환경측정기업관리</strong> 메뉴에 승인 대기 상태로 표시</li>\n    <li>고객이 승인하면 새 사업장 자동 연결</li>\n  </ul>\n</div>\n\n<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">기존 계정이 없는 경우</h3>\n<ul style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li>초대 링크 생성 및 표시</li>\n  <li>링크 복사 버튼으로 클립보드에 복사</li>\n  <li>이메일, 메신저, 문자 등으로 직접 전달</li>\n  <li>고객이 링크로 접속하여 회원가입</li>\n  <li>가입 완료 시 자동 연결</li>\n</ul>\n\n<div style="padding: 12px 16px; background-color: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px; margin-top: 16px;">\n  <strong>\uD83D\uDCA1 참고:</strong><br/>\n  • 같은 사업자번호의 다른 사업장에 이미 가입한 이메일은 자동 연결<br/>\n  • 초대 링크는 유효기간 내 1회만 사용 가능\n</div>\n      '.trim()},{id:"search",title:"검색 연결",content:'\n<h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; font-weight: 600;">신규 검색 연결</h3>\n<ol style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li><strong>연결</strong> 탭으로 이동</li>\n  <li><strong>신규 검색 연결</strong> 버튼 클릭</li>\n  <li>고객사 유형 선택:\n    <ul style="margin: 8px 0; padding-left: 24px;">\n      <li><strong>고객사(가입)</strong>: 이미 시스템에 가입한 고객사</li>\n      <li><strong>고객사(내부)</strong>: 내부에서 생성한 미연결 고객사</li>\n    </ul>\n  </li>\n  <li>검색 조건 입력 (고객사명, 사업자번호 등)</li>\n  <li>검색 결과에서 선택</li>\n  <li><strong>연결 요청</strong> 버튼 클릭</li>\n</ol>\n\n<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">연결 승인</h3>\n<ul style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li>고객사 시스템에서 연결 요청 확인</li>\n  <li>고객이 승인하면 연결 완료</li>\n  <li><strong>연결</strong> 탭에서 연결 상태 확인</li>\n</ul>\n\n<div style="padding: 12px 16px; background-color: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px; margin-top: 16px;">\n  <strong>\uD83D\uDCA1 참고:</strong><br/>\n  • 고객사(가입): 이미 다른 환경측정기업과 연결된 고객사<br/>\n  • 고객사(내부): 아직 연결되지 않은 내부 생성 고객사\n</div>\n      '.trim()},{id:"management",title:"관리 기능",content:'\n<h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; font-weight: 600;">수정</h3>\n<ul style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li>각 고객사 행의 <strong>수정</strong> 버튼 클릭</li>\n  <li>정보 수정 후 저장</li>\n  <li>수정 시 고객사에 알림 전송</li>\n</ul>\n\n<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">비활성화</h3>\n<ul style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li><strong>비활성화</strong> 버튼으로 일시 중지</li>\n  <li>비활성 상태에서도 데이터 유지</li>\n  <li><strong>활성화</strong> 버튼으로 재활성화 가능</li>\n</ul>\n\n<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">삭제</h3>\n<ul style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li>비활성화된 고객사만 삭제 가능</li>\n  <li>측정 기록이 있으면 삭제 불가</li>\n  <li><strong>삭제</strong> 버튼 클릭 후 확인</li>\n</ul>\n\n<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">연결 해제</h3>\n<ul style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li><strong>연결</strong> 탭에서 연결 해제 가능</li>\n  <li>연결 해제 시 고객사 데이터는 유지</li>\n  <li>재연결 가능</li>\n</ul>\n\n<h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">탭별 필터</h3>\n<ul style="margin: 0 0 24px 0; padding-left: 24px; line-height: 1.8;">\n  <li><strong>전체</strong>: 모든 고객사 (생성 + 연결)</li>\n  <li><strong>내부</strong>: 내부 생성 미연결 고객사</li>\n  <li><strong>연결</strong>: 연결 완료된 고객사</li>\n</ul>\n\n<div style="padding: 12px 16px; background-color: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px; margin-top: 16px;">\n  <strong>\uD83D\uDCA1 참고:</strong><br/>\n  • 같은 사업자번호의 여러 사업장은 그룹으로 표시<br/>\n  • 각 사업장은 독립적으로 관리 가능\n</div>\n      '.trim()}]})}function b(e){var t,s,n,l;let{customer:i,role:d,onRefetch:c,onEdit:x,activeTab:u,onCreateInvitation:m,onRequestConnection:g,isGrouped:h=!1,isFirstInGroup:p=!1,isLastInGroup:y=!1,groupSize:b=1,isReadOnly:f=!1}=e,[j,v]=(0,r.useState)(!1),N=async()=>{if(!j){v(!0);try{(await fetch("/api/customers/".concat(i.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!i.isActive})})).ok?c():alert("상태 변경 실패")}catch(e){alert("오류 발생")}finally{v(!1)}}},k=async()=>{var e,t;if((null===(e=i._count)||void 0===e?void 0:e.measurements)>0){alert("측정 기록이 있는 고객사는 삭제할 수 없습니다. 비활성화를 사용하세요.");return}if(confirm('"'.concat(i.name,'" 고객사를 삭제하시겠습니까?\n\n굴뚝: ').concat((null===(t=i._count)||void 0===t?void 0:t.stacks)||0,"개도 함께 삭제됩니다."))){v(!0);try{let e=await fetch("/api/customers/".concat(i.id),{method:"DELETE"});if(e.ok)c();else{let t=await e.json();alert(t.error||"삭제 실패")}}catch(e){alert("오류 발생")}finally{v(!1)}}},w=!1!==i.isActive;return(0,a.jsxs)(o.Tr,{className:"".concat(w?"":"opacity-50 bg-gray-50 dark:bg-gray-900/20"," ").concat(h?p?"border-l-4 border-l-blue-400":y?"border-l-4 border-l-blue-200":"border-l-4 border-l-blue-300":""),children:[(0,a.jsx)(o.Td,{children:w?(0,a.jsx)("span",{className:"inline-block px-2 py-0.5 rounded bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 text-xs",children:"활성"}):(0,a.jsx)("span",{className:"inline-block px-2 py-0.5 rounded bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 text-xs",children:"비활성"})}),(0,a.jsxs)(o.Td,{className:"font-mono text-xs break-words",children:[i.code||"-",h&&p&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-blue-600",children:["(",b,"개 사업장)"]})]}),(0,a.jsx)(o.Td,{className:"break-words",children:i.name}),(0,a.jsx)(o.Td,{className:"font-mono text-xs break-words",children:i.businessNumber||"-"}),(0,a.jsx)(o.Td,{className:"break-words",children:i.fullName||i.name}),(0,a.jsx)(o.Td,{className:"break-words",children:i.representative||"-"}),(0,a.jsx)(o.Td,{className:"break-words",children:i._siteType||i.siteType||"-"}),(0,a.jsx)(o.Td,{className:"break-words",children:i.address||"-"}),(0,a.jsx)(o.Td,{className:"break-words",children:i.businessType||"-"}),(0,a.jsx)(o.Td,{className:"break-words",children:i.industry||"-"}),(0,a.jsx)(o.Td,{className:"break-words",children:i.siteCategory||"-"}),(0,a.jsx)(o.Td,{className:"font-mono text-xs break-words",children:i.corporateNumber||"-"}),(0,a.jsx)(o.Td,{className:"text-center",children:null!==(l=null===(t=i._count)||void 0===t?void 0:t.stacks)&&void 0!==l?l:0}),!f&&(0,a.jsx)(o.Td,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>x(i),disabled:j,className:"text-xs text-green-600 hover:underline disabled:opacity-50",children:"수정"}),(0,a.jsx)("button",{onClick:N,disabled:j,className:"text-xs text-blue-600 hover:underline disabled:opacity-50",children:w?"비활성화":"활성화"}),!w&&!(null===(s=i._count)||void 0===s?void 0:s.measurements)&&(0,a.jsx)("button",{onClick:k,disabled:j,className:"text-xs text-red-600 hover:underline disabled:opacity-50",children:"삭제"}),"internal"===u&&m&&(0,a.jsx)("button",{onClick:()=>m(i),disabled:j,className:"text-xs text-purple-600 hover:underline disabled:opacity-50",children:"초대 링크"}),"connected"===u&&(null===(n=i.organizations)||void 0===n?void 0:n[0])&&(0,a.jsx)("button",{onClick:async()=>{if(confirm("연결을 해제하시겠습니까?"))try{let e=await fetch("/api/customer-organizations/".concat(i.organizations[0].id),{method:"DELETE"});if(e.ok)alert("연결이 해제되었습니다."),c();else{let t=await e.json();alert(t.error||"연결 해제 실패")}}catch(e){alert("연결 해제 중 오류가 발생했습니다.")}},disabled:j,className:"text-xs text-orange-600 hover:underline disabled:opacity-50",children:"연결 해제"})]})})]})}function f(){let{user:e}=(0,n.a)(),t=null==e?void 0:e.role,s="OPERATOR"===t,{selectedOrg:p,loading:f}=(0,l.o)(),{hasPermission:j,loading:v}=i(),[N,k]=(0,r.useState)("all"),[w,C]=(0,r.useState)([]),[D,S]=(0,r.useState)(!0),[T,E]=(0,r.useState)(""),[O,z]=(0,r.useState)(!1),[A,I]=(0,r.useState)(!1),[P,R]=(0,r.useState)(null),[L,Z]=(0,r.useState)(!1),[_,U]=(0,r.useState)(null),[M,F]=(0,r.useState)(!1),[B,J]=(0,r.useState)(!1),[H,V]=(0,r.useState)(!1),[W,q]=(0,r.useState)(!1);(0,r.useEffect)(()=>{p&&G()},[N,p]);let G=async()=>{if(p)try{S(!0);let e=await fetch("/api/customers?tab=".concat(N,"&organizationId=").concat(p.id)),t=await e.json();e.ok&&C(t.customers||[])}catch(e){}finally{S(!1)}},K=e=>{R(e),z(!0)},Q=()=>{z(!1),R(null)},X=e=>{U(e),Z(!0)},Y=async e=>{if(confirm('"'.concat(e.name,'" 고객사에 연결 요청을 보내시겠습니까?')))try{let t=await fetch("/api/customer-organizations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e.id})}),s=await t.json();t.ok?(alert(s.message||"연결 요청을 보냈습니다."),G()):alert(s.error||"연결 요청 실패")}catch(e){alert("연결 요청 중 오류가 발생했습니다.")}},$=(0,r.useMemo)(()=>{let e=w;return("connected"===N||"all"===N)&&(e=w.flatMap(e=>e.organizations&&e.organizations.length>1?e.organizations.map(t=>{var s;return{...e,organizations:[t],_connectionId:t.id,_siteType:null===(s=t.proposedData)||void 0===s?void 0:s.siteType}}):[e])),e.filter(e=>{if(!T)return!!A||!1!==e.isActive;let t=T.toLowerCase(),s=e.code&&e.code.toLowerCase().includes(t)||e.name&&e.name.toLowerCase().includes(t)||e.businessNumber&&e.businessNumber.toLowerCase().includes(t)||e.fullName&&e.fullName.toLowerCase().includes(t)||e.representative&&e.representative.toLowerCase().includes(t)||e.siteType&&e.siteType.toLowerCase().includes(t)||e.address&&e.address.toLowerCase().includes(t)||e.businessType&&e.businessType.toLowerCase().includes(t)||e.industry&&e.industry.toLowerCase().includes(t)||e.siteCategory&&e.siteCategory.toLowerCase().includes(t)||e.corporateNumber&&e.corporateNumber.toLowerCase().includes(t),a=!!A||!1!==e.isActive;return s&&a}).sort((e,t)=>"CUST999"===e.code?1:"CUST999"===t.code?-1:(e.code||e.name).localeCompare(t.code||t.name))},[w,T,A,N]),ee=(0,r.useMemo)(()=>{let e={};return $.forEach(t=>{let s=t.code||t.name;e[s]||(e[s]=[]),e[s].push(t)}),e},[$]),et=async e=>{try{let t=await e.text(),s=await fetch("/api/customers/bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvText:t})}),a=await s.json();if(s.ok)return await G(),{success:!0,message:a.message||"업로드 성공",count:a.count};return{success:!1,message:a.error||"업로드 실패"}}catch(e){return{success:!1,message:e.message||"오류 발생"}}};return f?(0,a.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,a.jsx)("div",{className:"text-lg",children:"로딩 중..."})}):p?(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-2.5",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold whitespace-nowrap mb-1.5",children:"고객사 관리"}),(0,a.jsx)("span",{className:"text-gray-300 dark:text-gray-600 mb-1.5",children:"|"}),(0,a.jsxs)("div",{className:"flex gap-2 mb-1.5",children:[j("customer.tab.all")&&(0,a.jsx)("button",{onClick:()=>k("all"),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat("all"===N?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"\uD83D\uDCCA 전체"}),j("customer.tab.internal")&&(0,a.jsx)("button",{onClick:()=>k("internal"),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat("internal"===N?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"\uD83D\uDCCB 내부"}),j("customer.tab.connected")&&(0,a.jsx)("button",{onClick:()=>k("connected"),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat("connected"===N?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"\uD83E\uDD1D 연결"})]}),j("customer.search")&&(0,a.jsxs)("div",{className:"flex flex-col",style:{minWidth:"280px"},children:[(0,a.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"검색"}),(0,a.jsx)(d.Z,{className:"text-sm h-8",value:T,onChange:e=>E(e.target.value),placeholder:"코드, 고객사명, 대표자, 주소, 업태, 업종 등"})]}),j("customer.filter")&&(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer mb-1.5 whitespace-nowrap",children:[(0,a.jsx)("input",{type:"checkbox",checked:A,onChange:e=>I(e.target.checked),className:"rounded"}),"비활성 표시"]}),(0,a.jsxs)("div",{className:"flex gap-1.5 ml-auto mb-1.5",children:[(0,a.jsx)(c.Z,{size:"sm",variant:"secondary",onClick:()=>q(!0),children:"❓ 도움말"}),!s&&(0,a.jsxs)(a.Fragment,{children:[j("customer.export")&&(0,a.jsx)(c.Z,{size:"sm",variant:"secondary",onClick:()=>{let e=new Blob(["\uFEFF"+[["고객사코드","고객사명(약칭)","사업자번호","고객사명(정식)","대표자","사업장구분","주소","업태","업종","사업장종별","법인등록번호","굴뚝수"],...$.map(e=>{var t,s;return[e.code||"",e.name,e.businessNumber||"-",e.fullName||e.name,e.representative||"-",e.siteType||"-",e.address||"-",e.businessType||"-",e.industry||"-",e.siteCategory||"-",e.corporateNumber||"-",null!==(s=null===(t=e._count)||void 0===t?void 0:t.stacks)&&void 0!==s?s:0]})].map(e=>e.map(e=>'"'.concat(String(null!=e?e:"").replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="customers_".concat(new Date().toISOString().slice(0,10),".csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)},children:"Excel"}),j("customer.bulk_upload")&&(0,a.jsx)(c.Z,{size:"sm",variant:"secondary",onClick:()=>F(!0),children:"일괄업로드"}),(null==p?void 0:p.hasContractManagement)&&j("contract.view")&&(0,a.jsx)(c.Z,{size:"sm",variant:"secondary",onClick:()=>J(!0),children:"계약관리"}),"connected"===N&&j("customer.create")&&(0,a.jsx)(c.Z,{size:"sm",onClick:()=>V(!0),children:"\uD83D\uDD0D 신규검색연결"}),"connected"!==N&&j("customer.create")&&(0,a.jsx)(c.Z,{size:"sm",onClick:()=>z(!0),children:"+ 신규 추가"})]})]})]})}),(0,a.jsx)("div",{className:"hidden md:block rounded-lg border overflow-x-auto max-h-[calc(100vh-180px)] overflow-y-auto",children:(0,a.jsxs)(o.iA,{className:"w-full table-fixed",children:[(0,a.jsx)(o.hr,{className:"bg-gray-50 dark:bg-white/10 sticky top-0 z-10",children:(0,a.jsxs)(o.Tr,{children:[(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[3%]",children:"상태"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[6%]",children:"고객사코드"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[7%]",children:"고객사명(약칭)"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[5%]",children:"사업자번호"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[8%]",children:"고객사명(정식)"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[4%]",children:"대표자"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[5%]",children:"사업장구분"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[9%]",children:"주소"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[4%]",children:"업태"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[7%]",children:"업종"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[4%]",children:"사업장종별"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[6%]",children:"법인등록번호"}),(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[3%]",children:"굴뚝수"}),!s&&(0,a.jsx)(o.Th,{className:"bg-gray-50 dark:bg-gray-800 w-[10%]",children:"액션"})]})}),(0,a.jsx)(o.p3,{children:D?(0,a.jsx)(o.Tr,{children:(0,a.jsx)(o.Td,{colSpan:14,className:"text-center text-gray-500 py-8",children:"로딩 중..."})}):0===$.length?(0,a.jsx)(o.Tr,{children:(0,a.jsxs)(o.Td,{colSpan:14,className:"text-center text-gray-500 py-8",children:["all"===N&&"등록된 고객사가 없습니다","internal"===N&&"내부 관리 고객사가 없습니다","connected"===N&&"연결된 고객사가 없습니다","search"===N&&"검색 가능한 고객사가 없습니다"]})}):Object.entries(ee).map(e=>{let[r,n]=e;return(0,a.jsx)(a.Fragment,{children:n.map((e,r)=>(0,a.jsx)(b,{customer:e,role:t,onRefetch:G,onEdit:K,activeTab:N,onCreateInvitation:X,onRequestConnection:Y,isGrouped:n.length>1,isFirstInGroup:0===r,isLastInGroup:r===n.length-1,groupSize:n.length,isReadOnly:s},e.id))})})})]})}),(0,a.jsx)("div",{className:"md:hidden space-y-3",children:D?(0,a.jsx)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-6 text-center text-gray-500",children:"로딩 중..."}):0===$.length?(0,a.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-6 text-center text-gray-500",children:["all"===N&&"등록된 고객사가 없습니다","internal"===N&&"내부 관리 고객사가 없습니다","connected"===N&&"연결된 고객사가 없습니다","search"===N&&"검색 가능한 고객사가 없습니다"]}):Object.entries(ee).map(e=>{let[t,r]=e;return(0,a.jsx)("div",{children:r.map((e,t)=>{var n,l,i;let d=!1!==e.isActive,c=r.length>1;return(0,a.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-2 ".concat(d?"":"opacity-50"," ").concat(c?"border-l-4 border-l-blue-400":""),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"inline-block px-2 py-0.5 rounded text-xs ".concat(d?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:d?"활성":"비활성"}),!s&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>K(e),className:"text-xs text-green-600 hover:underline",children:"수정"}),(0,a.jsx)("button",{onClick:async()=>{try{(await fetch("/api/customers/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!e.isActive})})).ok?G():alert("상태 변경 실패")}catch(e){alert("오류 발생")}},className:"text-xs text-blue-600 hover:underline",children:d?"비활성화":"활성화"}),!d&&!(null===(n=e._count)||void 0===n?void 0:n.measurements)&&(0,a.jsx)("button",{onClick:async()=>{var t;if((null===(t=e._count)||void 0===t?void 0:t.measurements)>0){alert("측정 기록이 있는 고객사는 삭제할 수 없습니다.");return}if(confirm('"'.concat(e.name,'" 고객사를 삭제하시겠습니까?')))try{(await fetch("/api/customers/".concat(e.id),{method:"DELETE"})).ok?G():alert("삭제 실패")}catch(e){alert("오류 발생")}},className:"text-xs text-red-600 hover:underline",children:"삭제"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCB 코드:"})," ",e.code||"-"]}),c&&0===t&&(0,a.jsxs)("div",{className:"text-blue-600",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFE2 사업장:"})," ",r.length,"개"]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCD 약칭:"})," ",e.name]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDD22 사업자번호:"})," ",e.businessNumber||"-"]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFED 정식명:"})," ",e.fullName||e.name]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDC64 대표자:"})," ",e.representative||"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFD7️ 구분:"})," ",e.siteType||"-"]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCD 주소:"})," ",e.address||"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCBC 업태:"})," ",e.businessType||"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFE2 업종:"})," ",e.industry||"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"⚙️ 종별:"})," ",e.siteCategory||"-"]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFDB️ 법인등록번호:"})," ",e.corporateNumber||"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFED 굴뚝:"})," ",null!==(i=null===(l=e._count)||void 0===l?void 0:l.stacks)&&void 0!==i?i:0,"개"]})]})]},e.id)})},t)})}),(0,a.jsx)(x,{isOpen:O,onClose:Q,onSuccess:()=>{G(),Q()},customer:P}),(0,a.jsx)(u,{isOpen:L,onClose:()=>Z(!1),customer:_,onSuccess:G}),(0,a.jsx)(m.Z,{isOpen:M,onClose:()=>F(!1),title:"고객사 일괄업로드",templateHeaders:["고객사코드","고객사명(약칭)","사업자번호","고객사명(정식)","대표자","사업장구분","주소","업태","업종","사업장종별","법인등록번호"],exampleRow:["CUST001","AA제조","123-45-67890","주식회사 AA제조","홍길동","본사","서울시 강남구","제조","제조업","1종","123456-1234567"],templateFileName:"고객사_일괄업로드_양식.csv",onUpload:et,parseInstructions:"고객사명(약칭)은 필수 항목입니다. 나머지 항목은 선택사항입니다."}),(0,a.jsx)(g,{isOpen:B,onClose:()=>J(!1)}),(0,a.jsx)(h,{isOpen:H,onClose:()=>V(!1),organizationId:(null==p?void 0:p.id)||"",onSuccess:G}),(0,a.jsx)(y,{isOpen:W,onClose:()=>q(!1)})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,a.jsx)("div",{className:"text-lg text-red-600",children:"조직 정보를 불러올 수 없습니다."})})}},3158:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437),r=s(2265),n=s(6334);function l(e){let{isOpen:t,onClose:s,title:l,templateHeaders:i,exampleRow:d,templateFileName:c,onUpload:o,parseInstructions:x="양식에 맞게 작성한 CSV 파일을 업로드하세요."}=e,[u,m]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1),[p,y]=(0,r.useState)(""),b=async()=>{if(!u){y("파일을 선택해주세요.");return}h(!0),y("");try{let e=await o(u);if(e.success){let t=e.message||"업로드 완료";y("✅ ".concat(t)),m(null)}else y("❌ ".concat(e.message||"업로드 실패"))}catch(e){y("❌ 오류: ".concat(e.message||"업로드 중 문제가 발생했습니다."))}finally{h(!1)}},f=()=>{g||(m(null),y(""),s())};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:f,children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:l}),(0,a.jsx)("button",{onClick:f,disabled:g,className:"text-gray-500 hover:text-gray-700 disabled:opacity-50",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded",children:[(0,a.jsx)("p",{className:"font-medium mb-1",children:"\uD83D\uDCCB 업로드 절차"}),(0,a.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-xs",children:[(0,a.jsx)("li",{children:'아래 "업로드 양식 다운로드" 버튼을 클릭하여 CSV 양식을 다운로드합니다.'}),(0,a.jsx)("li",{children:"다운로드한 양식에 데이터를 입력합니다. (예시 행 참고)"}),(0,a.jsx)("li",{children:'"파일 선택" 버튼을 클릭하여 작성한 CSV 파일을 선택합니다.'}),(0,a.jsx)("li",{children:'"업로드" 버튼을 클릭하여 데이터를 등록합니다.'})]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:x}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(n.Z,{variant:"secondary",onClick:()=>{let e=new Blob(["\uFEFF"+i.map(e=>'"'.concat(e,'"')).join(",")+"\n"+d.map(e=>'"'.concat(e,'"')).join(",")+"\n"],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=c,s.click(),URL.revokeObjectURL(t)},disabled:g,className:"flex-1",children:"\uD83D\uDCE5 업로드 양식 다운로드"})}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)("label",{className:"flex-1",children:[(0,a.jsx)("div",{className:"px-4 py-2 border-2 border-dashed rounded cursor-pointer text-center transition-colors ".concat(u?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400"," ").concat(g?"opacity-50 cursor-not-allowed":""),children:u?(0,a.jsxs)("span",{className:"text-sm",children:["\uD83D\uDCC4 ",u.name]}):(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"\uD83D\uDCC1 파일 선택 (CSV)"})}),(0,a.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&(m(s),y(""))},disabled:g})]})}),(0,a.jsx)(n.Z,{onClick:b,disabled:!u||g,className:"w-full",children:g?"업로드 중...":"업로드"})]}),p&&(0,a.jsx)("div",{className:"text-sm p-4 rounded border-2 ".concat(p.startsWith("✅")?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border-green-500":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border-red-500"),children:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("pre",{className:"whitespace-pre-wrap font-sans",children:p}),(0,a.jsx)(n.Z,{size:"sm",onClick:()=>{y(""),f()},className:"self-end",children:"확인"})]})})]}),!p&&(0,a.jsx)("div",{className:"mt-6 flex justify-end gap-2",children:(0,a.jsx)(n.Z,{variant:"secondary",onClick:f,disabled:g,children:"닫기"})})]})}):null}},8653:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(7437),r=s(2265);function n(e){let{isOpen:t,onClose:s,title:n,sections:l}=e,[i,d]=(0,r.useState)(0);return t?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:s}),(0,a.jsxs)("div",{className:"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center text-2xl",children:"\uD83D\uDCDA"}),(0,a.jsx)("h3",{className:"text-xl font-bold text-white",children:n})]}),(0,a.jsx)("button",{onClick:s,className:"text-white hover:text-gray-200 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),l.length>1&&(0,a.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:(0,a.jsx)("nav",{className:"flex -mb-px overflow-x-auto",children:l.map((e,t)=>(0,a.jsx)("button",{onClick:()=>d(t),className:"px-6 py-3 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ".concat(i===t?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e.title},t))})}),(0,a.jsx)("div",{className:"px-6 py-6 max-h-[70vh] overflow-y-auto",children:(0,a.jsx)("div",{className:"prose dark:prose-invert max-w-none",children:"string"==typeof l[i].content?(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:l[i].content}}):l[i].content})}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 px-6 py-4 flex justify-between items-center",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"\uD83D\uDCA1 추가 도움이 필요하시면 시스템 관리자에게 문의하세요."}),(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"닫기"})]})]})]})}):null}},6334:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437);s(2265);let r={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},n={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function l(e){let{variant:t="primary",size:s="md",className:l="",...i}=e;return(0,a.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(r[t]," ").concat(n[s]," ").concat(l),...i})}},2827:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{className:t="",...s}=e;return(0,a.jsx)("input",{className:"".concat("rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20"," ").concat(t),...s})}s(2265)},1515:function(e,t,s){"use strict";s.d(t,{Td:function(){return c},Th:function(){return d},Tr:function(){return i},hr:function(){return n},iA:function(){return r},p3:function(){return l}});var a=s(7437);function r(e){let{className:t="",...s}=e;return(0,a.jsx)("table",{className:"w-full text-sm border-collapse ".concat(t),...s})}function n(e){return(0,a.jsx)("thead",{...e})}function l(e){return(0,a.jsx)("tbody",{...e})}function i(e){return(0,a.jsx)("tr",{className:"border-b last:border-0 border-gray-200 dark:border-white/10",...e})}function d(e){let{className:t="",...s}=e;return(0,a.jsx)("th",{className:"text-left py-2 px-3 font-medium text-gray-600 dark:text-gray-300 ".concat(t),...s})}function c(e){let{className:t="",...s}=e;return(0,a.jsx)("td",{className:"py-2 px-3 ".concat(t),...s})}s(2265)},2397:function(e,t,s){"use strict";s.d(t,{H:function(){return c},a:function(){return o}});var a=s(7437),r=s(2265),n=s(605),l=s(9376);function i(){return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900",children:[(0,a.jsxs)("div",{className:"mb-16",children:[(0,a.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-white text-center",children:"오염물질 측정 관리 시스템"}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:"Pollutant Measurement Management System"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-gray-200 dark:border-gray-700 border-t-blue-600 rounded-full animate-spin"})}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm font-medium",children:"로딩 중..."})]}),(0,a.jsx)("div",{className:"mt-16"})]})}let d=(0,r.createContext)(null);function c(e){let{children:t}=e,{data:s,status:c}=(0,n.useSession)(),[o,x]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0),g=(0,l.usePathname)();(0,r.useEffect)(()=>{"loading"!==c&&m(!1),(null==s?void 0:s.user)?x(s.user):"unauthenticated"===c&&x(null)},[s,c]);let h="loading"===c||u;return!h||"/login"===g||(null==g?void 0:g.startsWith("/register"))||(null==g?void 0:g.startsWith("/invite"))||(null==g?void 0:g.startsWith("/auth"))?(0,a.jsx)(d.Provider,{value:{user:o,loading:h},children:t}):(0,a.jsx)(i,{})}function o(){let e=(0,r.useContext)(d);if(!e)throw Error("AuthProvider is missing");return e}},2891:function(e,t,s){"use strict";s.d(t,{OrganizationProvider:function(){return i},o:function(){return d}});var a=s(7437),r=s(2265),n=s(605);let l=(0,r.createContext)(void 0);function i(e){var t,s,i;let{children:d}=e,{data:c,status:o}=(0,n.useSession)(),[x,u]=(0,r.useState)(null),[m,g]=(0,r.useState)([]),[h,p]=(0,r.useState)(!0),y=(null==c?void 0:null===(t=c.user)||void 0===t?void 0:t.role)==="SUPER_ADMIN",b=null==c?void 0:null===(s=c.user)||void 0===s?void 0:s.role,f=null==c?void 0:null===(i=c.user)||void 0===i?void 0:i.organizationId,j="CUSTOMER_ADMIN"===b||"CUSTOMER_USER"===b;(0,r.useEffect)(()=>{if("loading"!==o){if(!c||j){p(!1);return}y&&sessionStorage.getItem("viewAsOrganization"),y?v():f?N(f):p(!1)}},[c,o,y,f,j]),(0,r.useEffect)(()=>{if(!y)return;let e=sessionStorage.getItem("viewAsOrganization");e&&(null==x?void 0:x.id)!==e&&v();let t=setInterval(()=>{let e=sessionStorage.getItem("viewAsOrganization");if(e&&(null==x?void 0:x.id)!==e)v();else if(!e&&x){let e=localStorage.getItem("selectedOrgId");e&&x.id!==e&&v()}},500);return()=>clearInterval(t)},[y,x]);let v=async()=>{try{let e=await fetch("/api/organizations?status=APPROVED"),t=await e.json();if(e.ok){let e=t.organizations||[];g(e);let s=sessionStorage.getItem("viewAsOrganization");if(s){let t=e.find(e=>e.id===s);if(t){u(t);return}}let a=localStorage.getItem("selectedOrgId");if(a){let t=e.find(e=>e.id===a);t?u(t):e.length>0&&u(e[0])}else e.length>0&&u(e[0])}}catch(e){}finally{p(!1)}},N=async e=>{try{let t=await fetch("/api/organizations/".concat(e)),s=await t.json();if(t.ok){let e=s.organization;g([e]),u(e)}}catch(e){}finally{p(!1)}};return(0,a.jsx)(l.Provider,{value:{selectedOrg:x,setSelectedOrg:e=>{u(e),e?localStorage.setItem("selectedOrgId",e.id):localStorage.removeItem("selectedOrgId")},organizations:m,loading:h,isSuperAdmin:y},children:d})}function d(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useOrganization must be used within OrganizationProvider");return e}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=7644)}),_N_E=e.O()}]);