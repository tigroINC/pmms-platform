(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4027],{8232:function(e,t,a){Promise.resolve().then(a.bind(a,1249))},1249:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var s=a(7437),r=a(2265),n=a(6334),i=a(2827),l=a(6819),d=a(1515),c=a(8776),o=a(4755),u=a(9548),m=a(2891);function x(e){var t,a,n,l;let{isOpen:d,onClose:c,onSuccess:o,measurement:u}=e,[m,x]=(0,r.useState)({value:"",measuredAt:"",note:"",editReason:""}),[h,g]=(0,r.useState)(!1),[v,p]=(0,r.useState)("");(0,r.useEffect)(()=>{if(u&&d){var e;let t=new Date(u.measuredAt).toISOString().slice(0,16);x({value:(null===(e=u.value)||void 0===e?void 0:e.toString())||"",measuredAt:t,note:u.note||"",editReason:""}),p("")}},[u,d]);let y=async e=>{if(e.preventDefault(),p(""),!m.value){p("측정값은 필수입니다.");return}if(!m.editReason){p("수정 사유를 입력해주세요.");return}g(!0);try{let e=await fetch("/api/measurements/".concat(u.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:parseFloat(m.value),measuredAt:m.measuredAt,note:m.note,editReason:m.editReason,editedBy:"admin"})});if(!e.ok){let t=await e.json();throw Error(t.error||"수정 실패")}o(),c()}catch(e){p(e.message)}finally{g(!1)}};return d&&u?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:c,children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b px-6 py-4 flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"측정 기록 수정"}),(0,s.jsx)("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"✕"})]}),(0,s.jsxs)("form",{onSubmit:y,className:"p-6 space-y-4",children:[v&&(0,s.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-4 py-3 rounded",children:v}),(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"고객사:"}),(0,s.jsx)("span",{className:"font-medium",children:null===(t=u.customer)||void 0===t?void 0:t.name})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"굴뚝:"}),(0,s.jsx)("span",{className:"font-medium",children:null===(a=u.stack)||void 0===a?void 0:a.name})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"측정항목:"}),(0,s.jsx)("span",{className:"font-medium",children:null===(n=u.item)||void 0===n?void 0:n.name})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"원본 측정값:"}),(0,s.jsxs)("span",{className:"font-medium text-blue-600",children:[u.value," ",null===(l=u.item)||void 0===l?void 0:l.unit]})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"text-sm font-medium",children:["측정값 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(i.Z,{type:"number",step:"0.01",value:m.value,onChange:e=>x(t=>({...t,value:e.target.value})),placeholder:"측정값 입력",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"text-sm font-medium",children:["측정 일시 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(i.Z,{type:"datetime-local",value:m.measuredAt,onChange:e=>x(t=>({...t,measuredAt:e.target.value})),required:!0})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"비고"}),(0,s.jsx)(i.Z,{value:m.note,onChange:e=>x(t=>({...t,note:e.target.value})),placeholder:"비고 입력"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"text-sm font-medium",children:["수정 사유 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(i.Z,{value:m.editReason,onChange:e=>x(t=>({...t,editReason:e.target.value})),placeholder:"예: 측정값 오입력 정정",required:!0}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"수정 사유는 이력 추적을 위해 필수로 입력해야 합니다."})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:c,className:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"취소"}),(0,s.jsx)("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?"수정 중...":"수정"})]})]})]})}):null}var h=a(605);function g(){var e;let{selectedOrg:t,loading:a}=(0,m.o)(),{list:g}=(0,o.n)(),{items:v}=(0,c.F)(),{data:p}=(0,h.useSession)(),y=null==p?void 0:null===(e=p.user)||void 0===e?void 0:e.role,j="CUSTOMER_ADMIN"===y||"CUSTOMER_USER"===y,f=()=>{let e=new Date,t=new Date;return t.setMonth(e.getMonth()-6),{start:t.toISOString().split("T")[0],end:e.toISOString().split("T")[0]}},b=(0,r.useMemo)(()=>f(),[]),[N,k]=(0,r.useState)(""),[w,S]=(0,r.useState)("전체"),[C,D]=(0,r.useState)("전체"),[T,A]=(0,r.useState)("전체"),[M,E]=(0,r.useState)(b.start),[I,O]=(0,r.useState)(b.end),[R,z]=(0,r.useState)(1),[P,Z]=(0,r.useState)(50),[U,_]=(0,r.useState)("measuredAt"),[L,F]=(0,r.useState)("desc"),[H,V]=(0,r.useState)(!1),[W,K]=(0,r.useState)(null),[q,B]=(0,r.useState)(!1),[J,Y]=(0,r.useState)([]),[G,Q]=(0,r.useState)("전체");(0,r.useEffect)(()=>{j&&fetch("/api/customer-organizations").then(e=>e.json()).then(e=>{Y(e.organizations||[])}).catch(e=>console.error("Failed to fetch customer organizations:",e))},[j]);let X=(0,r.useMemo)(()=>{var e;return"전체"===w?void 0:null===(e=g.find(e=>e.name===w))||void 0===e?void 0:e.id},[w,g]),{list:$}=(0,u.D)(X),ee=(0,r.useMemo)(()=>"전체"===C?void 0:C,[C]),et=(0,r.useMemo)(()=>{var e;return"전체"===T?void 0:(null===(e=v.find(e=>e.name===T))||void 0===e?void 0:e.key)||T},[T,v]),{data:ea,mutate:es}=(0,c.r)({customerId:X,stack:ee,itemKey:et,start:M||void 0,end:I||void 0,sort:{key:"measuredAt",dir:"asc"},page:1,pageSize:999999}),er=(0,r.useMemo)(()=>{if(!Array.isArray(ea))return[];let e=new Map;return ea.forEach(t=>{var a,s;let r=t.measuredAt?new Date(t.measuredAt):null,n=r?Math.floor(r.getTime()/6e4):t.measuredAt,i=(null===(a=t.stack)||void 0===a?void 0:a.id)||t.stackId||(null===(s=t.stack)||void 0===s?void 0:s.name)||"",l="".concat(i,"|").concat(n);(t.weather||null!==t.temperatureC||null!==t.humidityPct)&&!e.has(l)&&e.set(l,{weather:t.weather,temperatureC:t.temperatureC,humidityPct:t.humidityPct,pressureMmHg:t.pressureMmHg,windDirection:t.windDirection,windSpeedMs:t.windSpeedMs,gasVelocityMs:t.gasVelocityMs,gasTempC:t.gasTempC,moisturePct:t.moisturePct,oxygenMeasuredPct:t.oxygenMeasuredPct,oxygenStdPct:t.oxygenStdPct,flowSm3Min:t.flowSm3Min})}),ea.map(t=>{var a,s,r,n,i,l,d,c,o,u,m,x,h,g;let v=t.measuredAt?new Date(t.measuredAt):null,p=v?Math.floor(v.getTime()/6e4):t.measuredAt,y=(null===(a=t.stack)||void 0===a?void 0:a.id)||t.stackId||(null===(s=t.stack)||void 0===s?void 0:s.name)||"",j="".concat(y,"|").concat(p),f=(null===(r=t.item)||void 0===r?void 0:r.name)||t.itemName||t.itemKey,b=null===(n=t.item)||void 0===n?void 0:n.limit,N=e.get(j)||{},k=e=>{let a=t[e];if(null!=a)return a;let s=N[e];return null!=s?s:""};return{id:t.id,customerId:t.customerId,stackId:t.stackId,itemKey:t.itemKey,isActive:t.isActive,originalData:t,measuredAt:v?"".concat(v.getFullYear(),"-").concat(String(v.getMonth()+1).padStart(2,"0"),"-").concat(String(v.getDate()).padStart(2,"0")," ").concat(String(v.getHours()).padStart(2,"0"),":").concat(String(v.getMinutes()).padStart(2,"0")):"",customer:null!==(x=null===(i=t.customer)||void 0===i?void 0:i.name)&&void 0!==x?x:"",stack:null!==(g=null!==(h=null===(l=t.stack)||void 0===l?void 0:l.name)&&void 0!==h?h:t.stack)&&void 0!==g?g:"",weather:k("weather"),temp:k("temperatureC"),humidity:k("humidityPct"),pressure:k("pressureMmHg"),windDir:k("windDirection"),windSpeed:k("windSpeedMs"),gasVel:k("gasVelocityMs"),gasTemp:k("gasTempC"),moisture:k("moisturePct"),o2Measured:k("oxygenMeasuredPct"),o2Standard:k("oxygenStdPct"),flowRate:k("flowSm3Min"),pollutant:f,value:t.value,limit:b,limitCheck:b&&t.value>b?"초과":"적합",company:(null===(u=t.customer)||void 0===u?void 0:null===(o=u.organizations)||void 0===o?void 0:null===(c=o[0])||void 0===c?void 0:null===(d=c.organization)||void 0===d?void 0:d.name)||(null===(m=t.organization)||void 0===m?void 0:m.name)||t.company||""}})},[ea]),en=(0,r.useMemo)(()=>er.filter(e=>{var t,a,s,r;if(!(q||!1!==e.isActive))return!1;if(j&&"전체"!==G){let a=null===(t=J.find(e=>e.id===G))||void 0===t?void 0:t.name;if(a&&e.company!==a)return!1}if("전체"!==w&&e.customer!==w||"전체"!==C&&e.stack!==C||"전체"!==T&&e.pollutant!==T||M&&e.measuredAt<M||I&&e.measuredAt>I)return!1;if(N){let t=N.toLowerCase();return(null===(a=e.customer)||void 0===a?void 0:a.toLowerCase().includes(t))||(null===(s=e.stack)||void 0===s?void 0:s.toLowerCase().includes(t))||(null===(r=e.pollutant)||void 0===r?void 0:r.toLowerCase().includes(t))}return!0}),[er,N,w,C,T,M,I,q,j,G,J]),ei=(0,r.useMemo)(()=>(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",s=[...e];return s.sort((e,s)=>{var r,n;let i=(r=e[t])===(n=s[t])?0:r<n?-1:1;return"asc"===a?i:-i}),s})(en,U,L),[en,U,L]),el=ei.length,ed=Math.ceil(el/P),ec=Math.min(R,ed||1),eo=ei.slice((ec-1)*P,ec*P),eu=e=>{K(e.originalData||e),V(!0)},em=async e=>{try{let t=await fetch("/api/measurements/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!e.isActive})});if(!t.ok){let e=await t.json();throw Error(e.error||"상태 변경 실패")}es()}catch(e){alert(e.message||"상태 변경 중 오류가 발생했습니다.")}},ex=async e=>{if(confirm("정말 삭제하시겠습니까?"))try{let t=await fetch("/api/measurements/".concat(e.id),{method:"DELETE"});if(t.ok)alert("삭제되었습니다."),es();else{let e=await t.json();alert(e.error||"삭제 실패")}}catch(e){alert("오류 발생")}};return a?(0,s.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,s.jsx)("div",{className:"text-lg",children:"로딩 중..."})}):j||t?(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-2.5",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,s.jsx)("h1",{className:"text-lg font-semibold whitespace-nowrap mb-1.5",children:"측정 이력"}),(0,s.jsx)("span",{className:"text-gray-300 dark:text-gray-600 mb-1.5",children:"|"}),j&&(0,s.jsxs)("div",{className:"flex flex-col",style:{width:"176px",minWidth:"176px"},children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"환경측정기업"}),(0,s.jsxs)(l.Z,{className:"text-sm h-8 w-full",value:G,onChange:e=>{Q(e.target.value),z(1)},children:[(0,s.jsx)("option",{value:"전체",children:"통합 데이터 (전체)"}),J.map(e=>(0,s.jsx)("option",{value:e.id,children:e.nickname||e.name},e.id))]})]}),!j&&(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"검색"}),(0,s.jsx)(i.Z,{className:"text-sm h-8",style:{width:"176px",minWidth:"176px"},value:N,onChange:e=>{k(e.target.value),z(1)},placeholder:"굴뚝/오염물질"})]}),!j&&(0,s.jsxs)("div",{className:"flex flex-col",style:{width:"176px",minWidth:"176px"},children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"고객사"}),(0,s.jsx)(l.Z,{className:"text-sm h-8 w-full",value:w,onChange:e=>{S(e.target.value),D("전체"),z(1)},children:["전체",...g.map(e=>e.name)].map(e=>(0,s.jsx)("option",{children:e},e))})]}),(0,s.jsxs)("div",{className:"flex flex-col",style:{width:"176px",minWidth:"176px"},children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"굴뚝명"}),(0,s.jsx)(l.Z,{className:"text-sm h-8 w-full",value:C,onChange:e=>{D(e.target.value),z(1)},children:["전체",...X?$.map(e=>e.name):Array.from(new Set(er.map(e=>e.stack)))].map(e=>(0,s.jsx)("option",{children:e},e))})]}),(0,s.jsxs)("div",{className:"flex flex-col",style:{width:"176px",minWidth:"176px"},children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"오염물질"}),(0,s.jsx)(l.Z,{className:"text-sm h-8 w-full",value:T,onChange:e=>{A(e.target.value),z(1)},children:["전체",...v.map(e=>e.name)].map(e=>(0,s.jsx)("option",{children:e},e))})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"시작일"}),(0,s.jsx)(i.Z,{className:"text-sm h-8",style:{width:"144px",minWidth:"144px"},type:"date",value:M,onChange:e=>{E(e.target.value),z(1)}})]}),(0,s.jsx)("span",{className:"text-xs text-gray-500 mb-1.5",children:"~"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"종료일"}),(0,s.jsx)(i.Z,{className:"text-sm h-8",style:{width:"144px",minWidth:"144px"},type:"date",value:I,onChange:e=>{O(e.target.value),z(1)}})]}),(0,s.jsxs)("div",{className:"flex flex-col",style:{width:"158px",minWidth:"158px"},children:[(0,s.jsx)("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"한페이지당"}),(0,s.jsxs)(l.Z,{className:"text-sm h-8 w-full",value:String(P),onChange:e=>{let t=e.target.value;Z("ALL"===t?999999:Number(t)),z(1)},children:[(0,s.jsx)("option",{value:"50",children:"50"}),(0,s.jsx)("option",{value:"100",children:"100"}),(0,s.jsx)("option",{value:"200",children:"200"}),(0,s.jsx)("option",{value:"ALL",children:"전체"})]})]}),(0,s.jsxs)("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer mb-1.5 whitespace-nowrap ml-auto",children:[(0,s.jsx)("input",{type:"checkbox",checked:q,onChange:e=>B(e.target.checked),className:"rounded"}),"비활성 표시"]}),(0,s.jsxs)("div",{className:"flex gap-1.5 mb-1.5",children:[(0,s.jsx)(n.Z,{size:"sm",variant:"secondary",onClick:()=>{k(""),S("전체"),D("전체"),A("전체"),E(b.start),O(b.end),z(1)},children:"초기화"}),(0,s.jsx)(n.Z,{size:"sm",onClick:()=>{let e=new Blob(["\uFEFF"+[["측정일자","고객사","배출구명","기상","기온℃","습도％","기압mmHg","풍향","풍속m/sec","가스속도m/s","가스온도℃","수분함량％","실측산소농도％","표준산소농도％","배출가스유량S㎥/min","오염물질","농도","배출허용기준농도","배출허용기준체크","측정업체"],...ei.map(e=>{var t;return[e.measuredAt,e.customer,e.stack,e.weather,e.temp,e.humidity,e.pressure,e.windDir,e.windSpeed,e.gasVel,e.gasTemp,e.moisture,e.o2Measured,e.o2Standard,e.flowRate,e.pollutant,e.value,null!==(t=e.limit)&&void 0!==t?t:"",e.limitCheck,e.company]})].map(e=>e.map(e=>'"'.concat(String(null!=e?e:"").replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="측정이력_".concat(new Date().toISOString().slice(0,10),".csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},children:"Excel"})]})]})}),(0,s.jsxs)("div",{className:"hidden md:block rounded-lg border overflow-x-auto max-h-[calc(100vh-180px)] overflow-y-auto",children:[0===eo.length?(0,s.jsx)("div",{className:"p-6 text-sm text-gray-500",children:"조건에 맞는 데이터가 없습니다."}):(0,s.jsxs)(d.iA,{className:"min-w-[1200px]",children:[(0,s.jsx)(d.hr,{className:"bg-gray-50 dark:bg-white/10 sticky top-0 z-10",children:(0,s.jsxs)(d.Tr,{children:[(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"상태"}),(0,s.jsxs)(d.Th,{onClick:()=>{_("measuredAt"),F(e=>"measuredAt"===U?"asc"===e?"desc":"asc":"desc")},className:"cursor-pointer bg-gray-50 dark:bg-gray-800",children:["측정일자 ","measuredAt"===U?"asc"===L?"▲":"▼":""]}),!j&&(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"고객사"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"배출구명"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"기상"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"기온℃"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"습도％"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"기압mmHg"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"풍향"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"풍속m／sec"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"가스속도m／s"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"가스온도℃"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"수분함량％"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"실측산소농도％"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"표준산소농도％"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"배출가스유량S㎥／min"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"오염물질"}),(0,s.jsxs)(d.Th,{onClick:()=>{_("value"),F(e=>"value"===U?"asc"===e?"desc":"asc":"desc")},className:"cursor-pointer bg-gray-50 dark:bg-gray-800",children:["농도 ","value"===U?"asc"===L?"▲":"▼":""]}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"배출허용기준농도"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"배출허용기준체크"}),(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"측정업체"}),!j&&(0,s.jsx)(d.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"액션"})]})}),(0,s.jsx)(d.p3,{children:eo.map((e,t)=>{var a;let r=!1!==e.isActive;return(0,s.jsxs)(d.Tr,{className:r?"":"opacity-50 bg-gray-50 dark:bg-gray-900/20",children:[(0,s.jsx)(d.Td,{children:r?(0,s.jsx)("span",{className:"inline-block px-2 py-0.5 rounded bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 text-xs",children:"활성"}):(0,s.jsx)("span",{className:"inline-block px-2 py-0.5 rounded bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 text-xs",children:"비활성"})}),(0,s.jsx)(d.Td,{className:"whitespace-nowrap",children:e.measuredAt}),!j&&(0,s.jsx)(d.Td,{children:e.customer}),(0,s.jsx)(d.Td,{children:e.stack}),(0,s.jsx)(d.Td,{children:e.weather}),(0,s.jsx)(d.Td,{children:e.temp}),(0,s.jsx)(d.Td,{children:e.humidity}),(0,s.jsx)(d.Td,{children:e.pressure}),(0,s.jsx)(d.Td,{children:e.windDir}),(0,s.jsx)(d.Td,{children:e.windSpeed}),(0,s.jsx)(d.Td,{children:e.gasVel}),(0,s.jsx)(d.Td,{children:e.gasTemp}),(0,s.jsx)(d.Td,{children:e.moisture}),(0,s.jsx)(d.Td,{children:e.o2Measured}),(0,s.jsx)(d.Td,{children:e.o2Standard}),(0,s.jsx)(d.Td,{children:e.flowRate}),(0,s.jsx)(d.Td,{children:e.pollutant}),(0,s.jsx)(d.Td,{children:e.value}),(0,s.jsx)(d.Td,{children:null!==(a=e.limit)&&void 0!==a?a:""}),(0,s.jsx)(d.Td,{children:e.limitCheck}),(0,s.jsx)(d.Td,{children:e.company}),!j&&(0,s.jsx)(d.Td,{children:(0,s.jsxs)("div",{className:"flex gap-2 whitespace-nowrap",children:[(0,s.jsx)("button",{onClick:()=>eu(e),className:"text-xs text-green-600 hover:underline",children:"수정"}),(0,s.jsx)("button",{onClick:()=>em(e),className:"text-xs text-blue-600 hover:underline",children:r?"비활성화":"활성화"}),!r&&(0,s.jsx)("button",{onClick:()=>ex(e),className:"text-xs text-red-600 hover:underline",children:"삭제"})]})})]},"".concat(e.stack,"_").concat(e.measuredAt,"_").concat(t))})})]}),(0,s.jsxs)("div",{className:"p-3 flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsxs)("div",{children:["총 ",el,"건 \xb7 ",ec,"/",ed," 페이지"]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(n.Z,{variant:"secondary",size:"sm",onClick:()=>z(e=>Math.max(1,e-1)),disabled:1===ec,children:"이전"}),(0,s.jsx)(n.Z,{variant:"secondary",size:"sm",onClick:()=>z(e=>Math.min(ed,e+1)),disabled:ec===ed,children:"다음"})]})]})]}),(0,s.jsx)("div",{className:"md:hidden space-y-3",children:0===eo.length?(0,s.jsx)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-6 text-center text-gray-500",children:"조건에 맞는 데이터가 없습니다."}):(0,s.jsxs)(s.Fragment,{children:[eo.map((e,t)=>{var a;let r=!1!==e.isActive;return(0,s.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-2 ".concat(r?"":"opacity-50"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"inline-block px-2 py-0.5 rounded text-xs ".concat(r?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:r?"활성":"비활성"}),!j&&(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>eu(e),className:"text-xs text-green-600 hover:underline",children:"수정"}),(0,s.jsx)("button",{onClick:()=>em(e),className:"text-xs text-blue-600 hover:underline",children:r?"비활성화":"활성화"}),!r&&(0,s.jsx)("button",{onClick:()=>ex(e),className:"text-xs text-red-600 hover:underline",children:"삭제"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCC5 측정일:"})," ",e.measuredAt]}),!j&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCD 고객사:"})," ",e.customer]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFED 굴뚝:"})," ",e.stack]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83E\uDDEA 오염물질:"})," ",e.pollutant]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCA 농도:"})," ",e.value]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"⚠️ 기준:"})," ",null!==(a=e.limit)&&void 0!==a?a:"-"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"✅ 체크:"})," ",e.limitCheck]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDF24️ 기상:"})," ",e.weather||"-"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDF21️ 기온:"})," ",e.temp||"-","℃"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCA7 습도:"})," ",e.humidity||"-","%"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDF9A️ 기압:"})," ",e.pressure||"-","mmHg"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83E\uDDED 풍향:"})," ",e.windDir||"-"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCA8 풍속:"})," ",e.windSpeed||"-","m/s"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDD25 가스온도:"})," ",e.gasTemp||"-","℃"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCA8 가스속도:"})," ",e.gasVel||"-","m/s"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCA7 수분:"})," ",e.moisture||"-","%"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83E\uDEE7 실측O₂:"})," ",e.o2Measured||"-","%"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83E\uDEE7 표준O₂:"})," ",e.o2Standard||"-","%"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDF0A 유량:"})," ",e.flowRate||"-","S㎥/min"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFE2 업체:"})," ",e.company]})]})]},"".concat(e.stack,"_").concat(e.measuredAt,"_").concat(t))}),(0,s.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-3 flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsxs)("div",{children:["총 ",el,"건 \xb7 ",ec,"/",ed," 페이지"]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(n.Z,{variant:"secondary",size:"sm",onClick:()=>z(e=>Math.max(1,e-1)),disabled:1===ec,children:"이전"}),(0,s.jsx)(n.Z,{variant:"secondary",size:"sm",onClick:()=>z(e=>Math.min(ed,e+1)),disabled:ec===ed,children:"다음"})]})]})]})}),(0,s.jsx)(x,{isOpen:H,onClose:()=>{V(!1),K(null),es()},measurement:W,onSuccess:es})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,s.jsx)("div",{className:"text-lg text-red-600",children:"조직 정보를 불러올 수 없습니다."})})}},6334:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(7437);a(2265);let r={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},n={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function i(e){let{variant:t="primary",size:a="md",className:i="",...l}=e;return(0,s.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(r[t]," ").concat(n[a]," ").concat(i),...l})}},2827:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(7437);function r(e){let{className:t="",...a}=e;return(0,s.jsx)("input",{className:"".concat("rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20"," ").concat(t),...a})}a(2265)},6819:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(7437);function r(e){let{className:t="",children:a,...r}=e;return(0,s.jsx)("select",{className:"".concat("w-full rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20"," ").concat(t),...r,children:a})}a(2265)},1515:function(e,t,a){"use strict";a.d(t,{Td:function(){return c},Th:function(){return d},Tr:function(){return l},hr:function(){return n},iA:function(){return r},p3:function(){return i}});var s=a(7437);function r(e){let{className:t="",...a}=e;return(0,s.jsx)("table",{className:"w-full text-sm border-collapse ".concat(t),...a})}function n(e){return(0,s.jsx)("thead",{...e})}function i(e){return(0,s.jsx)("tbody",{...e})}function l(e){return(0,s.jsx)("tr",{className:"border-b last:border-0 border-gray-200 dark:border-white/10",...e})}function d(e){let{className:t="",...a}=e;return(0,s.jsx)("th",{className:"text-left py-2 px-3 font-medium text-gray-600 dark:text-gray-300 ".concat(t),...a})}function c(e){let{className:t="",...a}=e;return(0,s.jsx)("td",{className:"py-2 px-3 ".concat(t),...a})}a(2265)},2891:function(e,t,a){"use strict";a.d(t,{OrganizationProvider:function(){return l},o:function(){return d}});var s=a(7437),r=a(2265),n=a(605);let i=(0,r.createContext)(void 0);function l(e){var t,a,l;let{children:d}=e,{data:c,status:o}=(0,n.useSession)(),[u,m]=(0,r.useState)(null),[x,h]=(0,r.useState)([]),[g,v]=(0,r.useState)(!0),p=(null==c?void 0:null===(t=c.user)||void 0===t?void 0:t.role)==="SUPER_ADMIN",y=null==c?void 0:null===(a=c.user)||void 0===a?void 0:a.role,j=null==c?void 0:null===(l=c.user)||void 0===l?void 0:l.organizationId,f="CUSTOMER_ADMIN"===y||"CUSTOMER_USER"===y;(0,r.useEffect)(()=>{if("loading"!==o){if(!c||f){v(!1);return}p&&sessionStorage.getItem("viewAsOrganization"),p?b():j?N(j):v(!1)}},[c,o,p,j,f]),(0,r.useEffect)(()=>{if(!p)return;let e=sessionStorage.getItem("viewAsOrganization");e&&(null==u?void 0:u.id)!==e&&b();let t=setInterval(()=>{let e=sessionStorage.getItem("viewAsOrganization");if(e&&(null==u?void 0:u.id)!==e)b();else if(!e&&u){let e=localStorage.getItem("selectedOrgId");e&&u.id!==e&&b()}},500);return()=>clearInterval(t)},[p,u]);let b=async()=>{try{let e=await fetch("/api/organizations?status=APPROVED"),t=await e.json();if(e.ok){let e=t.organizations||[];h(e);let a=sessionStorage.getItem("viewAsOrganization");if(a){let t=e.find(e=>e.id===a);if(t){m(t);return}}let s=localStorage.getItem("selectedOrgId");if(s){let t=e.find(e=>e.id===s);t?m(t):e.length>0&&m(e[0])}else e.length>0&&m(e[0])}}catch(e){}finally{v(!1)}},N=async e=>{try{let t=await fetch("/api/organizations/".concat(e)),a=await t.json();if(t.ok){let e=a.organization;h([e]),m(e)}}catch(e){}finally{v(!1)}};return(0,s.jsx)(i.Provider,{value:{selectedOrg:u,setSelectedOrg:e=>{m(e),e?localStorage.setItem("selectedOrgId",e.id):localStorage.removeItem("selectedOrgId")},organizations:x,loading:g,isSuperAdmin:p},children:d})}function d(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useOrganization must be used within OrganizationProvider");return e}},4755:function(e,t,a){"use strict";a.d(t,{n:function(){return i}});var s=a(2265),r=a(2891),n=a(605);function i(){var e,t;let[a,i]=(0,s.useState)([]),{selectedOrg:l}=(0,r.o)(),{data:d}=(0,n.useSession)(),c=null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.role,o=null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.customerId,u="CUSTOMER_ADMIN"===c||"CUSTOMER_USER"===c,m=(0,s.useCallback)(()=>{if(u&&o){fetch("/api/customers/".concat(o)).then(e=>e.json()).then(e=>{let t=e.customer||e.data;i(t?[t]:[])}).catch(e=>{i([])});return}if(!(null==l?void 0:l.id)){i([]);return}let e=new URLSearchParams;e.append("organizationId",l.id),e.append("tab","all"),fetch("/api/customers?".concat(e.toString())).then(e=>e.json()).then(e=>{i(e.customers||e.data||[])}).catch(e=>{i([])})},[l,u,o]);return(0,s.useEffect)(()=>{m()},[m]),{list:a,refetch:m}}},8776:function(e,t,a){"use strict";a.d(t,{F:function(){return i},r:function(){return l}});var s=a(2265),r=a(2891),n=a(605);function i(){let[e,t]=(0,s.useState)([]);return(0,s.useEffect)(()=>{let e=!0;return fetch("/api/items").then(e=>e.json()).then(a=>{e&&t(a.data||[])}).catch(()=>{e&&t([])}),()=>{e=!1}},[]),{items:e}}function l(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{customerId:a,stack:i,stacks:l,itemKey:d,page:c=1,pageSize:o=50,sort:u,start:m,end:x}=t,[h,g]=(0,s.useState)([]),[v,p]=(0,s.useState)(0),{selectedOrg:y}=(0,r.o)(),{data:j}=(0,n.useSession)(),f=null==j?void 0:null===(e=j.user)||void 0===e?void 0:e.role,b="CUSTOMER_ADMIN"===f||"CUSTOMER_USER"===f;(0,s.useEffect)(()=>{let e=!0,t=new AbortController;if(!b&&!(null==y?void 0:y.id)){g([]);return}let s=new URLSearchParams;return a&&s.set("customerId",a),l&&l.length?l.forEach(e=>s.append("stack",e)):i&&s.set("stack",i),d&&s.set("itemKey",d),m&&s.set("start",m),x&&s.set("end",x),(null==y?void 0:y.id)&&s.set("organizationId",y.id),fetch("/api/measurements?".concat(s.toString()),{signal:t.signal}).then(e=>e.json()).then(t=>{e&&g(Array.isArray(t.measurements)?t.measurements:Array.isArray(t.data)?t.data:[])}).catch(t=>{t.name,e&&g([])}),()=>{e=!1,t.abort()}},[a,i,(l||[]).join("|"),d,m,x,v,y,b]);let N=(0,s.useMemo)(()=>{if(!u)return h;let{key:e,dir:t}=u,a=[...h];return a.sort((a,s)=>{let r=a[e],n=s[e];return r<n?"asc"===t?-1:1:r>n?"asc"===t?1:-1:0}),a},[h,u]),k=N.length,w=(c-1)*o;return{data:o>=999999?N:N.slice(w,w+o),total:k,page:c,pageSize:o,mutate:()=>p(e=>e+1)}}},9548:function(e,t,a){"use strict";a.d(t,{D:function(){return n}});var s=a(2265),r=a(2891);function n(e){let[t,a]=(0,s.useState)([]),{selectedOrg:n}=(0,r.o)();return(0,s.useEffect)(()=>{let t=!0;if(!(null==n?void 0:n.id)){a([]);return}let s=new URLSearchParams;return e&&s.set("customerId",e),s.set("organizationId",n.id),fetch("/api/stacks?".concat(s.toString())).then(e=>e.json()).then(e=>{let s=(e.stacks||e.data||[]).filter(e=>!1!==e.isActive);t&&a(s)}).catch(e=>{t&&a([])}),()=>{t=!1}},[e,n]),{list:t}}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=8232)}),_N_E=e.O()}]);