(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6635],{5608:function(e,t,a){Promise.resolve().then(a.bind(a,937))},9376:function(e,t,a){"use strict";var r=a(5475);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},937:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(7437),s=a(2265),l=a(2397),n=a(9376),i=a(6334),c=a(2827);function o(){let{user:e}=(0,l.a)(),t=(0,n.useRouter)(),a=(0,n.useParams)(),o=null==a?void 0:a.id,[d,u]=(0,s.useState)(!0),[m,h]=(0,s.useState)(!1),[x,b]=(0,s.useState)(null),[g,f]=(0,s.useState)({code:"",fullName:"",facilityType:"",location:"",height:"",diameter:"",description:"",changeReason:""});(0,s.useEffect)(()=>{if((null==e?void 0:e.role)!=="CUSTOMER_ADMIN"){t.push("/dashboard");return}p()},[e,t,o]);let p=async()=>{try{var e,a;u(!0);let r=await fetch("/api/stacks/".concat(o));if(!r.ok){alert("굴뚝 정보를 불러올 수 없습니다."),t.push("/customer/stacks");return}let s=await r.json();b(s.data),f({code:s.data.code||"",fullName:s.data.fullName||"",facilityType:s.data.facilityType||"",location:s.data.location||"",height:(null===(e=s.data.height)||void 0===e?void 0:e.toString())||"",diameter:(null===(a=s.data.diameter)||void 0===a?void 0:a.toString())||"",description:s.data.description||"",changeReason:""})}catch(e){alert("오류가 발생했습니다."),t.push("/customer/stacks")}finally{u(!1)}},v=async e=>{if(e.preventDefault(),!g.changeReason.trim()){alert("수정 사유를 입력해주세요.");return}try{h(!0);let e=await fetch("/api/stacks/".concat(o),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g.code||null,fullName:g.fullName||null,facilityType:g.facilityType||null,location:g.location||null,height:g.height?parseFloat(g.height):null,diameter:g.diameter?parseFloat(g.diameter):null,description:g.description||null,changeReason:g.changeReason})}),a=await e.json();e.ok?(alert("굴뚝 정보가 수정되었습니다."),t.push("/customer/stacks?tab=confirmed")):alert(a.error||"수정 실패")}catch(e){alert("오류가 발생했습니다.")}finally{h(!1)}};return d?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})}):x?(0,r.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-1",children:"굴뚝 정보 수정"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["굴뚝번호: ",(0,r.jsx)("span",{className:"font-mono font-semibold",children:x.name})]})]}),(0,r.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:[(0,r.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:["\uD83D\uDCA1 ",(0,r.jsx)("strong",{children:"수정 가능 항목:"})," 굴뚝코드, 정식 명칭, 배출시설 종류, 위치, 높이, 직경, 설명"]}),(0,r.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300 mt-1",children:["⚠️ ",(0,r.jsx)("strong",{children:"수정 불가 항목:"})," 굴뚝번호 (환경측정기업 관리)"]})]}),(0,r.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"굴뚝코드 (선택)"}),(0,r.jsx)(c.Z,{value:g.code,onChange:e=>f({...g,code:e.target.value}),placeholder:"예: STACK-001"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"굴뚝 정식 명칭 (선택)"}),(0,r.jsx)(c.Z,{value:g.fullName,onChange:e=>f({...g,fullName:e.target.value}),placeholder:"예: 제1공장 배출구"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"배출시설 종류 (선택)"}),(0,r.jsx)(c.Z,{value:g.facilityType,onChange:e=>f({...g,facilityType:e.target.value}),placeholder:"예: 소각시설"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"위치 (선택)"}),(0,r.jsx)(c.Z,{value:g.location,onChange:e=>f({...g,location:e.target.value}),placeholder:"예: 제1공장 동측"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"굴뚝 높이 (m)"}),(0,r.jsx)(c.Z,{type:"number",step:"0.1",value:g.height,onChange:e=>f({...g,height:e.target.value}),placeholder:"예: 25.5"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"굴뚝 안지름 (m)"}),(0,r.jsx)(c.Z,{type:"number",step:"0.1",value:g.diameter,onChange:e=>f({...g,diameter:e.target.value}),placeholder:"예: 1.2"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"설명 (선택)"}),(0,r.jsx)("textarea",{value:g.description,onChange:e=>f({...g,description:e.target.value}),placeholder:"추가 설명을 입력하세요",className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700",rows:3})]}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1 text-red-600 dark:text-red-400",children:"수정 사유 (필수) *"}),(0,r.jsx)("textarea",{value:g.changeReason,onChange:e=>f({...g,changeReason:e.target.value}),placeholder:"수정 사유를 입력해주세요 (예: 현장 코드 변경, 높이 측정값 보정)",className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700",rows:2,required:!0})]}),(0,r.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,r.jsx)(i.Z,{type:"button",variant:"secondary",onClick:()=>t.push("/customer/stacks?tab=confirmed"),disabled:m,children:"취소"}),(0,r.jsx)(i.Z,{type:"submit",disabled:m,children:m?"저장 중...":"저장"})]})]})]}):null}},6334:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(7437);a(2265);let s={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},l={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function n(e){let{variant:t="primary",size:a="md",className:n="",...i}=e;return(0,r.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(s[t]," ").concat(l[a]," ").concat(n),...i})}},2827:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(7437);function s(e){let{className:t="",...a}=e;return(0,r.jsx)("input",{className:"".concat("rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20"," ").concat(t),...a})}a(2265)},2397:function(e,t,a){"use strict";a.d(t,{H:function(){return o},a:function(){return d}});var r=a(7437),s=a(2265),l=a(605),n=a(9376);function i(){return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900",children:[(0,r.jsxs)("div",{className:"mb-16",children:[(0,r.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-white text-center",children:"오염물질 측정 관리 시스템"}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:"Pollutant Measurement Management System"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("div",{className:"w-16 h-16 border-4 border-gray-200 dark:border-gray-700 border-t-blue-600 rounded-full animate-spin"})}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm font-medium",children:"로딩 중..."})]}),(0,r.jsx)("div",{className:"mt-16"})]})}let c=(0,s.createContext)(null);function o(e){let{children:t}=e,{data:a,status:o}=(0,l.useSession)(),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0),x=(0,n.usePathname)();(0,s.useEffect)(()=>{"loading"!==o&&h(!1),(null==a?void 0:a.user)?u(a.user):"unauthenticated"===o&&u(null)},[a,o]);let b="loading"===o||m;return!b||"/login"===x||(null==x?void 0:x.startsWith("/register"))||(null==x?void 0:x.startsWith("/invite"))||(null==x?void 0:x.startsWith("/auth"))?(0,r.jsx)(c.Provider,{value:{user:d,loading:b},children:t}):(0,r.jsx)(i,{})}function d(){let e=(0,s.useContext)(c);if(!e)throw Error("AuthProvider is missing");return e}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=5608)}),_N_E=e.O()}]);