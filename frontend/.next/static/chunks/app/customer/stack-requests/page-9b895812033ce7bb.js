(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8219],{6385:function(e,t,s){Promise.resolve().then(s.bind(s,3187))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},3187:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(7437),r=s(2265),n=s(605),c=s(9376);function l(){var e;let{data:t,status:s}=(0,n.useSession)(),l=(0,c.useRouter)(),[i,x]=(0,r.useState)([]),[d,o]=(0,r.useState)(!0),[p,u]=(0,r.useState)("ALL");(0,r.useEffect)(()=>{if("unauthenticated"===s){l.push("/login");return}if(null==t?void 0:t.user){let e=t.user.role;if("CUSTOMER_ADMIN"!==e&&"CUSTOMER_USER"!==e&&"SUPER_ADMIN"!==e){l.push("/dashboard");return}h()}},[t,s,l]);let h=async()=>{try{var e;o(!0);let s=null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.customerId,a=await fetch("/api/stack-requests?customerId=".concat(s)),r=await a.json();a.ok&&x(r.requests||[])}catch(e){}finally{o(!1)}},m=async(e,t)=>{if(confirm("이 굴뚝 ".concat("NEW_STACK"===t?"등록":"담당"," 요청을 승인하시겠습니까?")))try{let s=await fetch("/api/stack-requests/".concat(e,"/approve"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"NEW_STACK"===t?"create_new":"assign_existing"})});if(s.ok)alert("요청이 승인되었습니다."),h();else{let e=await s.json();alert(e.error||"승인 실패")}}catch(e){alert("승인 중 오류가 발생했습니다.")}},y=async e=>{if(confirm("이 요청을 거부하시겠습니까?"))try{let t=await fetch("/api/stack-requests/".concat(e,"/reject"),{method:"PATCH"});if(t.ok)alert("요청이 거부되었습니다."),h();else{let e=await t.json();alert(e.error||"거부 실패")}}catch(e){alert("거부 중 오류가 발생했습니다.")}},N=i.filter(e=>"ALL"===p||e.status===p),f=e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat({PENDING:"bg-yellow-100 text-yellow-800",APPROVED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800"}[e]),children:{PENDING:"대기중",APPROVED:"승인됨",REJECTED:"거부됨"}[e]}),j=e=>"NEW_STACK"===e?(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"신규 등록"}):(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800",children:"담당 추가"}),g=null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.role,v="CUSTOMER_ADMIN"===g||"SUPER_ADMIN"===g;return d?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"굴뚝 등록 요청 관리"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"환경측정기업의 굴뚝 등록 및 담당 요청 관리"})]}),(0,a.jsxs)("div",{className:"mb-4 flex flex-wrap gap-3 items-center",children:[(0,a.jsxs)("select",{value:p,onChange:e=>u(e.target.value),className:"border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"ALL",children:"전체"}),(0,a.jsx)("option",{value:"PENDING",children:"대기중"}),(0,a.jsx)("option",{value:"APPROVED",children:"승인됨"}),(0,a.jsx)("option",{value:"REJECTED",children:"거부됨"})]}),(0,a.jsxs)("div",{className:"ml-auto text-sm text-gray-500",children:["총 ",N.length,"건"]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"상태"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"요청유형"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"요청기업"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"굴뚝명"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"굴뚝코드"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"위치"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"제원"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"요청일"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"액션"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===N.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:9,className:"px-6 py-4 text-center text-gray-500",children:"굴뚝 등록 요청이 없습니다."})}):N.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:f(e.status)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:j(e.requestType)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:e.organization.name}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-900",children:e.stackName}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500",children:e.stackCode||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500",children:e.location}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.height&&e.diameter?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:["높이: ",e.height,"m"]}),(0,a.jsxs)("div",{children:["직경: ",e.diameter,"m"]})]}):"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:["PENDING"===e.status&&v&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>m(e.id,e.requestType),className:"text-green-600 hover:text-green-900",children:"승인"}),(0,a.jsx)("button",{onClick:()=>y(e.id),className:"text-red-600 hover:text-red-900",children:"거부"})]}),"PENDING"!==e.status&&(0,a.jsx)("span",{className:"text-gray-400",children:"-"})]})]},e.id))})]})})]})}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=6385)}),_N_E=e.O()}]);