(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2878],{3786:function(e,t,a){Promise.resolve().then(a.bind(a,8763))},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},8763:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var s=a(7437),r=a(2265),c=a(605),o=a(9376);let n=[{code:"customer.tab.all",name:"전체탭 보기",category:"고객사 관리"},{code:"customer.tab.internal",name:"내부탭 보기",category:"고객사 관리"},{code:"customer.tab.connected",name:"연결탭 보기",category:"고객사 관리"},{code:"customer.tab.search",name:"검색탭 보기",category:"고객사 관리"},{code:"customer.view",name:"고객사 조회",category:"고객사 관리"},{code:"customer.create",name:"고객사 등록",category:"고객사 관리"},{code:"customer.update",name:"고객사 수정",category:"고객사 관리"},{code:"customer.delete",name:"고객사 삭제",category:"고객사 관리"},{code:"customer.activate",name:"활성화/비활성화",category:"고객사 관리"},{code:"customer.search",name:"검색 기능",category:"고객사 관리"},{code:"customer.filter",name:"필터 기능",category:"고객사 관리"},{code:"customer.bulk_upload",name:"일괄업로드",category:"고객사 관리"},{code:"customer.export",name:"Excel 내보내기",category:"고객사 관리"},{code:"customer.invite",name:"고객사 초대",category:"고객사 관리"},{code:"stack.view",name:"굴뚝 조회",category:"굴뚝 관리"},{code:"stack.create",name:"굴뚝 등록",category:"굴뚝 관리"},{code:"stack.update",name:"굴뚝 수정",category:"굴뚝 관리"},{code:"stack.delete",name:"굴뚝 삭제",category:"굴뚝 관리"},{code:"measurement.view",name:"측정 데이터 조회",category:"측정 데이터"},{code:"measurement.create",name:"측정 데이터 입력",category:"측정 데이터"},{code:"measurement.update",name:"측정 데이터 수정",category:"측정 데이터"},{code:"measurement.delete",name:"측정 데이터 삭제",category:"측정 데이터"},{code:"measurement.export",name:"측정 데이터 내보내기",category:"측정 데이터"},{code:"user.view",name:"사용자 조회",category:"사용자 관리"},{code:"user.create",name:"사용자 등록",category:"사용자 관리"},{code:"user.update",name:"사용자 수정",category:"사용자 관리"},{code:"user.delete",name:"사용자 삭제",category:"사용자 관리"},{code:"user.role",name:"역할 관리",category:"사용자 관리"},{code:"report.view",name:"보고서 조회",category:"보고서"},{code:"report.create",name:"보고서 생성",category:"보고서"},{code:"report.update",name:"보고서 수정",category:"보고서"},{code:"report.delete",name:"보고서 삭제",category:"보고서"},{code:"settings.view",name:"설정 조회",category:"설정"},{code:"settings.update",name:"설정 변경",category:"설정"},{code:"contract.view",name:"계약 조회",category:"계약 관리"},{code:"contract.create",name:"계약 등록",category:"계약 관리"},{code:"contract.update",name:"계약 수정",category:"계약 관리"},{code:"contract.delete",name:"계약 삭제",category:"계약 관리"}];function l(){let{data:e,status:t}=(0,c.useSession)(),a=(0,o.useRouter)(),l=(0,o.useParams)().id,[d,m]=(0,r.useState)(null),[u,i]=(0,r.useState)(""),[g,h]=(0,r.useState)(""),[y,x]=(0,r.useState)(new Set),[p,b]=(0,r.useState)(!0),[f,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if("unauthenticated"===t){a.push("/login");return}if(null==e?void 0:e.user){let t=e.user.role;if("ORG_ADMIN"!==t&&"SUPER_ADMIN"!==t){a.push("/dashboard");return}j()}},[e,t,a,l]);let j=async()=>{b(!0);try{let e=await fetch("/api/custom-roles/".concat(l)),t=await e.json();if(e.ok&&t.customRole){m(t.customRole),i(t.customRole.name),h(t.customRole.description||"");let e=new Set(t.customRole.permissions.filter(e=>e.granted).map(e=>e.permissionCode));x(e)}else alert("역할을 찾을 수 없습니다."),a.push("/org/settings/roles")}catch(e){alert("역할 조회 중 오류가 발생했습니다.")}finally{b(!1)}},N=e=>{let t=new Set(y);t.has(e)?t.delete(e):t.add(e),x(t)},w=async e=>{if(e.preventDefault(),!u){alert("역할 이름을 입력해주세요.");return}if(0===y.size){alert("최소 1개 이상의 권한을 선택해주세요.");return}v(!0);try{let e=await fetch("/api/custom-roles/".concat(l),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u,description:g,permissions:Array.from(y).map(e=>({permissionCode:e,granted:!0}))})}),t=await e.json();e.ok?(alert("역할이 수정되었습니다!"),a.push("/org/settings/roles")):alert(t.error||"역할 수정 실패")}catch(e){alert("역할 수정 중 오류가 발생했습니다.")}finally{v(!1)}};if(p)return(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})});if(!d)return null;let k=n.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{});return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("button",{onClick:()=>a.push("/org/settings/roles"),className:"text-blue-600 hover:text-blue-700 mb-2",children:"← 역할 관리로 돌아가기"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"역할 수정"}),(0,s.jsxs)("p",{className:"text-gray-600 mt-1",children:[d._count.users,"명의 사용자가 이 역할을 사용 중입니다."]})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("form",{onSubmit:w,children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"기본 정보"}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"역할 이름 *"}),(0,s.jsx)("input",{type:"text",value:u,onChange:e=>i(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"예: 현장 책임자",required:!0})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명"}),(0,s.jsx)("textarea",{value:g,onChange:e=>h(e.target.value),className:"w-full border rounded px-3 py-2",rows:2,placeholder:"역할에 대한 설명을 입력하세요"})]}),d.template&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"기반 템플릿"}),(0,s.jsx)("div",{className:"px-3 py-2 bg-gray-50 rounded text-gray-700",children:d.template.name})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold mb-3",children:["권한 선택 (",y.size,"개 선택됨)"]}),(0,s.jsx)("div",{className:"space-y-4",children:Object.entries(k).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"border rounded p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900",children:t}),(0,s.jsx)("button",{type:"button",onClick:()=>{let e=a.map(e=>e.code),t=e.every(e=>y.has(e)),s=new Set(y);t?e.forEach(e=>s.delete(e)):e.forEach(e=>s.add(e)),x(s)},className:"text-sm text-blue-600 hover:text-blue-700",children:a.every(e=>y.has(e.code))?"전체 해제":"전체 선택"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:a.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[(0,s.jsx)("input",{type:"checkbox",checked:y.has(e.code),onChange:()=>N(e.code),className:"rounded"}),(0,s.jsx)("span",{className:"text-sm text-gray-700",children:e.name})]},e.code))})]},t)})})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>a.push("/org/settings/roles"),className:"flex-1 px-4 py-2 border rounded hover:bg-gray-50",disabled:f,children:"취소"}),(0,s.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",disabled:f,children:f?"저장 중...":"변경사항 저장"})]})]})})]})}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=3786)}),_N_E=e.O()}]);