(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1201],{3599:function(e,t,a){Promise.resolve().then(a.bind(a,6392))},6392:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var s=a(7437),r=a(2265),l=a(605),d=a(9376),i=a(6334),n=a(4358),c=a(7648);function x(){let{data:e,status:t}=(0,l.useSession)(),a=(0,d.useRouter)(),x=(0,d.useParams)(),u=null==x?void 0:x.id,[h,y]=(0,r.useState)(null),[b,p]=(0,r.useState)(!0),[j,v]=(0,r.useState)(!1),[f,N]=(0,r.useState)(""),[k,w]=(0,r.useState)(!1),[C,A]=(0,r.useState)({});(0,r.useEffect)(()=>{if("unauthenticated"===t)a.push("/login");else if("authenticated"===t){var s;"SUPER_ADMIN"!==(null==e?void 0:null===(s=e.user)||void 0===s?void 0:s.role)?a.push("/dashboard"):S()}},[t,e,a,u]);let S=async()=>{try{p(!0);let e=await fetch("/api/customers/".concat(u)),t=await e.json();e.ok?y(t.customer):(alert(t.error||"고객회사 정보를 불러오는데 실패했습니다."),a.push("/admin/customers"))}catch(e){alert("고객회사 정보를 불러오는데 실패했습니다."),a.push("/admin/customers")}finally{p(!1)}},_=async()=>{if(!f){alert("새 관리자를 선택해주세요.");return}if(confirm("관리자를 변경하시겠습니까?"))try{let e=await fetch("/api/customers/".concat(u,"/change-admin"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({newAdminId:f})}),t=await e.json();e.ok?(alert(t.message),v(!1),S()):alert(t.error||"관리자 변경에 실패했습니다.")}catch(e){alert("관리자 변경 중 오류가 발생했습니다.")}},T=(e,t)=>{A(a=>({...a,[e]:t}))},E=async()=>{if(confirm("고객회사 정보를 수정하시겠습니까?"))try{let e=await fetch("/api/customers/".concat(u),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)}),t=await e.json();e.ok?(alert(t.message),w(!1),S()):alert(t.error||"정보 수정에 실패했습니다.")}catch(e){alert("정보 수정 중 오류가 발생했습니다.")}};if(b||!h)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-lg",children:"로딩 중..."})});let O=h.users.find(e=>"CUSTOMER_ADMIN"===e.role),M=h.users.filter(e=>"CUSTOMER_USER"===e.role&&"APPROVED"===e.status);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,s.jsx)(n.Z,{}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto p-8",children:[(0,s.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"고객회사 상세"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:h.name})]}),(0,s.jsx)(c.default,{href:"/admin/customers",children:(0,s.jsx)(i.Z,{children:"← 목록으로"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"회사 정보"}),k?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.Z,{onClick:E,className:"text-sm px-3 py-1 bg-green-600 hover:bg-green-700 text-white",children:"저장"}),(0,s.jsx)(i.Z,{onClick:()=>{w(!1),A({})},className:"text-sm px-3 py-1 bg-gray-300 hover:bg-gray-400 text-gray-800",children:"취소"})]}):(0,s.jsx)(i.Z,{onClick:()=>{A({name:null==h?void 0:h.name,code:(null==h?void 0:h.code)||"",businessNumber:(null==h?void 0:h.businessNumber)||"",fullName:(null==h?void 0:h.fullName)||"",siteType:(null==h?void 0:h.siteType)||"",address:(null==h?void 0:h.address)||"",industry:(null==h?void 0:h.industry)||"",siteCategory:(null==h?void 0:h.siteCategory)||""}),w(!0)},className:"text-sm px-3 py-1",children:"수정"})]}),k?(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(g,{label:"고객사명(약칭)",value:C.name||"",onChange:e=>T("name",e),required:!0}),(0,s.jsx)(g,{label:"고객사 코드",value:C.code||"",onChange:e=>T("code",e)}),(0,s.jsx)(g,{label:"사업자등록번호",value:C.businessNumber||"",onChange:e=>T("businessNumber",e)}),(0,s.jsx)(g,{label:"고객사명(정식)",value:C.fullName||"",onChange:e=>T("fullName",e)}),(0,s.jsx)(g,{label:"사업장 구분",value:C.siteType||"",onChange:e=>T("siteType",e)}),(0,s.jsx)(g,{label:"업종",value:C.industry||"",onChange:e=>T("industry",e)}),(0,s.jsx)(g,{label:"사업장 종별",value:C.siteCategory||"",onChange:e=>T("siteCategory",e)}),(0,s.jsx)("div",{}),(0,s.jsx)(g,{label:"주소",value:C.address||"",onChange:e=>T("address",e),className:"md:col-span-2"})]}):(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(o,{label:"고객사명(약칭)",value:h.name}),(0,s.jsx)(o,{label:"고객사 코드",value:h.code}),(0,s.jsx)(o,{label:"사업자등록번호",value:h.businessNumber}),(0,s.jsx)(o,{label:"고객사명(정식)",value:h.fullName}),(0,s.jsx)(o,{label:"사업장 구분",value:h.siteType}),(0,s.jsx)(o,{label:"업종",value:h.industry}),(0,s.jsx)(o,{label:"사업장 종별",value:h.siteCategory}),(0,s.jsx)(o,{label:"승인 상태",value:h.isActive?"활성":"승인 대기",valueClassName:h.isActive?"text-green-600":"text-yellow-600"}),(0,s.jsx)(o,{label:"주소",value:h.address,className:"md:col-span-2"})]})]}),h.organization&&(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"소속 환경측정기업"}),(0,s.jsx)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:(0,s.jsx)("div",{className:"text-lg font-medium text-gray-900 dark:text-white",children:h.organization.name})})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"관리자 정보"}),M.length>0&&(0,s.jsx)(i.Z,{onClick:()=>v(!j),className:"text-sm px-3 py-1",children:j?"취소":"관리자 변경"})]}),O?(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(o,{label:"이름",value:O.name}),(0,s.jsx)(o,{label:"이메일",value:O.email}),(0,s.jsx)(o,{label:"전화번호",value:O.phone}),(0,s.jsx)(o,{label:"부서",value:O.department}),(0,s.jsx)(o,{label:"직책",value:O.position}),(0,s.jsx)(o,{label:"상태",value:O.isActive?"활성":"비활성",valueClassName:O.isActive?"text-green-600":"text-gray-400"})]}):(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"관리자가 없습니다."}),j&&M.length>0&&(0,s.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"새 관리자 선택"}),(0,s.jsxs)("select",{value:f,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white mb-3",children:[(0,s.jsx)("option",{value:"",children:"선택하세요"}),M.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.email,") - ",e.department||"부서 없음"]},e.id))]}),(0,s.jsx)(i.Z,{onClick:_,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:"관리자 변경"})]})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["사용자 목록 (",h.users.length,"명)"]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,s.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"이름"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"이메일"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"역할"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"부서/직책"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"상태"})]})}),(0,s.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:h.users.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.name}),(0,s.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.email}),(0,s.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("CUSTOMER_ADMIN"===e.role?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"),children:"CUSTOMER_ADMIN"===e.role?"관리자":"사용자"})}),(0,s.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:[e.department||"-"," / ",e.position||"-"]}),(0,s.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat(e.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"),children:e.isActive?"활성":"비활성"})})]},e.id))})]})})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"통계"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(m,{label:"사용자 수",value:h._count.users}),(0,s.jsx)(m,{label:"굴뚝 수",value:h._count.stacks}),(0,s.jsx)(m,{label:"측정 데이터",value:h._count.measurements})]})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"굴뚝 목록"}),h.stacks.length>0?(0,s.jsx)("div",{className:"space-y-2",children:h.stacks.map(e=>(0,s.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),e.code&&(0,s.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["코드: ",e.code]}),(0,s.jsx)("div",{className:"text-xs mt-1",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(e.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"),children:e.isActive?"활성":"비활성"})})]},e.id))}):(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"등록된 굴뚝이 없습니다."})]})]})]})]})]})}function o(e){let{label:t,value:a,className:r="",valueClassName:l=""}=e;return(0,s.jsxs)("div",{className:r,children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t}),(0,s.jsx)("div",{className:"mt-1 text-sm text-gray-900 dark:text-white ".concat(l),children:a||"-"})]})}function m(e){let{label:t,value:a}=e;return(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),(0,s.jsx)("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a})]})}function g(e){let{label:t,value:a,onChange:r,className:l="",type:d="text",required:i=!1}=e;return(0,s.jsxs)("div",{className:l,children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t,i&&(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsx)("input",{type:d,value:a,onChange:e=>r(e.target.value),required:i,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}},4358:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(7437),r=a(605),l=a(9376),d=a(2265);function i(){var e,t;let{data:a}=(0,r.useSession)();(0,l.useRouter)();let[i,n]=(0,d.useState)(!1),c=(null==a?void 0:null===(e=a.user)||void 0===e?void 0:e.name)||"",x=(null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.email)||"";return(0,s.jsx)("header",{className:"h-16 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 sticky top-0 z-40",children:(0,s.jsxs)("div",{className:"mx-auto h-full px-6 flex items-center justify-between",children:[(0,s.jsx)("div",{children:(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"시스템 관리자"})}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>n(!i),className:"flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white font-semibold",children:c.charAt(0).toUpperCase()}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:c}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>n(!1)}),(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:c}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:x})]}),(0,s.jsx)("div",{className:"py-1",children:(0,s.jsx)("button",{onClick:()=>{sessionStorage.removeItem("viewAsOrganization"),sessionStorage.removeItem("viewAsCustomer"),(0,r.signOut)({callbackUrl:"/login"})},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700",children:"로그아웃"})})]})]})]})]})})}},6334:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var s=a(7437);a(2265);let r={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},l={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function d(e){let{variant:t="primary",size:a="md",className:d="",...i}=e;return(0,s.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(r[t]," ").concat(l[a]," ").concat(d),...i})}}},function(e){e.O(0,[605,3448,2971,2117,1744],function(){return e(e.s=3599)}),_N_E=e.O()}]);