(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8944],{8881:function(e,s,r){Promise.resolve().then(r.bind(r,8153))},8153:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return m}});var a=r(7437),t=r(2265),l=r(605),d=r(9376),n=r(7648),i=r(4358),c=r(6334),x=r(2827),o=r(8653);function m(){let{data:e,status:s}=(0,l.useSession)(),r=(0,d.useRouter)(),[m,g]=(0,t.useState)([]),[p,u]=(0,t.useState)([]),[b,j]=(0,t.useState)(!0),[y,N]=(0,t.useState)(null),[v,f]=(0,t.useState)(!1),[k,w]=(0,t.useState)(""),[D,C]=(0,t.useState)(!1),[A,R]=(0,t.useState)("ALL");(0,t.useEffect)(()=>{if("unauthenticated"===s){r.push("/login");return}if(null==e?void 0:e.user){let s=e.user.role;if("ORG_ADMIN"!==s&&"SUPER_ADMIN"!==s){r.push("/dashboard");return}S()}},[e,s,r]);let S=async()=>{j(!0);try{await Promise.all([O(),E()])}finally{j(!1)}},O=async()=>{try{let e=await fetch("/api/users"),s=await e.json();e.ok&&g(s.users||[])}catch(e){}},E=async()=>{try{let e=await fetch("/api/custom-roles"),s=await e.json();e.ok&&u(s.customRoles||[])}catch(e){}},M=async(e,s)=>{try{let r=await fetch("/api/users/".concat(e,"/role"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({customRoleId:s})});if(r.ok)alert("역할이 변경되었습니다."),O();else{let e=await r.json();alert(e.error||"역할 변경 실패")}}catch(e){alert("역할 변경 중 오류가 발생했습니다.")}},_=e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat({SUPER_ADMIN:"bg-purple-100 text-purple-800",ORG_ADMIN:"bg-blue-100 text-blue-800",OPERATOR:"bg-green-100 text-green-800",CUSTOMER_GROUP_ADMIN:"bg-yellow-100 text-yellow-800",CUSTOMER_SITE_ADMIN:"bg-orange-100 text-orange-800",CUSTOMER_USER:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),children:{SUPER_ADMIN:"시스템 관리자",ORG_ADMIN:"조직 관리자",OPERATOR:"실무자",CUSTOMER_GROUP_ADMIN:"그룹 관리자",CUSTOMER_SITE_ADMIN:"사업장 관리자",CUSTOMER_USER:"일반 사용자"}[e]||e}),I=e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs bg-gray-100 text-gray-700",children:{SYSTEM:"시스템 전체",ORGANIZATION:"조직 전체",GROUP:"그룹",SITE:"사업장",ASSIGNED:"담당",SELF:"본인"}[e]||e});return b?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,a.jsx)(i.Z,{}),(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,a.jsx)(i.Z,{}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"사용자 권한 관리"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"사용자별 역할 및 권한 설정"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"도움말"]}),(0,a.jsx)(n.default,{href:"/admin/dashboard",children:(0,a.jsx)(c.Z,{children:"← 대시보드로"})})]})]}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"전체 "}),(0,a.jsx)("span",{className:"font-bold text-gray-900 dark:text-white",children:m.length})]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"활성 "}),(0,a.jsx)("span",{className:"font-bold text-green-600",children:m.filter(e=>e.isActive).length})]})]}),(0,a.jsx)("div",{className:"h-6 w-px bg-gray-300 dark:bg-gray-600"}),(0,a.jsx)(x.Z,{type:"text",placeholder:"사용자 이름 또는 이메일 검색...",value:k,onChange:e=>w(e.target.value),className:"flex-1 min-w-[200px]"}),(0,a.jsxs)("select",{value:A,onChange:e=>R(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white",children:[(0,a.jsx)("option",{value:"ALL",children:"전체 역할"}),(0,a.jsx)("option",{value:"ORG_ADMIN",children:"조직 관리자"}),(0,a.jsx)("option",{value:"OPERATOR",children:"실무자"}),(0,a.jsx)("option",{value:"CUSTOMER_ADMIN",children:"고객사 관리자"}),(0,a.jsx)("option",{value:"CUSTOMER_USER",children:"고객사 사용자"})]})]})}),(0,a.jsx)("div",{className:"hidden md:block bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50 sticky top-0 z-10",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"이름"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"이메일"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"시스템 역할"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"커스텀 역할"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"접근 범위"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"상태"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"액션"})]})}),(0,a.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:m.filter(e=>{let s=""===k||e.name.toLowerCase().includes(k.toLowerCase())||e.email.toLowerCase().includes(k.toLowerCase()),r="ALL"===A||e.role===A;return s&&r}).map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:e.name}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:_(e.role)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.customRole?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200 rounded text-xs font-medium",children:e.customRole.name}),(0,a.jsxs)("select",{value:e.customRole.id,onChange:s=>M(e.id,s.target.value||null),className:"border rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600",disabled:"SUPER_ADMIN"===e.role,children:[(0,a.jsx)("option",{value:e.customRole.id,children:e.customRole.name}),(0,a.jsx)("option",{value:"",children:"기본 역할로 변경"}),p.filter(s=>{var r;return s.id!==(null===(r=e.customRole)||void 0===r?void 0:r.id)}).map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded text-xs",children:"기본 역할"}),(0,a.jsxs)("select",{value:"",onChange:s=>M(e.id,s.target.value||null),className:"border rounded px-2 py-1 text-xs dark:bg-gray-700 dark:border-gray-600",disabled:"SUPER_ADMIN"===e.role,children:[(0,a.jsx)("option",{value:"",children:"선택"}),p.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:I(e.accessScope)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"활성":"비활성"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,a.jsx)("button",{onClick:()=>{N(e),f(!0)},className:"text-blue-600 hover:text-blue-900",disabled:"SUPER_ADMIN"===e.role,children:"개별 권한 설정"})})]},e.id))})]})})}),(0,a.jsx)("div",{className:"md:hidden space-y-3",children:m.filter(e=>{let s=""===k||e.name.toLowerCase().includes(k.toLowerCase())||e.email.toLowerCase().includes(k.toLowerCase()),r="ALL"===A||e.role===A;return s&&r}).map(e=>(0,a.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("div",{className:"font-medium text-lg",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"활성":"비활성"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCE7 이메일:"})," ",e.email]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFF7️ 시스템 역할:"})," ",_(e.role)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFAF 커스텀 역할:"})," ",e.customRole?(0,a.jsx)("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200 rounded text-xs font-medium",children:e.customRole.name}):(0,a.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded text-xs",children:"기본 역할"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDD11 접근 범위:"})," ",I(e.accessScope)]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)("button",{onClick:()=>{N(e),f(!0)},disabled:"SUPER_ADMIN"===e.role,className:"w-full px-3 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded text-sm disabled:opacity-50",children:"개별 권한 설정"})})]})]},e.id))}),v&&y&&(0,a.jsx)(h,{user:y,onClose:()=>{f(!1),N(null)},onSuccess:()=>{f(!1),N(null),O()}}),(0,a.jsx)(o.Z,{isOpen:D,onClose:()=>C(!1),title:"권한 관리 가이드",sections:[{title:"개요",content:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-600 p-4 rounded",children:[(0,a.jsx)("h4",{className:"font-bold text-purple-900 dark:text-purple-200 mb-2",children:"\uD83D\uDCCC 이 페이지의 목적"}),(0,a.jsxs)("p",{className:"text-purple-800 dark:text-purple-300",children:["권한 관리 페이지는 ",(0,a.jsx)("strong",{children:"커스텀 역할 할당"}),"과 ",(0,a.jsx)("strong",{children:"세부 권한 설정"}),"을 관리하는 곳입니다."]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-semibold text-lg",children:"주요 기능"}),(0,a.jsxs)("ul",{className:"space-y-2",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-green-600 mt-1",children:"✓"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"커스텀 역할 할당"}),": 조직별로 생성한 역할을 사용자에게 할당"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-green-600 mt-1",children:"✓"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"접근 범위 조정"}),": 사용자가 접근할 수 있는 데이터 범위 설정"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-green-600 mt-1",children:"✓"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"개별 권한 설정"}),": 특정 사용자에게만 추가 권한 부여 또는 제한"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 p-4 rounded",children:[(0,a.jsx)("h5",{className:"font-semibold mb-2",children:"\uD83D\uDCA1 사용자 관리와의 차이"}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("strong",{children:"사용자 관리"}),"는 시스템 기본 역할(ORG_ADMIN, OPERATOR 등)을 변경하고,",(0,a.jsx)("strong",{className:"text-purple-600",children:" 권한 관리(이 페이지)"}),"는 커스텀 역할을 할당하여 세부 권한을 조정합니다."]})]})]})},{title:"커스텀 역할",content:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-lg",children:"\uD83C\uDFAD 커스텀 역할이란?"}),(0,a.jsx)("div",{className:"bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-600 p-4 rounded",children:(0,a.jsxs)("p",{className:"text-purple-800 dark:text-purple-300 text-sm",children:["커스텀 역할은 ",(0,a.jsx)("strong",{children:"조직별로 생성한 맞춤형 역할"}),"입니다. 시스템 기본 역할의 권한을 기반으로 하되, 조직의 필요에 따라 권한을 추가하거나 제한할 수 있습니다."]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h5",{className:"font-semibold",children:"커스텀 역할 예시"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,a.jsxs)("div",{className:"border dark:border-gray-700 rounded-lg p-3 bg-blue-50 dark:bg-blue-900/20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDC54"}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"선임 실무자"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"기본 OPERATOR 권한 + 측정 데이터 승인 권한 + 보고서 작성 권한"})]}),(0,a.jsxs)("div",{className:"border dark:border-gray-700 rounded-lg p-3 bg-green-50 dark:bg-green-900/20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83C\uDF0D"}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"지역 관리자"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"특정 지역 고객사만 관리 + 해당 지역 직원 관리 권한"})]}),(0,a.jsxs)("div",{className:"border dark:border-gray-700 rounded-lg p-3 bg-orange-50 dark:bg-orange-900/20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCCA"}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"데이터 분석가"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"모든 측정 데이터 조회 권한 + 통계 분석 권한 (수정 권한 없음)"})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[(0,a.jsx)("h5",{className:"font-semibold mb-2",children:"\uD83D\uDCDD 커스텀 역할 할당 방법"}),(0,a.jsxs)("ol",{className:"text-sm space-y-2",children:[(0,a.jsx)("li",{children:"1. 커스텀 역할 컬럼에서 드롭다운 메뉴 클릭"}),(0,a.jsx)("li",{children:'2. 할당할 커스텀 역할 선택 (또는 "기본 역할 사용" 선택)'}),(0,a.jsx)("li",{children:"3. 자동으로 저장됨"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:'\uD83D\uDCA1 커스텀 역할은 "역할 관리" 메뉴에서 생성할 수 있습니다.'})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 p-4 rounded-lg",children:[(0,a.jsx)("h5",{className:"font-semibold mb-2",children:"⚠️ 주의사항"}),(0,a.jsxs)("ul",{className:"text-sm space-y-1",children:[(0,a.jsx)("li",{children:"• SUPER_ADMIN에게는 커스텀 역할을 할당할 수 없습니다"}),(0,a.jsx)("li",{children:"• 커스텀 역할이 없으면 시스템 기본 역할의 권한이 적용됩니다"}),(0,a.jsx)("li",{children:"• 커스텀 역할을 할당하면 시스템 역할의 권한을 오버라이드합니다"})]})]})]})},{title:"접근 범위",content:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-lg",children:"\uD83C\uDFAF 접근 범위(Access Scope)"}),(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-600 p-4 rounded",children:(0,a.jsxs)("p",{className:"text-blue-800 dark:text-blue-300 text-sm",children:["접근 범위는 사용자가 ",(0,a.jsx)("strong",{children:"어떤 데이터에 접근할 수 있는지"}),"를 정의합니다."]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"border-l-4 border-purple-500 bg-purple-50 dark:bg-purple-900/20 p-3 rounded",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 bg-purple-600 text-white rounded text-xs font-bold",children:"SYSTEM"}),(0,a.jsx)("span",{className:"font-semibold text-sm",children:"시스템 전체"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"모든 조직, 모든 고객사의 데이터에 접근 가능 (SUPER_ADMIN 전용)"})]}),(0,a.jsxs)("div",{className:"border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-900/20 p-3 rounded",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 bg-blue-600 text-white rounded text-xs font-bold",children:"ORGANIZATION"}),(0,a.jsx)("span",{className:"font-semibold text-sm",children:"조직 전체"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"자신이 속한 조직의 모든 고객사 데이터에 접근 가능 (ORG_ADMIN 기본값)"})]}),(0,a.jsxs)("div",{className:"border-l-4 border-orange-500 bg-orange-50 dark:bg-orange-900/20 p-3 rounded",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 bg-orange-600 text-white rounded text-xs font-bold",children:"ASSIGNED"}),(0,a.jsx)("span",{className:"font-semibold text-sm",children:"담당"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"자신에게 할당된 고객사의 데이터만 접근 가능 (OPERATOR 기본값)"})]}),(0,a.jsxs)("div",{className:"border-l-4 border-gray-500 bg-gray-50 dark:bg-gray-900/20 p-3 rounded",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-600 text-white rounded text-xs font-bold",children:"SELF"}),(0,a.jsx)("span",{className:"font-semibold text-sm",children:"본인"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"자신의 데이터만 접근 가능 (고객사 사용자 기본값)"})]})]})]})},{title:"개별 권한",content:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-lg",children:"\uD83D\uDD27 개별 권한 설정"}),(0,a.jsxs)("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-600 p-4 rounded",children:[(0,a.jsx)("h5",{className:"font-bold text-orange-900 dark:text-orange-200 mb-2",children:"개별 권한이란?"}),(0,a.jsxs)("p",{className:"text-orange-800 dark:text-orange-300 text-sm",children:["특정 사용자에게만 ",(0,a.jsx)("strong",{children:"추가 권한을 부여"}),"하거나 ",(0,a.jsx)("strong",{children:"일부 권한을 제한"}),"할 수 있는 기능입니다."]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[(0,a.jsx)("h5",{className:"font-semibold mb-2",children:"\uD83D\uDCDD 개별 권한 설정 방법"}),(0,a.jsxs)("ol",{className:"text-sm space-y-2",children:[(0,a.jsx)("li",{children:'1. 액션 컬럼에서 "개별 권한 설정" 버튼 클릭'}),(0,a.jsx)("li",{children:"2. 권한 설정 모달에서 권한 코드 선택"}),(0,a.jsx)("li",{children:"3. 권한 부여(Grant) 또는 거부(Deny) 선택"}),(0,a.jsx)("li",{children:"4. 저장 버튼 클릭"})]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[(0,a.jsx)("h5",{className:"font-semibold mb-2",children:"\uD83C\uDFAF 권한 적용 순서"}),(0,a.jsxs)("ol",{className:"text-sm space-y-2",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"font-bold text-blue-600",children:"1."}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"개별 권한"})," (최우선)",(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"특정 사용자에게 설정한 권한"})]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"font-bold text-blue-600",children:"2."}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"커스텀 역할 권한"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"할당된 커스텀 역할의 권한"})]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"font-bold text-blue-600",children:"3."}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"시스템 역할 권한"})," (기본값)",(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ORG_ADMIN, OPERATOR 등의 기본 권한"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h5",{className:"font-semibold",children:"사용 예시"}),(0,a.jsxs)("div",{className:"border-l-4 border-green-500 bg-green-50 dark:bg-green-900/20 p-3 rounded",children:[(0,a.jsx)("strong",{className:"text-green-700 dark:text-green-400 text-sm",children:"예시 1: 추가 권한 부여"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"일반 OPERATOR에게 보고서 승인 권한 추가"})]}),(0,a.jsxs)("div",{className:"border-l-4 border-red-500 bg-red-50 dark:bg-red-900/20 p-3 rounded",children:[(0,a.jsx)("strong",{className:"text-red-700 dark:text-red-400 text-sm",children:"예시 2: 권한 제한"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"특정 관리자의 삭제 권한만 제한"})]})]})]})},{title:"vs 사용자 관리",content:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-lg",children:"\uD83D\uDD04 권한 관리 vs 사용자 관리"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"border-2 border-purple-300 dark:border-purple-700 rounded-lg p-4",children:[(0,a.jsxs)("h5",{className:"font-bold text-purple-900 dark:text-purple-200 mb-3 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDD10"}),"권한 관리 (이 페이지)"]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/30 p-2 rounded",children:[(0,a.jsx)("strong",{children:"목적:"})," 세부 권한 설정"]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("strong",{children:"주요 기능:"}),(0,a.jsxs)("ul",{className:"ml-4 space-y-1",children:[(0,a.jsx)("li",{children:"• 커스텀 역할 할당"}),(0,a.jsx)("li",{children:"• 접근 범위 조정"}),(0,a.jsx)("li",{children:"• 개별 권한 설정"})]})]})]})]}),(0,a.jsxs)("div",{className:"border-2 border-blue-300 dark:border-blue-700 rounded-lg p-4",children:[(0,a.jsxs)("h5",{className:"font-bold text-blue-900 dark:text-blue-200 mb-3 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC65"}),"사용자 관리"]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-2 rounded",children:[(0,a.jsx)("strong",{children:"목적:"})," 계정 생명주기 관리"]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("strong",{children:"주요 기능:"}),(0,a.jsxs)("ul",{className:"ml-4 space-y-1",children:[(0,a.jsx)("li",{children:"• 가입 승인/거부"}),(0,a.jsx)("li",{children:"• 사용자 삭제"}),(0,a.jsx)("li",{children:"• 시스템 역할 변경"})]})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 p-4 rounded-lg",children:[(0,a.jsx)("h5",{className:"font-semibold mb-2",children:"\uD83C\uDFAF 권장 워크플로우"}),(0,a.jsxs)("ol",{className:"text-sm space-y-2",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"1단계:"})," 사용자 관리에서 가입 승인 및 시스템 역할 설정"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"2단계:"})," 기본 권한으로 충분하면 완료"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"3단계:"})," 추가 권한 필요 시 권한 관리에서 커스텀 역할 할당"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"4단계:"})," 필요시 개별 권한 세부 조정"]})]})]})]})}]})]})]})}function h(e){let{user:s,onClose:r,onSuccess:l}=e,[d,n]=(0,t.useState)({}),[i,c]=(0,t.useState)(!0),[x,o]=(0,t.useState)(!1);(0,t.useEffect)(()=>{m()},[s.id]);let m=async()=>{c(!0);try{let e=await fetch("/api/users/".concat(s.id,"/permissions")),r=await e.json();if(e.ok){let e={};r.permissions.forEach(s=>{e[s.permissionCode]=s.granted}),n(e)}}catch(e){}finally{c(!1)}},h=async()=>{o(!0);try{let e=Object.entries(d).map(e=>{let[s,r]=e;return{permissionCode:s,granted:r}}),r=await fetch("/api/users/".concat(s.id,"/permissions"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({permissions:e})});if(r.ok)alert("권한이 저장되었습니다."),l();else{let e=await r.json();alert(e.error||"권한 저장 실패")}}catch(e){alert("권한 저장 중 오류가 발생했습니다.")}finally{o(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold mb-4",children:["개별 권한 설정: ",s.name]}),i?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"로딩 중..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4 p-4 bg-blue-50 rounded",children:(0,a.jsx)("p",{className:"text-sm text-blue-800",children:"\uD83D\uDCA1 개별 권한은 역할 권한보다 우선 적용됩니다. 특정 권한만 추가하거나 제거할 때 사용하세요."})}),(0,a.jsx)("div",{className:"space-y-4 mb-6",children:[{name:"고객사 관리",permissions:[{code:"customer.view",name:"고객사 조회"},{code:"customer.create",name:"고객사 등록"},{code:"customer.update",name:"고객사 수정"},{code:"customer.delete",name:"고객사 삭제"}]},{name:"측정 데이터",permissions:[{code:"measurement.view",name:"측정 데이터 조회"},{code:"measurement.create",name:"측정 데이터 입력"},{code:"measurement.update",name:"측정 데이터 수정"},{code:"measurement.delete",name:"측정 데이터 삭제"}]},{name:"사용자 관리",permissions:[{code:"user.view",name:"사용자 조회"},{code:"user.create",name:"사용자 등록"},{code:"user.update",name:"사용자 수정"},{code:"user.delete",name:"사용자 삭제"}]}].map(e=>(0,a.jsxs)("div",{className:"border rounded p-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:e.name}),(0,a.jsx)("div",{className:"space-y-2",children:e.permissions.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[(0,a.jsx)("input",{type:"checkbox",checked:d[e.code]||!1,onChange:s=>{n({...d,[e.code]:s.target.checked})},className:"rounded"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e.name})]},e.code))})]},e.name))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:r,className:"flex-1 px-4 py-2 border rounded hover:bg-gray-50",disabled:x,children:"취소"}),(0,a.jsx)("button",{onClick:h,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",disabled:x,children:x?"저장 중...":"저장"})]})]})]})})}},4358:function(e,s,r){"use strict";r.d(s,{Z:function(){return n}});var a=r(7437),t=r(605),l=r(9376),d=r(2265);function n(){var e,s;let{data:r}=(0,t.useSession)();(0,l.useRouter)();let[n,i]=(0,d.useState)(!1),c=(null==r?void 0:null===(e=r.user)||void 0===e?void 0:e.name)||"",x=(null==r?void 0:null===(s=r.user)||void 0===s?void 0:s.email)||"";return(0,a.jsx)("header",{className:"h-16 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 sticky top-0 z-40",children:(0,a.jsxs)("div",{className:"mx-auto h-full px-6 flex items-center justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"시스템 관리자"})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>i(!n),className:"flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white font-semibold",children:c.charAt(0).toUpperCase()}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:c}),(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:c}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:x})]}),(0,a.jsx)("div",{className:"py-1",children:(0,a.jsx)("button",{onClick:()=>{sessionStorage.removeItem("viewAsOrganization"),sessionStorage.removeItem("viewAsCustomer"),(0,t.signOut)({callbackUrl:"/login"})},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700",children:"로그아웃"})})]})]})]})]})})}},8653:function(e,s,r){"use strict";r.d(s,{Z:function(){return l}});var a=r(7437),t=r(2265);function l(e){let{isOpen:s,onClose:r,title:l,sections:d}=e,[n,i]=(0,t.useState)(0);return s?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:r}),(0,a.jsxs)("div",{className:"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center text-2xl",children:"\uD83D\uDCDA"}),(0,a.jsx)("h3",{className:"text-xl font-bold text-white",children:l})]}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),d.length>1&&(0,a.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:(0,a.jsx)("nav",{className:"flex -mb-px overflow-x-auto",children:d.map((e,s)=>(0,a.jsx)("button",{onClick:()=>i(s),className:"px-6 py-3 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ".concat(n===s?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e.title},s))})}),(0,a.jsx)("div",{className:"px-6 py-6 max-h-[70vh] overflow-y-auto",children:(0,a.jsx)("div",{className:"prose dark:prose-invert max-w-none",children:"string"==typeof d[n].content?(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:d[n].content}}):d[n].content})}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 px-6 py-4 flex justify-between items-center",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"\uD83D\uDCA1 추가 도움이 필요하시면 시스템 관리자에게 문의하세요."}),(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"닫기"})]})]})]})}):null}},6334:function(e,s,r){"use strict";r.d(s,{Z:function(){return d}});var a=r(7437);r(2265);let t={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},l={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function d(e){let{variant:s="primary",size:r="md",className:d="",...n}=e;return(0,a.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat(t[s]," ").concat(l[r]," ").concat(d),...n})}},2827:function(e,s,r){"use strict";r.d(s,{Z:function(){return t}});var a=r(7437);function t(e){let{className:s="",...r}=e;return(0,a.jsx)("input",{className:"".concat("rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20"," ").concat(s),...r})}r(2265)}},function(e){e.O(0,[605,3448,2971,2117,1744],function(){return e(e.s=8881)}),_N_E=e.O()}]);