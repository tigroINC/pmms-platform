(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8355],{8065:function(e,t,a){Promise.resolve().then(a.bind(a,1490))},8930:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},1490:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var r=a(7437),s=a(2265),l=a(605),d=a(9376),i=a(6334),n=a(9205);let c=(0,n.Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var o=a(5685);let x=(0,n.Z)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var m=a(8930);let h=(0,n.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),g=(0,n.Z)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var y=a(5254);let u={PHONE:"\uD83D\uDCDE 전화",EMAIL:"\uD83D\uDCE7 이메일",VISIT:"\uD83D\uDC64 방문",KAKAO:"\uD83D\uDCAC 카톡",SMS:"\uD83D\uDCF1 SMS",FAX:"\uD83D\uDCE0 팩스",OTHER:"기타"},b={PENDING:{label:"답변대기",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"},IN_PROGRESS:{label:"대화중",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"},COMPLETED:{label:"완료",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"},REFERENCE:{label:"참고",color:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-300"}},j={URGENT:{label:"긴급",icon:"\uD83D\uDD34"},HIGH:{label:"높음",icon:"\uD83D\uDFE0"},NORMAL:{label:"보통",icon:"⚪"},LOW:{label:"낮음",icon:"\uD83D\uDD35"}},p=(e,t)=>"PENDING"!==e||t?b[e]:{label:"완료전",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"};function k(){let{data:e}=(0,l.useSession)(),t=(0,d.useRouter)(),a=(0,d.useParams)().id,[n,k]=(0,s.useState)(null),[N,v]=(0,s.useState)(!0),[w,f]=(0,s.useState)(""),[D,C]=(0,s.useState)(""),[S,E]=(0,s.useState)(!1),[O,T]=(0,s.useState)(!1),[M,Z]=(0,s.useState)(!1),[P,A]=(0,s.useState)({subject:"",content:""}),[R,L]=(0,s.useState)(!1),H=null==e?void 0:e.user,z=(null==H?void 0:H.role)==="CUSTOMER_ADMIN"||(null==H?void 0:H.role)==="CUSTOMER_USER",_=(null==n?void 0:n.createdBy.id)===(null==H?void 0:H.id),I=_&&(!(null==n?void 0:n.replies)||0===n.replies.length),F=(null==n?void 0:n.status)==="COMPLETED";(0,s.useEffect)(()=>{a&&G()},[a]);let G=async()=>{try{v(!0);let e=await fetch("/api/communications/".concat(a));if(!e.ok)return;let t=await e.json(),r=t.communication||t;r&&r.id&&(k(r),A({subject:r.subject||"",content:r.content||""}))}catch(e){}finally{v(!1)}},J=async e=>{if(confirm("상태를 ".concat(b[e].label,"(으)로 변경하시겠습니까?")))try{let t=await fetch("/api/communications/".concat(a,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})});if(t.ok)G();else{let e=await t.json();alert(e.error||"상태 변경 실패")}}catch(e){alert("상태 변경 중 오류가 발생했습니다")}},K=async()=>{if(!w.trim()){alert("답변 내용을 입력해주세요");return}try{E(!0);let e=await fetch("/api/communications/".concat(a,"/replies"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:w})});if(e.ok)f(""),G();else{let t=await e.json();alert(t.error||"답변 추가 실패")}}catch(e){alert("답변 추가 중 오류가 발생했습니다")}finally{E(!1)}},B=async()=>{if(!D.trim()){alert("메모 내용을 입력해주세요");return}try{T(!0);let e=await fetch("/api/communications/".concat(a,"/notes"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:D})});if(e.ok)C(""),G();else{let t=await e.json();alert(t.error||"메모 추가 실패")}}catch(e){alert("메모 추가 중 오류가 발생했습니다")}finally{T(!1)}},U=async e=>{try{let t=await fetch("/api/communications/".concat(a),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isShared:e})});if(t.ok)alert("공유 범위가 변경되었습니다"),G();else{let e=await t.json();alert(e.error||"변경 실패")}}catch(e){alert("변경 중 오류가 발생했습니다")}},V=async()=>{if(!P.content.trim()){alert("내용을 입력해주세요");return}try{let e=await fetch("/api/communications/".concat(a),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:P.subject,content:P.content})});if(e.ok)alert("수정되었습니다"),Z(!1),G();else{let t=await e.json();alert(t.error||"수정 실패")}}catch(e){alert("수정 중 오류가 발생했습니다")}},q=async()=>{if(confirm("정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{let e=await fetch("/api/communications/".concat(a),{method:"DELETE"});if(e.ok)alert("삭제되었습니다"),t.push("/communications");else{let t=await e.json();alert(t.error||"삭제 실패")}}catch(e){alert("삭제 중 오류가 발생했습니다")}};return N?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})}):n?(0,r.jsxs)("section",{className:"p-4 md:p-6 max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,r.jsxs)(i.Z,{variant:"secondary",onClick:()=>t.push("/communications"),children:[(0,r.jsx)(c,{className:"w-4 h-4 mr-2"}),"목록"]}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"커뮤니케이션 상세"}),(0,r.jsxs)("button",{onClick:()=>L(!0),className:"ml-auto px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors flex items-center gap-1",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4"}),"도움말"]})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"px-3 py-1 text-sm rounded ".concat(p(n.status,n.isShared).color),children:p(n.status,n.isShared).label}),(0,r.jsx)("span",{className:"text-2xl",children:j[n.priority].icon}),(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:j[n.priority].label})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:["COMPLETED"!==n.status&&(0,r.jsx)(i.Z,{size:"sm",onClick:()=>J("COMPLETED"),children:"완료 처리"}),I&&!M&&!F&&(0,r.jsxs)(i.Z,{size:"sm",variant:"secondary",onClick:()=>Z(!0),children:[(0,r.jsx)(x,{className:"w-4 h-4 mr-1"}),"수정"]}),M&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{size:"sm",onClick:V,children:"저장"}),(0,r.jsx)(i.Z,{size:"sm",variant:"secondary",onClick:()=>{Z(!1),A({subject:n.subject||"",content:n.content||""})},children:"취소"})]}),_&&(0,r.jsx)(i.Z,{size:"sm",variant:"secondary",onClick:q,children:(0,r.jsx)(m.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[!z&&(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"공유 범위"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",checked:!0===n.isShared,onChange:async()=>{n.isShared||await U(!0)},className:"mr-2"}),(0,r.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:"고객사 공유"})]}),(0,r.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",checked:!1===n.isShared,disabled:!0===n.isShared,className:"mr-2"}),(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"내부 전용"})]})]})]}),!1===n.isShared&&(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"* 내부 전용은 고객사 공유로만 변경 가능합니다"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:z?"환경측정기업":"고객사"}),(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:z?n.contactOrg||"-":n.customer.name})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"소통 일시"}),(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:new Date(n.contactAt).toLocaleString("ko-KR")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"채널"}),(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:u[n.channel]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"작성자"}),(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:n.createdBy.name})]}),n.assignedTo&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"담당자"}),(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:n.assignedTo.name})]})]}),M?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-500 dark:text-gray-400 mb-1",children:"제목"}),(0,r.jsx)("input",{type:"text",value:P.subject,onChange:e=>A({...P,subject:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"제목 (선택사항)"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm text-gray-500 dark:text-gray-400 mb-1",children:["내용 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{value:P.content,onChange:e=>A({...P,content:e.target.value}),rows:6,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"내용을 입력하세요",required:!0})]})]}):(0,r.jsxs)(r.Fragment,{children:[n.subject&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"제목"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n.subject})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"내용"}),(0,r.jsx)("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:n.content})]})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"\uD83D\uDCAC 대화 내역 (거래처 공유)"}),(0,r.jsx)("div",{className:"space-y-4 mb-4 max-h-[500px] overflow-y-auto",children:n.replies&&n.replies.length>0?n.replies.map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsx)("div",{children:(0,r.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:e.createdBy.name})}),(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.createdAt).toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),(0,r.jsx)("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:e.content})]},e.id)):(0,r.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"아직 답변이 없습니다"})}),!F&&n.isShared&&(0,r.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[(0,r.jsx)("textarea",{value:w,onChange:e=>f(e.target.value),placeholder:"답변을 입력하세요...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,r.jsx)("div",{className:"flex justify-end mt-2",children:(0,r.jsxs)(i.Z,{onClick:K,disabled:S,children:[(0,r.jsx)(h,{className:"w-4 h-4 mr-2"}),S?"전송 중...":"답변 전송"]})})]}),!F&&!n.isShared&&(0,r.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-700 rounded-lg p-4 text-center",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"내부 전용 커뮤니케이션은 거래처 공유 답변을 전송할 수 없습니다."}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"공유 범위를 '고객사 공유'로 변경하면 답변을 전송할 수 있습니다."})]})})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[(0,r.jsx)(g,{className:"w-5 h-5"}),"내부 메모 (비공개)"]}),(0,r.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded p-2 mb-4",children:(0,r.jsx)("p",{className:"text-xs text-yellow-800 dark:text-yellow-300",children:"우리 조직 내부에서만 공유되며, 거래처에는 노출되지 않습니다."})}),(0,r.jsx)("div",{className:"space-y-3 mb-4 max-h-[500px] overflow-y-auto",children:0===n.notes.length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"등록된 내부 메모가 없습니다"}):n.notes.map(e=>(0,r.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.createdBy.name}),(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.createdAt).toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),(0,r.jsx)("div",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:e.note})]},e.id))}),!F&&(0,r.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[(0,r.jsx)("textarea",{value:D,onChange:e=>C(e.target.value),placeholder:"내부 메모를 입력하세요...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,r.jsx)("div",{className:"flex justify-end mt-2",children:(0,r.jsxs)(i.Z,{onClick:B,disabled:O,children:[(0,r.jsx)(g,{className:"w-4 h-4 mr-2"}),O?"저장 중...":"메모 저장"]})})]})]})]}),(0,r.jsx)(y.Z,{isOpen:R,onClose:()=>L(!1)})]}):null}}},function(e){e.O(0,[605,115,2971,2117,1744],function(){return e(e.s=8065)}),_N_E=e.O()}]);