"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6475],{6475:function(e,t,r){r.d(t,{Z:function(){return g}});var s=r(7437),a=r(7648),l=r(9376),i=r(605),n=r(2265),o=r(2891),d=r(4766),c=r(2834),u=r(3782);function m(e){let{onClose:t}=e,r=(0,l.useRouter)(),{notifications:a,unreadCount:i,markAllAsRead:n}=(0,c.z)(),o=a.slice(0,5),d=async()=>{await n()};return(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-lg border border-gray-200 z-50",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"알림"}),i>0&&(0,s.jsx)("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-700",children:"모두 읽음"})]}),(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===o.length?(0,s.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,s.jsx)("p",{children:"알림이 없습니다"})}):o.map(e=>(0,s.jsx)(u.Z,{notification:e,onClose:t},e.id))}),a.length>0&&(0,s.jsx)("div",{className:"p-3 border-t border-gray-200 text-center",children:(0,s.jsx)("button",{onClick:()=>{r.push("/notifications"),t()},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"모든 알림 보기"})})]})}function h(){let[e,t]=(0,n.useState)(!1),r=(0,n.useRef)(null),{unreadCount:a}=(0,c.z)();return(0,n.useEffect)(()=>{let s=e=>{r.current&&!r.current.contains(e.target)&&t(!1)};return e&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[e]),(0,s.jsxs)("div",{className:"relative",ref:r,children:[(0,s.jsxs)("button",{onClick:()=>t(!e),className:"relative p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"알림",children:[(0,s.jsx)(d.Z,{className:"w-5 h-5 text-gray-700"}),a>0&&(0,s.jsx)("span",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:a>9?"9+":a})]}),e&&(0,s.jsx)(m,{onClose:()=>t(!1)})]})}let x=[{href:"/dashboard",label:"대시보드",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR","CUSTOMER_ADMIN","CUSTOMER_USER"]},{href:"/measure/input",label:"측정 입력",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR"]},{href:"/measure/history",label:"측정 이력",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR","CUSTOMER_ADMIN","CUSTOMER_USER"]},{href:"/reports",label:"보고서",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR"]},{href:"/masters/customers",label:"고객사 관리",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR"],readOnly:["OPERATOR"]},{href:"/communications",label:"고객 소통",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR"]},{href:"/masters/stacks",label:"굴뚝 관리",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR"],readOnly:["OPERATOR"]},{href:"/masters/items",label:"측정항목",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR"],readOnly:["OPERATOR"]},{href:"/masters/limits",label:"배출허용기준",roles:["SUPER_ADMIN","ORG_ADMIN","OPERATOR"],readOnly:["OPERATOR"]},{href:"/customer/reports",label:"받은 보고서",roles:["SUPER_ADMIN","CUSTOMER_ADMIN","CUSTOMER_USER"]},{href:"/customer/stacks",label:"굴뚝 관리",roles:["SUPER_ADMIN","CUSTOMER_ADMIN"]},{href:"/customer/organizations",label:"환경측정기업 관리",roles:["SUPER_ADMIN","CUSTOMER_ADMIN","CUSTOMER_USER"]},{href:"/communications",label:"소통 내역",roles:["CUSTOMER_ADMIN","CUSTOMER_USER"]},{href:"/customer/staff",label:"직원 관리",roles:["SUPER_ADMIN","CUSTOMER_ADMIN"]},{href:"/org/staff",label:"직원 관리",roles:["SUPER_ADMIN","ORG_ADMIN"]},{href:"/admin/system",label:"시스템 관리",roles:["SUPER_ADMIN"],children:[{href:"/admin/organizations",label:"환경측정기업 관리",roles:["SUPER_ADMIN"]},{href:"/admin/users",label:"사용자 관리",roles:["SUPER_ADMIN"]},{href:"/org/settings/roles",label:"역할 관리",roles:["SUPER_ADMIN"]},{href:"/org/settings/users",label:"권한 관리",roles:["SUPER_ADMIN"]}]}];function g(){var e,t,r,d,c;let u=(0,l.usePathname)(),{data:m,status:g}=(0,i.useSession)(),[f,b]=(0,n.useState)(!1),[v,N]=(0,n.useState)(!1),[y,p]=(0,n.useState)(!1),[j,w]=(0,n.useState)(!1),{selectedOrg:R,setSelectedOrg:k,organizations:E,isSuperAdmin:S}=(0,o.o)(),A=(null==m?void 0:null===(e=m.user)||void 0===e?void 0:e.role)||"",O=(null==m?void 0:null===(t=m.user)||void 0===t?void 0:t.name)||"",_=(null==m?void 0:null===(r=m.user)||void 0===r?void 0:r.email)||"";null==m||null===(d=m.user)||void 0===d||d.customerId;let[I,C]=(0,n.useState)(""),M=sessionStorage.getItem("viewAsOrganization"),D=sessionStorage.getItem("viewAsCustomer"),U=S&&!!M,T=S&&!!D;(0,n.useEffect)(()=>{T&&D&&fetch("/api/customers/".concat(D)).then(e=>e.json()).then(e=>{e.customer&&C(e.customer.name)}).catch(e=>console.error("Failed to load customer name:",e))},[T,D]);let P=A;U?P="ORG_ADMIN":T&&(P="CUSTOMER_ADMIN");let z=x.filter(e=>e.roles.includes(P));return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("header",{className:"h-16 border-b border-gray-800 bg-gray-900 text-white sticky top-0 z-40",children:[(0,s.jsxs)("div",{className:"mx-auto h-full px-4 flex items-center gap-6",children:[(0,s.jsxs)("button",{className:"md:hidden inline-flex flex-col items-center justify-center w-9 h-9 rounded border border-gray-700 hover:bg-white/10 gap-1","aria-label":"메뉴 열기",onClick:()=>b(!0),children:[(0,s.jsx)("span",{className:"block w-5 h-0.5 bg-white"}),(0,s.jsx)("span",{className:"block w-5 h-0.5 bg-white"}),(0,s.jsx)("span",{className:"block w-5 h-0.5 bg-white"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-6",children:["CUSTOMER_ADMIN"===A||"CUSTOMER_USER"===A||T?(0,s.jsx)(a.default,{href:"/",className:"font-semibold text-lg whitespace-nowrap text-white",children:T?I:(null==m?void 0:null===(c=m.user)||void 0===c?void 0:c.customerName)||"고객사"}):S?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(U||T)&&(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 bg-purple-600 rounded-md",children:[(0,s.jsxs)("span",{className:"text-sm font-medium",children:["\uD83D\uDD0D 시스템 보기 ",T&&"(고객사)"]}),(0,s.jsx)("button",{onClick:()=>{sessionStorage.removeItem("viewAsOrganization"),sessionStorage.removeItem("viewAsCustomer"),window.location.href=T?"/admin/customers":"/admin/organizations"},className:"text-xs px-2 py-0.5 bg-white/20 hover:bg-white/30 rounded",title:"시스템 관리자 모드로 돌아가기",children:"✕"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>p(!y),className:"font-semibold text-lg whitespace-nowrap flex items-center gap-2 px-3 py-1 rounded-md border border-gray-700 hover:bg-white/10",children:[(null==R?void 0:R.name)||"조직 선택",(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>p(!1)}),(0,s.jsx)("div",{className:"absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-20 max-h-96 overflow-y-auto",children:(0,s.jsx)("div",{className:"py-1",children:0===E.length?(0,s.jsx)("div",{className:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400",children:"승인된 조직이 없습니다"}):E.map(e=>(0,s.jsxs)("button",{onClick:()=>{k(e),p(!1)},className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 ".concat((null==R?void 0:R.id)===e.id?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 font-medium":"text-gray-700 dark:text-gray-300"),children:[(0,s.jsx)("div",{children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.businessNumber})]},e.id))})})]})]})]}):(0,s.jsx)(a.default,{href:"/",className:"font-semibold text-lg whitespace-nowrap",children:(null==R?void 0:R.name)||"보아스환경기술"}),(0,s.jsx)("nav",{className:"hidden md:flex items-center gap-1",children:z.map(e=>{let t=null==u?void 0:u.startsWith(e.href);if(e.children&&e.children.length>0){let t=e.children.some(e=>null==u?void 0:u.startsWith(e.href));return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>w(!j),className:"text-sm px-3 py-1 rounded hover:bg-white/10 flex items-center gap-1 ".concat(t?"font-medium bg-white/10":"text-gray-200"),children:[e.label,(0,s.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),j&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>w(!1)}),(0,s.jsx)("div",{className:"absolute left-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:(0,s.jsx)("div",{className:"py-1",children:e.children.map(e=>(0,s.jsx)(a.default,{href:e.href,onClick:()=>w(!1),className:"block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 ".concat((null==u?void 0:u.startsWith(e.href))?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 font-medium":"text-gray-700 dark:text-gray-300"),children:e.label},e.href))})})]})]},e.href)}return(0,s.jsx)(a.default,{href:e.href,className:"text-sm px-3 py-1 rounded hover:bg-white/10 relative ".concat(t?"font-medium bg-white/10":"text-gray-200"),children:e.label},e.href)})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 ml-auto",children:[(0,s.jsx)(h,{}),"authenticated"===g?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>N(!v),className:"flex items-center gap-2 px-3 py-1 rounded-md border border-gray-700 text-sm text-white hover:bg-white/10",children:[(0,s.jsx)("span",{className:"hidden md:inline",children:O}),(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>N(!1)}),(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:O}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:_})]}),(0,s.jsxs)("div",{className:"py-1",children:["SUPER_ADMIN"===A&&(0,s.jsx)(a.default,{href:"/admin/dashboard",onClick:()=>{N(!1),sessionStorage.removeItem("viewAsOrganization"),sessionStorage.removeItem("viewAsCustomer")},className:"block px-4 py-2 text-sm text-purple-600 dark:text-purple-400 hover:bg-gray-100 dark:hover:bg-gray-700 font-medium",children:"관리자 대시보드"}),(0,s.jsx)(a.default,{href:"/profile",onClick:()=>N(!1),className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"내 정보"}),("CUSTOMER_ADMIN"===A||"CUSTOMER_USER"===A||T)&&(0,s.jsx)(a.default,{href:"/customer/organization",onClick:()=>N(!1),className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"조직 정보"}),("ORG_ADMIN"===A||"SUPER_ADMIN"===A)&&!T&&(0,s.jsx)(a.default,{href:"/org/settings/organization",onClick:()=>N(!1),className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"조직 정보"}),(0,s.jsx)("button",{onClick:async()=>{N(!1),localStorage.removeItem("selectedOrgId"),sessionStorage.removeItem("viewAsOrganization"),sessionStorage.removeItem("viewAsCustomer"),await (0,i.signOut)({callbackUrl:"/login",redirect:!0})},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700",children:"로그아웃"})]})]})]})]})}):(0,s.jsx)(a.default,{href:"/login",className:"rounded-md px-3 py-1 border border-gray-700 text-sm text-white hover:bg-white/10",children:"로그인"})]})]}),f&&(0,s.jsxs)("div",{className:"md:hidden fixed inset-0 z-50",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>b(!1)}),(0,s.jsxs)("div",{className:"absolute inset-y-0 left-0 w-72 max-w-[80%] bg-gray-900 border-r border-gray-800 p-4 flex flex-col gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-semibold",children:"메뉴"}),(0,s.jsx)("button",{className:"inline-flex items-center justify-center w-9 h-9 rounded border border-gray-700 hover:bg-white/10","aria-label":"메뉴 닫기",onClick:()=>b(!1),children:"✕"})]}),(0,s.jsx)("nav",{className:"flex flex-col gap-1",children:z.map(e=>{let t=null==u?void 0:u.startsWith(e.href);return(0,s.jsx)(a.default,{href:e.href,onClick:()=>b(!1),className:"text-sm px-3 py-2 rounded hover:bg-white/10 relative ".concat(t?"font-medium bg-white/10":"text-gray-200"),children:e.label},e.href)})}),"authenticated"===g&&(0,s.jsxs)("div",{className:"border-t border-gray-700 pt-4 mt-4",children:[(0,s.jsxs)("div",{className:"px-3 py-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-white",children:O}),(0,s.jsx)("p",{className:"text-xs text-gray-400 truncate",children:_})]}),(0,s.jsx)(a.default,{href:"/profile",onClick:()=>b(!1),className:"block px-3 py-2 text-sm text-gray-200 hover:bg-white/10 rounded",children:"내 정보"}),("ORG_ADMIN"===A||"SUPER_ADMIN"===A)&&(0,s.jsx)(a.default,{href:"/org/settings/organization",onClick:()=>b(!1),className:"block px-3 py-2 text-sm text-gray-200 hover:bg-white/10 rounded",children:"조직 정보"}),(0,s.jsx)("button",{onClick:async()=>{b(!1),await (0,i.signOut)({callbackUrl:"/login",redirect:!0})},className:"w-full text-left px-3 py-2 text-sm text-red-400 hover:bg-white/10 rounded",children:"로그아웃"})]})]})]})]})})}},3782:function(e,t,r){r.d(t,{Z:function(){return u}});var s=r(7437),a=r(9376),l=r(4747),i=r(6410),n=r(4766),o=r(1671),d=r(6865),c=r(2834);function u(e){let{notification:t,onClose:r}=e,u=(0,a.useRouter)(),{markAsRead:m}=(0,c.z)(),h=()=>{switch(t.type){case"STACK_CREATED_BY_CUSTOMER":case"STACK_UPDATED_BY_CUSTOMER":case"STACK_INTERNAL_CODE_NEEDED":return"/masters/stacks?stackId=".concat(t.stackId);case"STACK_CREATED_BY_ORG":return"/customer/stacks?tab=unverified&stackId=".concat(t.stackId);case"STACK_VERIFIED_BY_CUSTOMER":return"/masters/stacks/".concat(t.stackId);default:return null}},x=async()=>{t.isRead||await m(t.id);let e=h();e&&(u.push(e),null==r||r())};return(0,s.jsx)("div",{onClick:x,className:"p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors ".concat(t.isRead?"":"bg-blue-50"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-1",children:(()=>{switch(t.type){case"STACK_CREATED_BY_CUSTOMER":case"STACK_UPDATED_BY_CUSTOMER":case"STACK_CREATED_BY_ORG":return(0,s.jsx)(n.Z,{className:"w-5 h-5 text-blue-500"});case"STACK_VERIFIED_BY_CUSTOMER":return(0,s.jsx)(o.Z,{className:"w-5 h-5 text-green-500"});case"STACK_INTERNAL_CODE_NEEDED":return(0,s.jsx)(d.Z,{className:"w-5 h-5 text-orange-500"});default:return(0,s.jsx)(n.Z,{className:"w-5 h-5 text-gray-500"})}})()}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-sm text-gray-900 mb-1",children:t.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:t.message}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:(()=>{try{return(0,l.Q)(new Date(t.createdAt),{addSuffix:!0,locale:i.ko})}catch(e){return"방금 전"}})()})]}),!t.isRead&&(0,s.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-2"})]})})}},2397:function(e,t,r){r.d(t,{H:function(){return d},a:function(){return c}});var s=r(7437),a=r(2265),l=r(605),i=r(9376);function n(){return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900",children:[(0,s.jsxs)("div",{className:"mb-16",children:[(0,s.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-white text-center",children:"오염물질 측정 관리 시스템"}),(0,s.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:"Pollutant Measurement Management System"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-gray-200 dark:border-gray-700 border-t-blue-600 rounded-full animate-spin"})}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm font-medium",children:"로딩 중..."})]}),(0,s.jsx)("div",{className:"mt-16"})]})}let o=(0,a.createContext)(null);function d(e){let{children:t}=e,{data:r,status:d}=(0,l.useSession)(),[c,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(!0),x=(0,i.usePathname)();(0,a.useEffect)(()=>{"loading"!==d&&h(!1),(null==r?void 0:r.user)?u(r.user):"unauthenticated"===d&&u(null)},[r,d]);let g="loading"===d||m;return!g||"/login"===x||(null==x?void 0:x.startsWith("/register"))||(null==x?void 0:x.startsWith("/invite"))||(null==x?void 0:x.startsWith("/auth"))?(0,s.jsx)(o.Provider,{value:{user:c,loading:g},children:t}):(0,s.jsx)(n,{})}function c(){let e=(0,a.useContext)(o);if(!e)throw Error("AuthProvider is missing");return e}},2891:function(e,t,r){r.d(t,{OrganizationProvider:function(){return n},o:function(){return o}});var s=r(7437),a=r(2265),l=r(605);let i=(0,a.createContext)(void 0);function n(e){var t,r,n;let{children:o}=e,{data:d,status:c}=(0,l.useSession)(),[u,m]=(0,a.useState)(null),[h,x]=(0,a.useState)([]),[g,f]=(0,a.useState)(!0),b=(null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.role)==="SUPER_ADMIN",v=null==d?void 0:null===(r=d.user)||void 0===r?void 0:r.role,N=null==d?void 0:null===(n=d.user)||void 0===n?void 0:n.organizationId,y="CUSTOMER_ADMIN"===v||"CUSTOMER_USER"===v;(0,a.useEffect)(()=>{if("loading"!==c){if(!d||y){f(!1);return}b&&sessionStorage.getItem("viewAsOrganization"),b?p():N?j(N):f(!1)}},[d,c,b,N,y]),(0,a.useEffect)(()=>{if(!b)return;let e=sessionStorage.getItem("viewAsOrganization");e&&(null==u?void 0:u.id)!==e&&p();let t=setInterval(()=>{let e=sessionStorage.getItem("viewAsOrganization");if(e&&(null==u?void 0:u.id)!==e)p();else if(!e&&u){let e=localStorage.getItem("selectedOrgId");e&&u.id!==e&&p()}},500);return()=>clearInterval(t)},[b,u]);let p=async()=>{try{let e=await fetch("/api/organizations?status=APPROVED"),t=await e.json();if(e.ok){let e=t.organizations||[];x(e);let r=sessionStorage.getItem("viewAsOrganization");if(r){let t=e.find(e=>e.id===r);if(t){m(t);return}}let s=localStorage.getItem("selectedOrgId");if(s){let t=e.find(e=>e.id===s);t?m(t):e.length>0&&m(e[0])}else e.length>0&&m(e[0])}}catch(e){}finally{f(!1)}},j=async e=>{try{let t=await fetch("/api/organizations/".concat(e)),r=await t.json();if(t.ok){let e=r.organization;x([e]),m(e)}}catch(e){}finally{f(!1)}};return(0,s.jsx)(i.Provider,{value:{selectedOrg:u,setSelectedOrg:e=>{m(e),e?localStorage.setItem("selectedOrgId",e.id):localStorage.removeItem("selectedOrgId")},organizations:h,loading:g,isSuperAdmin:b},children:o})}function o(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useOrganization must be used within OrganizationProvider");return e}},2834:function(e,t,r){r.d(t,{z:function(){return l}});var s=r(2265),a=r(2397);function l(){let{user:e}=(0,a.a)(),[t,r]=(0,s.useState)([]),[l,i]=(0,s.useState)(0),[n,o]=(0,s.useState)(!1),d=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;if(e)try{o(!0);let e=await fetch("/api/notifications?limit=".concat(t)),s=await e.json();e.ok&&(r(s.notifications||[]),i(s.unreadCount||0))}catch(e){}finally{o(!1)}},c=async()=>{if(e)try{let e=await fetch("/api/notifications/unread-count"),t=await e.json();e.ok&&i(t.count||0)}catch(e){}},u=async e=>{try{(await fetch("/api/notifications/".concat(e,"/read"),{method:"PATCH"})).ok&&(r(t=>t.map(t=>t.id===e?{...t,isRead:!0,readAt:new Date().toISOString()}:t)),i(e=>Math.max(0,e-1)))}catch(e){}},m=async()=>{try{(await fetch("/api/notifications/mark-all-read",{method:"PATCH"})).ok&&(r(e=>e.map(e=>({...e,isRead:!0,readAt:new Date().toISOString()}))),i(0))}catch(e){}},h=async e=>{try{if((await fetch("/api/notifications/".concat(e),{method:"DELETE"})).ok){let s=t.find(t=>t.id===e);r(t=>t.filter(t=>t.id!==e)),s&&!s.isRead&&i(e=>Math.max(0,e-1))}}catch(e){}};return(0,s.useEffect)(()=>{e&&d()},[e]),(0,s.useEffect)(()=>{if(!e)return;let t=setInterval(()=>{c()},12e4);return()=>clearInterval(t)},[e]),{notifications:t,unreadCount:l,loading:n,fetchNotifications:d,fetchUnreadCount:c,markAsRead:u,markAllAsRead:m,deleteNotification:h}}}}]);