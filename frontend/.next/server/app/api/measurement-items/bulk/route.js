"use strict";(()=>{var e={};e.id=3137,e.ids=[3137],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},55377:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>x,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>m});var i=t(49303),a=t(88716),n=t(60670),o=t(87070),u=t(75571),l=t(95456),d=t(20728),p=t(63185);async function m(e){try{let r=await (0,u.getServerSession)(l.L);if(!r?.user)return o.NextResponse.json({error:"Unauthorized"},{status:401});let t=r.user.role;if("SUPER_ADMIN"!==t&&"ORG_ADMIN"!==t)return o.NextResponse.json({error:"권한이 없습니다."},{status:403});let{csvText:s}=await e.json();if(!s)return o.NextResponse.json({error:"CSV 데이터가 필요합니다."},{status:400});let i=(0,p.b)(s);if(i.length<2)return o.NextResponse.json({error:"데이터가 없습니다."},{status:400});let a=i[0].map(e=>e.replace(/^"|"/g,"")),n=a.indexOf("항목코드"),m=a.indexOf("항목명(한글)"),c=a.indexOf("항목명(영문)"),x=a.indexOf("기본단위"),g=a.indexOf("구분"),f=a.indexOf("항목분류"),h=a.indexOf("허용기준값")>=0?a.indexOf("허용기준값"):a.indexOf("허용기준값(기본)"),w=a.indexOf("측정분석방법");if(-1===n||-1===m||-1===x||-1===h)return o.NextResponse.json({error:"필수 컬럼 '항목코드', '항목명(한글)', '기본단위', '허용기준값'이 필요합니다."},{status:400});let q=0,R=[];for(let e=1;e<i.length;e++){let r=i[e].map(e=>e.replace(/^"|"$/g,"")),t=r[n]?.trim(),s=r[m]?.trim(),a=c>=0?r[c]?.trim():null,o=r[x]?.trim(),u=g>=0?r[g]?.trim():null,l=f>=0?r[f]?.trim():null,p=w>=0?r[w]?.trim():null,v=r[h]?parseFloat(r[h]):0;if(!t||!s||!o||void 0===v){R.push(`${e+1}행: 항목코드, 항목명(한글), 기본단위, 허용기준값이 필요합니다.`);continue}try{await d._.item.upsert({where:{key:t},create:{key:t,name:s,englishName:a,unit:o,limit:v,category:u,classification:l,analysisMethod:p,hasLimit:!0,isActive:!0,order:0},update:{name:s,englishName:a,unit:o,limit:v,category:u,classification:l,analysisMethod:p}}),q++}catch(r){R.push(`${e+1}행: ${r.message}`)}}return o.NextResponse.json({success:!0,count:q,errors:R.length>0?R:void 0,message:`${q}건 등록 완료${R.length>0?`, ${R.length}건 실패`:""}`})}catch(e){return o.NextResponse.json({error:e.message||"업로드 실패"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/measurement-items/bulk/route",pathname:"/api/measurement-items/bulk",filename:"route",bundlePath:"app/api/measurement-items/bulk/route"},resolvedPagePath:"C:\\Users\\User\\boaz\\frontend\\src\\app\\api\\measurement-items\\bulk\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:f}=c,h="/api/measurement-items/bulk/route";function w(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},95456:(e,r,t)=>{t.d(r,{L:()=>o});var s=t(53797),i=t(13539),a=t(20728),n=t(98691);let o={adapter:(0,i.N)(a._),providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"이메일",type:"email"},password:{label:"비밀번호",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("이메일과 비밀번호를 입력해주세요.");let r=await a._.user.findUnique({where:{email:e.email},include:{organization:!0,customer:!0}});if(!r)throw Error("등록되지 않은 이메일입니다.");if("APPROVED"!==r.status)throw Error("승인 대기 중이거나 거부된 계정입니다.");if(!r.isActive)throw Error("비활성화된 계정입니다.");if(!await n.ZP.compare(e.password,r.password))throw Error("비밀번호가 일치하지 않습니다.");return await a._.user.update({where:{id:r.id},data:{lastLoginAt:new Date,loginCount:{increment:1}}}),await a._.activityLog.create({data:{userId:r.id,action:"LOGIN",ipAddress:null,userAgent:null}}),{id:r.id,email:r.email,name:r.name,role:r.role,organizationId:r.organizationId,customerId:r.customerId,customerName:r.customer?.name||null,status:r.status,passwordResetRequired:r.passwordResetRequired}}})],callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role,e.organizationId=r.organizationId,e.customerId=r.customerId,e.customerName=r.customerName,e.status=r.status,e.passwordResetRequired=r.passwordResetRequired),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role,e.user.organizationId=r.organizationId,e.user.customerId=r.customerId,e.user.customerName=r.customerName,e.user.status=r.status,e.user.passwordResetRequired=r.passwordResetRequired),e)},pages:{signIn:"/login",error:"/login"},session:{strategy:"jwt",maxAge:86400},secret:process.env.NEXTAUTH_SECRET}},63185:(e,r,t)=>{t.d(r,{b:()=>s});function s(e){return e.split(/\r?\n/).filter(e=>e.trim().length>0).map(e=>(function(e){let r=[],t="",s=!1;for(let i=0;i<e.length;i++){let a=e[i],n=e[i+1];'"'===a?s&&'"'===n?(t+='"',i++):s=!s:","!==a||s?t+=a:(r.push(t.trim()),t="")}return r.push(t.trim()),r})(e))}},20728:(e,r,t)=>{t.d(r,{_:()=>i});let s=require("@prisma/client"),i=global.prisma||new s.PrismaClient({log:["warn","error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,8691,9637],()=>t(55377));module.exports=s})();