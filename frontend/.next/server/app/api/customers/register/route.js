"use strict";(()=>{var e={};e.id=893,e.ids=[893],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},54738:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>N,staticGenerationAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{POST:()=>p});var a=t(49303),i=t(88716),n=t(60670),o=t(87070),u=t(20728),m=t(98691);async function p(e){try{let r=await e.json(),t=(r?.name||"").trim(),s=(r?.businessNumber||"").trim();if(!t)return o.NextResponse.json({error:"고객사명은 필수입니다"},{status:400});if(!s)return o.NextResponse.json({error:"사업자등록번호는 필수입니다"},{status:400});if(await u._.customer.findFirst({where:{name:t}}))return o.NextResponse.json({error:"이미 존재하는 고객사명입니다"},{status:400});if(await u._.customer.findUnique({where:{businessNumber:s}}))return o.NextResponse.json({error:"이미 등록된 사업자등록번호입니다"},{status:400});if(!r.adminEmail||!r.adminPassword||!r.adminName||!r.adminPhone)return o.NextResponse.json({error:"고객사 관리자 정보는 필수입니다"},{status:400});if(await u._.user.findUnique({where:{email:r.adminEmail}}))return o.NextResponse.json({error:"이미 사용 중인 이메일입니다"},{status:400});let a=await u._.$transaction(async e=>{let a={name:t,businessNumber:s,isActive:!1,isPublic:!0};r.code&&(a.code=r.code.trim()),r.corporateNumber&&(a.corporateNumber=r.corporateNumber.trim()),r.fullName&&(a.fullName=r.fullName.trim()),r.representative&&(a.representative=r.representative.trim()),r.siteType&&(a.siteType=r.siteType.trim()),r.address&&(a.address=r.address.trim()),r.businessType&&(a.businessType=r.businessType.trim()),r.industry&&(a.industry=r.industry.trim()),r.siteCategory&&(a.siteCategory=r.siteCategory.trim());let i=await e.customer.create({data:a}),n=await m.ZP.hash(r.adminPassword,10),o=await e.user.create({data:{email:r.adminEmail,password:n,name:r.adminName,phone:r.adminPhone,role:"CUSTOMER_ADMIN",customerId:i.id,companyName:t,department:r.adminDepartment,position:r.adminPosition,status:"PENDING",isActive:!1,emailVerified:!1}});return{customer:i,admin:o}});return o.NextResponse.json({ok:!0,data:a.customer,message:"고객사 등록 신청이 완료되었습니다. 관리자 승인을 기다려주세요."},{status:201})}catch(e){return o.NextResponse.json({error:"고객사 등록 중 오류가 발생했습니다."},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/customers/register/route",pathname:"/api/customers/register",filename:"route",bundlePath:"app/api/customers/register/route"},resolvedPagePath:"C:\\Users\\User\\boaz\\frontend\\src\\app\\api\\customers\\register\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:N}=d,f="/api/customers/register/route";function y(){return(0,n.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:l})}},20728:(e,r,t)=>{t.d(r,{_:()=>a});let s=require("@prisma/client"),a=global.prisma||new s.PrismaClient({log:["warn","error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,8691],()=>t(54738));module.exports=s})();