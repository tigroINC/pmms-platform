"use strict";(()=>{var e={};e.id=8145,e.ids=[8145],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},26029:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var a={};r.r(a),r.d(a,{POST:()=>d});var i=r(49303),n=r(88716),s=r(60670),o=r(87070),u=r(20728),p=r(98691);async function d(e){try{let{name:t,businessNumber:r,corporateNumber:a,businessType:i,address:n,phone:s,email:d,representative:l,website:g,fax:c,establishedDate:m,adminEmail:f,adminPassword:w,adminName:h,adminPhone:x,adminDepartment:N,adminPosition:R,registrationReason:v,notes:z}=await e.json(),q=await u._.systemSettings.findUnique({where:{key:"org_registration_required_fields"}}),y=["name","businessNumber"];q&&(y=JSON.parse(q.value).required||y);let P={name:t,businessNumber:r,corporateNumber:a,businessType:i,address:n,phone:s,email:d,representative:l,website:g,fax:c,establishedDate:m?new Date(m):null};for(let e of y)if(!P[e])return o.NextResponse.json({error:`${e}은(는) 필수 입력 항목입니다.`},{status:400});if(!f||!w||!h||!x)return o.NextResponse.json({error:"관리자 정보(이메일, 비밀번호, 이름, 전화번호)는 필수입니다."},{status:400});if(await u._.user.findUnique({where:{email:f}}))return o.NextResponse.json({error:"이미 사용 중인 이메일입니다."},{status:400});if(r&&await u._.organization.findUnique({where:{businessNumber:r}}))return o.NextResponse.json({error:"이미 등록된 사업자등록번호입니다."},{status:400});let _=await p.ZP.hash(w,10),j=await u._.$transaction(async e=>{let a=await e.organization.create({data:{...P,subscriptionPlan:"FREE",subscriptionStatus:"TRIAL",isActive:!1}}),i=await e.user.create({data:{email:f,password:_,name:h,phone:x,role:"ORG_ADMIN",organizationId:a.id,companyName:t,department:N,position:R,status:"PENDING",isActive:!1,emailVerified:!1}});return await e.activityLog.create({data:{userId:i.id,action:"REGISTER_ORGANIZATION",target:"Organization",targetId:a.id,details:JSON.stringify({organizationName:t,businessNumber:r,registrationReason:v,notes:z})}}),{organization:a,admin:i}});return o.NextResponse.json({message:"회원가입 신청이 완료되었습니다. 시스템 관리자의 승인을 기다려주세요.",organizationId:j.organization.id,adminEmail:j.admin.email})}catch(e){return o.NextResponse.json({error:"회원가입 처리 중 오류가 발생했습니다."},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/organizations/register/route",pathname:"/api/organizations/register",filename:"route",bundlePath:"app/api/organizations/register/route"},resolvedPagePath:"C:\\Users\\User\\boaz\\frontend\\src\\app\\api\\organizations\\register\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:c,serverHooks:m}=l,f="/api/organizations/register/route";function w(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},20728:(e,t,r)=>{r.d(t,{_:()=>i});let a=require("@prisma/client"),i=global.prisma||new a.PrismaClient({log:["warn","error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,8691],()=>r(26029));module.exports=a})();