(()=>{var e={};e.id=8252,e.ids=[8252],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},40560:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c}),s(62250),s(92553),s(35866);var a=s(23191),r=s(88716),n=s(37922),i=s.n(n),l=s(95231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let c=["",{children:["customer",{children:["organizations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,62250)),"C:\\Users\\User\\boaz\\frontend\\src\\app\\customer\\organizations\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,92553)),"C:\\Users\\User\\boaz\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["C:\\Users\\User\\boaz\\frontend\\src\\app\\customer\\organizations\\page.tsx"],x="/customer/organizations/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/customer/organizations/page",pathname:"/customer/organizations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},66169:(e,t,s)=>{Promise.resolve().then(s.bind(s,42996))},42996:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(10326),r=s(17577),n=s(77109),i=s(35047);function l({isOpen:e,onClose:t,onSuccess:s}){let{data:i}=(0,n.useSession)(),[l,d]=(0,r.useState)(""),[c,o]=(0,r.useState)([]),[x,m]=(0,r.useState)(null),[u,p]=(0,r.useState)(""),[h,g]=(0,r.useState)(""),[y,b]=(0,r.useState)(!1),[j,N]=(0,r.useState)(!1),f=async()=>{if(!x){alert("환경측정기업을 선택해주세요.");return}try{b(!0);let e=i?.user?.customerId,t=await fetch("/api/connection-requests/customer-to-org",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e,organizationId:x.id,contractStartDate:u||null,contractEndDate:h||null})}),a=await t.json();t.ok?(alert("연결 요청이 전송되었습니다."),s(),v()):alert(a.error||"요청 전송 실패")}catch(e){alert("요청 전송 중 오류가 발생했습니다.")}finally{b(!1)}},v=()=>{d(""),o([]),m(null),p(""),g(""),t()};return e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-[600px] max-h-[80vh] overflow-y-auto",children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"환경측정기업 연결 요청"}),x?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"mb-4 p-4 bg-gray-50 rounded",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-medium text-lg",children:x.name}),a.jsx("div",{className:"text-sm text-gray-500 mt-1",children:x.businessNumber}),a.jsx("div",{className:"text-sm text-gray-500",children:x.phone}),a.jsx("div",{className:"text-xs text-gray-400 mt-1",children:x.address})]}),a.jsx("button",{onClick:()=>m(null),className:"text-gray-400 hover:text-gray-600",children:"✕"})]})}),(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"계약 기간 (선택사항)"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"시작일"}),a.jsx("input",{type:"date",value:u,onChange:e=>p(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"종료일"}),a.jsx("input",{type:"date",value:h,onChange:e=>g(e.target.value),className:"w-full border rounded px-3 py-2"})]})]})]}),a.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded text-sm text-blue-800",children:"\uD83D\uDCA1 연결 요청을 전송하면 환경측정기업 관리자가 승인할 수 있습니다."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"환경측정기업 검색"}),a.jsx("input",{type:"text",placeholder:"기업명 또는 사업자등록번호 입력",value:l,onChange:e=>d(e.target.value),className:"w-full border rounded px-3 py-2"}),j&&a.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"검색 중..."})]}),c.length>0&&a.jsx("div",{className:"mb-4 border rounded max-h-60 overflow-y-auto",children:c.map(e=>(0,a.jsxs)("div",{onClick:()=>m(e),className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",children:[a.jsx("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.businessNumber," | ",e.phone]}),a.jsx("div",{className:"text-xs text-gray-400",children:e.address})]},e.id))}),l.length>=2&&!j&&0===c.length&&a.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"검색 결과가 없습니다."})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:v,className:"flex-1 bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",disabled:y,children:"취소"}),x&&a.jsx("button",{onClick:f,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400",disabled:y,children:y?"전송 중...":"연결 요청"})]})]})}):null}function d(){let{data:e,status:t}=(0,n.useSession)(),s=(0,i.useRouter)(),[d,c]=(0,r.useState)([]),[o,x]=(0,r.useState)(!0),[m,u]=(0,r.useState)(""),[p,h]=(0,r.useState)("ALL"),[g,y]=(0,r.useState)(!1),b=async()=>{try{x(!0);let t=e?.user?.customerId,s=await fetch(`/api/connections/by-customer?customerId=${t}`),a=await s.json();s.ok&&c(a.connections||[])}catch(e){}finally{x(!1)}},j=async e=>{if(confirm("이 연결 초대를 승인하시겠습니까?"))try{let t=await fetch(`/api/customer-organizations/${e}/approve`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(t.ok)alert("연결이 승인되었습니다."),b();else{let e=await t.json();alert(e.error||"승인 실패")}}catch(e){alert("승인 중 오류가 발생했습니다.")}},N=async e=>{if(confirm("이 연결 초대를 거부하시겠습니까?"))try{let t=await fetch(`/api/customer-organizations/${e}/reject`,{method:"PATCH"});if(t.ok)alert("연결이 거부되었습니다."),b();else{let e=await t.json();alert(e.error||"거부 실패")}}catch(e){alert("거부 중 오류가 발생했습니다.")}},f=async e=>{if(confirm("이 환경측정기업과의 연결을 해제하시겠습니까? 기존 데이터는 읽기 전용으로 유지됩니다."))try{let t=await fetch(`/api/customer-organizations/${e}/disconnect`,{method:"POST"});if(t.ok)alert("연결이 해제되었습니다."),b();else{let e=await t.json();alert(e.error||"연결 해제 실패")}}catch(e){alert("연결 해제 중 오류가 발생했습니다.")}},v=d.filter(e=>{let t=e.organization.name.toLowerCase().includes(m.toLowerCase())||e.organization.businessNumber.includes(m),s="ALL"===p||e.status===p;return t&&s}),w=e=>a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${{PENDING:"bg-yellow-100 text-yellow-800",APPROVED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800",DISCONNECTED:"bg-gray-100 text-gray-800"}[e]}`,children:{PENDING:"대기중",APPROVED:"승인됨",REJECTED:"거부됨",DISCONNECTED:"연결해제"}[e]}),D=e=>"CUSTOMER"===e?a.jsx("span",{className:"text-xs text-blue-600",children:"우리가 요청"}):a.jsx("span",{className:"text-xs text-purple-600",children:"기업 초대"}),C=e?.user?.role,E="CUSTOMER_ADMIN"===C||"SUPER_ADMIN"===C;return o?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"text-gray-500",children:"로딩 중..."})}):(0,a.jsxs)("section",{className:"space-y-3",children:[a.jsx("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-2.5",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[a.jsx("h1",{className:"text-lg font-semibold whitespace-nowrap mb-1.5",children:"환경측정기업 관리"}),a.jsx("span",{className:"text-gray-300 dark:text-gray-600 mb-1.5",children:"|"}),(0,a.jsxs)("div",{className:"flex flex-col",style:{width:"300px",minWidth:"300px"},children:[a.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"검색"}),a.jsx("input",{type:"text",placeholder:"기업명 또는 사업자등록번호 검색",value:m,onChange:e=>u(e.target.value),className:"text-sm h-8 px-3 border rounded dark:bg-gray-800 dark:border-gray-700"})]}),(0,a.jsxs)("div",{className:"flex flex-col",style:{width:"140px",minWidth:"140px"},children:[a.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"상태"}),(0,a.jsxs)("select",{value:p,onChange:e=>h(e.target.value),className:"text-sm h-8 px-2 border rounded dark:bg-gray-800 dark:border-gray-700",children:[a.jsx("option",{value:"ALL",children:"전체"}),a.jsx("option",{value:"PENDING",children:"대기중"}),a.jsx("option",{value:"APPROVED",children:"승인됨"}),a.jsx("option",{value:"REJECTED",children:"거부됨"}),a.jsx("option",{value:"DISCONNECTED",children:"연결해제"})]})]}),E&&a.jsx("button",{onClick:()=>y(!0),className:"ml-auto mb-1.5 bg-blue-600 text-white px-3 py-1.5 text-sm rounded hover:bg-blue-700",children:"+ 환경측정기업 연결 요청"})]})}),a.jsx("div",{className:"hidden md:block rounded-lg border bg-white dark:bg-gray-900",children:a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"상태"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"요청구분"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"기업명"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"사업자등록번호"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"연락처"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"계약기간"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"잔여일"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"사업장"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"액션"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===v.length?a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"px-6 py-4 text-center text-gray-500",children:"연결된 환경측정기업이 없습니다."})}):v.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:w(e.status)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:D(e.requestedBy)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:e.organization.name}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500",children:e.organization.businessNumber}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[a.jsx("div",{children:e.organization.phone}),a.jsx("div",{className:"text-xs text-gray-400",children:e.organization.email})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.contractStartDate&&e.contractEndDate?(0,a.jsxs)("div",{children:[new Date(e.contractStartDate).toLocaleDateString()," ~ ",new Date(e.contractEndDate).toLocaleDateString()]}):"-"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:null!==e.daysRemaining?a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${e.daysRemaining<0?"bg-red-100 text-red-700":e.daysRemaining<=7?"bg-red-50 text-red-600":e.daysRemaining<=28?"bg-yellow-50 text-yellow-700":"bg-green-50 text-green-700"}`,children:e.daysRemaining<0?`만료 ${Math.abs(e.daysRemaining)}일`:`${e.daysRemaining}일`}):"-"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.siteType||"-"}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:["PENDING"===e.status&&"ORGANIZATION"===e.requestedBy&&E&&(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>j(e.id),className:"text-green-600 hover:text-green-900",children:"승인"}),a.jsx("button",{onClick:()=>N(e.id),className:"text-red-600 hover:text-red-900",children:"거부"})]}),"APPROVED"===e.status&&(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>s.push(`/customer/organizations/${e.organization.id}`),className:"text-blue-600 hover:text-blue-900",children:"상세"}),E&&a.jsx("button",{onClick:()=>f(e.id),className:"text-red-600 hover:text-red-900",children:"연결해제"})]}),"PENDING"===e.status&&"CUSTOMER"===e.requestedBy&&a.jsx("span",{className:"text-gray-500",children:"대기중"})]})]},e.id))})]})})}),a.jsx("div",{className:"md:hidden space-y-3",children:0===v.length?a.jsx("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-6 text-center text-gray-500",children:"연결된 환경측정기업이 없습니다."}):v.map(e=>(0,a.jsxs)("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[w(e.status),D(e.requestedBy)]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[a.jsx("div",{className:"font-medium text-lg",children:e.organization.name}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCBC 사업자:"})," ",e.organization.businessNumber]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCDE 연락처:"})," ",e.organization.phone]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["\uD83D\uDCE7 ",e.organization.email]}),e.contractStartDate&&e.contractEndDate&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCC5 계약:"})," ",new Date(e.contractStartDate).toLocaleDateString()," ~ ",new Date(e.contractEndDate).toLocaleDateString()]}),null!==e.daysRemaining&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-gray-500",children:"⏱️ 잔여:"})," ",a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${e.daysRemaining<0?"bg-red-100 text-red-700":e.daysRemaining<=7?"bg-red-50 text-red-600":e.daysRemaining<=28?"bg-yellow-50 text-yellow-700":"bg-green-50 text-green-700"}`,children:e.daysRemaining<0?`만료 ${Math.abs(e.daysRemaining)}일`:`${e.daysRemaining}일`})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 pt-2",children:["PENDING"===e.status&&"ORGANIZATION"===e.requestedBy&&E&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{onClick:()=>j(e.id),className:"w-full px-3 py-2 bg-green-500 text-white hover:bg-green-600 rounded text-sm",children:"승인"}),a.jsx("button",{onClick:()=>N(e.id),className:"w-full px-3 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded text-sm",children:"거부"})]}),"APPROVED"===e.status&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{onClick:()=>s.push(`/customer/organizations/${e.organization.id}`),className:"w-full px-3 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded text-sm",children:"상세"}),E&&a.jsx("button",{onClick:()=>f(e.id),className:"w-full px-3 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded text-sm",children:"연결해제"})]}),"PENDING"===e.status&&"CUSTOMER"===e.requestedBy&&a.jsx("div",{className:"text-center text-gray-500",children:"대기중"})]})]})]},e.id))}),a.jsx(l,{isOpen:g,onClose:()=>y(!1),onSuccess:b})]})}},62250:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`C:\Users\User\boaz\frontend\src\app\customer\organizations\page.tsx#default`)},73881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(66621);let r=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,9975,6621,5736],()=>s(40560));module.exports=a})();