(()=>{var e={};e.id=6227,e.ids=[6227],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},9199:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>c.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>h,tree:()=>d}),a(73043),a(92553),a(35866);var t=a(23191),r=a(88716),l=a(37922),c=a.n(l),i=a(95231),n={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>i[e]);a.d(s,n);let d=["",{children:["masters",{children:["stacks",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,73043)),"C:\\Users\\User\\boaz\\frontend\\src\\app\\masters\\stacks\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,92553)),"C:\\Users\\User\\boaz\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["C:\\Users\\User\\boaz\\frontend\\src\\app\\masters\\stacks\\page.tsx"],x="/masters/stacks/page",m={require:a,loadChunk:()=>Promise.resolve()},h=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/masters/stacks/page",pathname:"/masters/stacks",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},84367:(e,s,a)=>{Promise.resolve().then(a.bind(a,23784))},36728:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(62881).Z)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},94019:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(62881).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},23784:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>g});var t=a(10326),r=a(17577),l=a(21120),c=a(94585),i=a(99837),n=a(89175);function d({isOpen:e,onClose:s,onSuccess:a,stack:l}){let c=!!l,[d,o]=(0,r.useState)([]),[x,m]=(0,r.useState)({customerId:l?.customerId||"",name:l?.name||"",code:l?.code||"",fullName:l?.fullName||"",facilityType:l?.facilityType||"",height:l?.height?.toString()||"",diameter:l?.innerDiameter?.toString()||"",category:l?.category||""}),[h,u]=(0,r.useState)(!1),[g,p]=(0,r.useState)(""),y=(e,s)=>{m(a=>({...a,[e]:s}))},b=async e=>{if(e.preventDefault(),p(""),!x.customerId){p("고객사를 선택해주세요.");return}if(!x.name){p("굴뚝번호는 필수입니다.");return}u(!0);try{let e={customerId:x.customerId,name:x.name};x.code&&(e.code=x.code),x.fullName&&(e.fullName=x.fullName),x.facilityType&&(e.facilityType=x.facilityType),x.height&&(e.height=parseFloat(x.height)),x.diameter&&(e.diameter=parseFloat(x.diameter)),x.category&&(e.category=x.category);let t=c?`/api/stacks/${l.id}`:"/api/stacks",r=await fetch(t,{method:c?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw Error(e.error||"저장 실패")}c||m({customerId:"",name:"",code:"",fullName:"",facilityType:"",height:"",diameter:"",category:""}),a(),s()}catch(e){p(e.message)}finally{u(!1)}};return e?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:s,children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b px-6 py-4 flex items-center justify-between",children:[t.jsx("h2",{className:"text-xl font-semibold",children:c?"굴뚝 정보 수정":"신규 굴뚝 추가"}),t.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"✕"})]}),(0,t.jsxs)("form",{onSubmit:b,className:"p-6 space-y-4",children:[g&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-4 py-3 rounded",children:g}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["고객사 ",t.jsx("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{value:x.customerId,onChange:e=>y("customerId",e.target.value),className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-700",required:!0,children:[t.jsx("option",{value:"",children:"고객사를 선택하세요"}),d.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.code||"코드없음",")"]},e.id))]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝번호 ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(n.Z,{value:x.name,onChange:e=>y("name",e.target.value),placeholder:"예: #A2020007",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝코드 ",t.jsx("span",{className:"text-gray-400",children:"(선택)"})]}),t.jsx(n.Z,{value:x.code,onChange:e=>y("code",e.target.value),placeholder:"예: CUST001-#A2020007"})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝 정식 명칭 ",t.jsx("span",{className:"text-gray-400",children:"(선택)"})]}),t.jsx(n.Z,{value:x.fullName,onChange:e=>y("fullName",e.target.value),placeholder:"예: Silp PC 300 B/F"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["배출시설 종류 ",t.jsx("span",{className:"text-gray-400",children:"(선택)"})]}),t.jsx(n.Z,{value:x.facilityType,onChange:e=>y("facilityType",e.target.value),placeholder:"예: 고체입자상물질 저장시설"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝 높이(m) ",t.jsx("span",{className:"text-gray-400",children:"(선택)"})]}),t.jsx(n.Z,{type:"number",step:"0.1",value:x.height,onChange:e=>y("height",e.target.value),placeholder:"예: 19.6"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝 안지름(m) ",t.jsx("span",{className:"text-gray-400",children:"(선택)"})]}),t.jsx(n.Z,{type:"number",step:"0.01",value:x.diameter,onChange:e=>y("diameter",e.target.value),placeholder:"예: 0.30"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["굴뚝 종별(종) ",t.jsx("span",{className:"text-gray-400",children:"(선택)"})]}),t.jsx(n.Z,{value:x.category,onChange:e=>y("category",e.target.value),placeholder:"예: 5"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[t.jsx(i.Z,{type:"button",variant:"secondary",onClick:s,className:"flex-1",children:"취소"}),t.jsx(i.Z,{type:"submit",disabled:h,className:"flex-1",children:h?"저장 중...":"저장"})]})]})]})}):null}var o=a(32743),x=a(36728),m=a(94019);function h({stack:e,role:s,onRefetch:a,onEdit:l}){let[i,n]=(0,r.useState)(!1),d=async()=>{if(!i){n(!0);try{(await fetch(`/api/stacks/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!e.isActive})})).ok?a():alert("상태 변경 실패")}catch(e){alert("오류 발생")}finally{n(!1)}}},o=async()=>{if(e._count?.measurements&&e._count.measurements>0){alert("측정 기록이 있는 굴뚝은 삭제할 수 없습니다. 비활성화를 사용하세요.");return}if(confirm(`"${e.name}" 굴뚝을 삭제하시겠습니까?`)){n(!0);try{let s=await fetch(`/api/stacks/${e.id}`,{method:"DELETE"});if(s.ok)a();else{let e=await s.json();alert(e.error||"삭제 실패")}}catch(e){alert("오류 발생")}finally{n(!1)}}},x=!1!==e.isActive,m=!1!==e.customer.isActive;return(0,t.jsxs)(c.Tr,{className:x&&m?"":"opacity-50 bg-gray-50 dark:bg-gray-900/20",children:[t.jsx(c.Td,{children:x?t.jsx("span",{className:"inline-block px-2 py-0.5 rounded bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 text-xs",children:"활성"}):t.jsx("span",{className:"inline-block px-2 py-0.5 rounded bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 text-xs",children:"비활성"})}),t.jsx(c.Td,{className:"font-mono text-xs break-words",children:e.name}),t.jsx(c.Td,{className:"font-mono text-xs break-words",children:e.code||"-"}),t.jsx(c.Td,{className:"text-sm break-words",children:e.fullName||"-"}),t.jsx(c.Td,{className:"text-sm break-words",children:e.facilityType||"-"}),t.jsx(c.Td,{className:"text-center break-words",children:e.height??"-"}),t.jsx(c.Td,{className:"text-center break-words",children:e.diameter??"-"}),t.jsx(c.Td,{className:"text-center break-words",children:e.category||"-"}),(0,t.jsxs)(c.Td,{className:"break-words",children:[t.jsx("span",{className:"font-medium",children:e.customer.name}),e.customer.code&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[" (",e.customer.code,")"]}),!m&&t.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 ml-1",children:"비활성"})]}),t.jsx(c.Td,{className:"text-center text-sm break-words",children:new Date(e.createdAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\. /g,"-").replace(".","")}),("SUPER_ADMIN"===s||"ORG_ADMIN"===s)&&t.jsx(c.Td,{children:(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>l(e),disabled:i,className:"text-xs text-green-600 hover:underline disabled:opacity-50",children:"수정"}),t.jsx("button",{onClick:d,disabled:i,className:"text-xs text-blue-600 hover:underline disabled:opacity-50",children:x?"비활성화":"활성화"}),!x&&!e._count?.measurements&&t.jsx("button",{onClick:o,disabled:i,className:"text-xs text-red-600 hover:underline disabled:opacity-50",children:"삭제"})]})})]})}function u(){let[e,s]=(0,r.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.Z,{size:"sm",variant:"secondary",onClick:()=>s(!0),children:[t.jsx(x.Z,{className:"w-4 h-4 mr-1"}),"도움말"]}),e&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>s(!1),children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b p-4 flex justify-between items-center",children:[t.jsx("h2",{className:"text-xl font-bold",children:"굴뚝 관리 도움말"}),t.jsx("button",{onClick:()=>s(!1),className:"text-gray-500 hover:text-gray-700",children:t.jsx(m.Z,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("section",{children:[t.jsx("h3",{className:"font-semibold text-base mb-2",children:"\uD83D\uDCCB 기본 기능"}),(0,t.jsxs)("ul",{className:"list-disc list-inside text-gray-600 dark:text-gray-400 space-y-1",children:[t.jsx("li",{children:"담당 고객사의 모든 굴뚝 정보를 조회하고 관리할 수 있습니다"}),t.jsx("li",{children:"검색 기능으로 굴뚝번호, 코드, 명칭, 배출시설, 고객사로 검색 가능합니다"}),t.jsx("li",{children:"고객사 필터로 특정 고객사의 굴뚝만 조회할 수 있습니다"}),t.jsx("li",{children:"확인필요 항목이 우선 정렬되며, 날짜 최신순으로 표시됩니다"}),t.jsx("li",{children:"Excel 버튼으로 목록을 다운로드할 수 있습니다"})]})]}),(0,t.jsxs)("section",{children:[t.jsx("h3",{className:"font-semibold text-base mb-2",children:"➕ 굴뚝 신규 추가"}),(0,t.jsxs)("div",{className:"space-y-2 text-gray-600 dark:text-gray-400",children:[t.jsx("p",{children:'"+ 신규 추가" 버튼을 클릭하여 새로운 굴뚝을 등록할 수 있습니다.'}),(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded",children:[t.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"필수 입력 항목:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,t.jsxs)("li",{children:[t.jsx("strong",{children:"고객사"}),": 굴뚝이 속한 고객사 선택"]}),(0,t.jsxs)("li",{children:[t.jsx("strong",{children:"굴뚝번호"}),": 환경측정기업 내부 코드 (예: S-001)"]}),(0,t.jsxs)("li",{children:[t.jsx("strong",{children:"현장 명칭"}),": 굴뚝의 명칭 (예: 1호 소각로)"]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 p-3 rounded",children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-300 mb-2",children:"선택 입력 항목:"}),t.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.jsx("li",{children:"굴뚝코드, 배출시설 종류, 높이, 안지름, 종별 등"})})]}),t.jsx("p",{className:"text-sm italic",children:"\uD83D\uDCA1 등록한 굴뚝은 고객사의 검토대기 탭에 표시되며, 고객사에 알림이 전송됩니다."})]})]}),(0,t.jsxs)("section",{children:[t.jsx("h3",{className:"font-semibold text-base mb-2",children:"✏️ 굴뚝 정보 수정"}),(0,t.jsxs)("div",{className:"space-y-2 text-gray-600 dark:text-gray-400",children:[t.jsx("p",{children:'"수정" 버튼을 클릭하여 굴뚝 정보를 수정할 수 있습니다.'}),t.jsx("p",{className:"text-sm italic",children:"⚠️ 수정 시 고객사에 알림이 전송되며, 모든 수정 이력이 자동으로 기록됩니다."})]})]}),(0,t.jsxs)("section",{children:[t.jsx("h3",{className:"font-semibold text-base mb-2",children:"\uD83D\uDCE4 일괄업로드"}),(0,t.jsxs)("div",{className:"space-y-2 text-gray-600 dark:text-gray-400",children:[t.jsx("p",{children:'"일괄업로드" 버튼을 클릭하여 CSV 파일로 여러 굴뚝을 한 번에 등록할 수 있습니다.'}),t.jsx("p",{className:"text-sm italic",children:"\uD83D\uDCA1 양식 다운로드 후 작성하여 업로드하세요."})]})]}),(0,t.jsxs)("section",{children:[t.jsx("h3",{className:"font-semibold text-base mb-2",children:"\uD83D\uDD14 알림 기능"}),(0,t.jsxs)("ul",{className:"list-disc list-inside text-gray-600 dark:text-gray-400 space-y-1",children:[t.jsx("li",{children:"고객사가 굴뚝 정보를 수정하면 실시간 알림을 받습니다"}),t.jsx("li",{children:"고객사가 굴뚝 확인 완료 시 알림을 받습니다"}),t.jsx("li",{children:"우측 상단 알림 아이콘에서 확인할 수 있습니다"})]})]})]})]})})]})}function g(){let{user:e}=(0,l.a)(),s=e?.role,[a,x]=(0,r.useState)([]),[m,g]=(0,r.useState)(""),[p,y]=(0,r.useState)("전체"),[b,j]=(0,r.useState)(!1),[f,N]=(0,r.useState)(!1),[k,v]=(0,r.useState)(!1),[w,C]=(0,r.useState)(null),[D,T]=(0,r.useState)(!1),S=e=>{C(e),v(!0)},A=async()=>{try{let e=await fetch("/api/stacks"),s=await e.json();x(s.data||[])}catch(e){}},_=(0,r.useMemo)(()=>Array.from(new Map(a.map(e=>[e.customer.id,e.customer])).values()).sort((e,s)=>"CUST999"===e.code?1:"CUST999"===s.code?-1:(e.code||e.name).localeCompare(s.code||s.name)),[a]),$=(0,r.useMemo)(()=>a.filter(e=>{if(!m){let s="전체"===p||e.customer.name===p,a=!!b||!1!==e.customer.isActive,t=!!f||!1!==e.isActive;return s&&a&&t}let s=m.toLowerCase(),a=e.name&&e.name.toLowerCase().includes(s)||e.code&&e.code.toLowerCase().includes(s)||e.fullName&&e.fullName.toLowerCase().includes(s)||e.facilityType&&e.facilityType.toLowerCase().includes(s)||e.customer.name&&e.customer.name.toLowerCase().includes(s)||e.customer.code&&e.customer.code.toLowerCase().includes(s),t="전체"===p||e.customer.name===p,r=!!b||!1!==e.customer.isActive,l=!!f||!1!==e.isActive;return a&&t&&r&&l}).sort((e,s)=>{if(e.isVerified!==s.isVerified)return e.isVerified?1:-1;let a=e.verifiedAt||e.createdAt||e.id,t=s.verifiedAt||s.createdAt||s.id;if(a!==t)return t.localeCompare(a);let r=(e.customer.code||e.customer.name).localeCompare(s.customer.code||s.customer.name);return 0!==r?r:(e.name||"").localeCompare(s.name||"")}),[a,m,p,b,f]),P=async e=>{try{let s=await e.text(),a=await fetch("/api/stacks/bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvText:s})}),t=await a.json();if(!a.ok||!t.success)return{success:!1,message:t.error||t.message||"업로드 실패"};if(A(),t.errors&&t.errors.length>0){let e=t.errors.join("\n");return{success:!0,message:`${t.message}

실패 상세:
${e}`,count:t.count}}return{success:!0,message:t.message||"업로드 성공",count:t.count}}catch(e){return{success:!1,message:e.message||"오류 발생"}}};return(0,t.jsxs)("section",{className:"space-y-3",children:[t.jsx("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-2.5",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[t.jsx("h1",{className:"text-lg font-semibold whitespace-nowrap mb-1.5",children:"굴뚝 관리"}),t.jsx("span",{className:"text-gray-300 dark:text-gray-600 mb-1.5",children:"|"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"검색"}),t.jsx(n.Z,{className:"text-sm h-8",style:{width:"352px",minWidth:"352px"},value:m,onChange:e=>g(e.target.value),placeholder:"굴뚝번호, 코드, 명칭, 배출시설, 고객사 등"})]}),(0,t.jsxs)("div",{className:"flex flex-col",style:{width:"176px",minWidth:"176px"},children:[t.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-0.5",children:"고객사"}),(0,t.jsxs)("select",{className:"text-sm h-8 w-full border rounded px-2 bg-white dark:bg-gray-800",value:p,onChange:e=>y(e.target.value),children:[t.jsx("option",{children:"전체"}),_.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer mb-1.5 whitespace-nowrap ml-auto",children:[t.jsx("input",{type:"checkbox",checked:b,onChange:e=>j(e.target.checked),className:"rounded"}),"비활성 고객사"]}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer mb-1.5 whitespace-nowrap",children:[t.jsx("input",{type:"checkbox",checked:f,onChange:e=>N(e.target.checked),className:"rounded"}),"비활성 굴뚝"]}),(0,t.jsxs)("div",{className:"flex gap-1.5 mb-1.5",children:[t.jsx(u,{}),("SUPER_ADMIN"===s||"ORG_ADMIN"===s)&&(0,t.jsxs)(t.Fragment,{children:[t.jsx(i.Z,{size:"sm",variant:"secondary",onClick:()=>{let e=new Blob(["\uFEFF"+[["굴뚝번호","굴뚝코드","굴뚝 정식 명칭","배출시설 종류","굴뚝 높이(m)","굴뚝 안지름(m)","굴뚝 종별(종)","고객사","고객사코드","생성일"],...$.map(e=>[e.name||"",e.code||"",e.fullName||"",e.facilityType||"",e.height||"",e.diameter||"",e.category||"",e.customer.name||"",e.customer.code||"",new Date(e.createdAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\. /g,"-").replace(".","")])].map(e=>e.map(e=>`"${String(e??"").replace(/"/g,'""')}"`).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=`stacks_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)},children:"Excel"}),t.jsx(i.Z,{size:"sm",variant:"secondary",onClick:()=>T(!0),children:"일괄업로드"}),t.jsx(i.Z,{size:"sm",onClick:()=>v(!0),children:"+ 신규 추가"})]})]})]})}),("SUPER_ADMIN"===s||"ORG_ADMIN"===s)&&$.length>0&&(m||"전체"!==p)&&(0,t.jsxs)("div",{className:"flex gap-2 items-center bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,t.jsxs)("span",{className:"text-sm text-blue-700 dark:text-blue-300 font-medium",children:["검색 결과 ",$.length,"건"]}),(0,t.jsxs)("div",{className:"flex gap-2 ml-auto",children:[t.jsx(i.Z,{size:"sm",variant:"secondary",onClick:async()=>{if(!confirm(`검색된 ${$.length}개 굴뚝을 모두 비활성화하시겠습니까?`))return;let e=0;for(let s of $)try{(await fetch(`/api/stacks/${s.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!1})})).ok&&e++}catch(e){}alert(`${e}개 굴뚝을 비활성화했습니다.`),A()},children:"전체 비활성화"}),t.jsx(i.Z,{size:"sm",variant:"secondary",onClick:async()=>{if($.some(e=>e._count?.measurements&&e._count.measurements>0)){alert("측정 기록이 있는 굴뚝이 포함되어 있어 삭제할 수 없습니다. 비활성화를 사용하세요.");return}if(!confirm(`검색된 ${$.length}개 굴뚝을 모두 삭제하시겠습니까?
이 작업은 되돌릴 수 없습니다.`))return;let e=0;for(let s of $)try{(await fetch(`/api/stacks/${s.id}`,{method:"DELETE"})).ok&&e++}catch(e){}alert(`${e}개 굴뚝을 삭제했습니다.`),A()},className:"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",children:"전체 삭제"})]})]}),t.jsx("div",{className:"hidden md:block rounded-lg border max-h-[calc(100vh-180px)] overflow-y-auto",children:(0,t.jsxs)(c.iA,{className:"w-full table-fixed",children:[t.jsx(c.hr,{className:"bg-gray-50 dark:bg-white/10 sticky top-0 z-10",children:(0,t.jsxs)(c.Tr,{children:[t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"상태"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"굴뚝번호"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"굴뚝코드"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"굴뚝 정식 명칭"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"배출시설 종류"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"높이(m)"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"안지름(m)"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"종별"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"고객사"}),t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"생성일"}),("SUPER_ADMIN"===s||"ORG_ADMIN"===s)&&t.jsx(c.Th,{className:"bg-gray-50 dark:bg-gray-800",children:"액션"})]})}),t.jsx(c.p3,{children:0===$.length?t.jsx(c.Tr,{children:t.jsx(c.Td,{colSpan:"SUPER_ADMIN"===s||"ORG_ADMIN"===s?11:10,className:"text-center text-gray-500 py-8",children:"등록된 굴뚝이 없습니다"})}):$.map(e=>t.jsx(h,{stack:e,role:s,onRefetch:A,onEdit:S},e.id))})]})}),t.jsx("div",{className:"md:hidden space-y-3",children:0===$.length?t.jsx("div",{className:"rounded-lg border bg-white/50 dark:bg-white/5 p-6 text-center text-gray-500",children:"등록된 굴뚝이 없습니다"}):$.map(e=>{let a=!1!==e.isActive,r=!1!==e.customer.isActive;return(0,t.jsxs)("div",{className:`rounded-lg border bg-white/50 dark:bg-white/5 p-4 space-y-2 ${a&&r?"":"opacity-50"}`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs ${a?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,children:a?"활성":"비활성"}),("SUPER_ADMIN"===s||"ORG_ADMIN"===s)&&(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>S(e),className:"text-xs text-blue-600 hover:underline",children:"수정"}),t.jsx("button",{onClick:async()=>{try{(await fetch(`/api/stacks/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!e.isActive})})).ok?A():alert("상태 변경 실패")}catch(e){alert("오류 발생")}},className:"text-xs text-blue-600 hover:underline",children:a?"비활성화":"활성화"}),!a&&!e._count?.measurements&&t.jsx("button",{onClick:async()=>{if(confirm(`"${e.name}" 굴뚝을 삭제하시겠습니까?`))try{(await fetch(`/api/stacks/${e.id}`,{method:"DELETE"})).ok?A():alert("삭제 실패")}catch(e){alert("오류 발생")}},className:"text-xs text-gray-600 hover:underline",children:"삭제"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-500",children:"\uD83C\uDFED 번호:"})," ",e.name]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCCB 코드:"})," ",e.code||"-"]}),(0,t.jsxs)("div",{className:"col-span-2",children:[t.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCCD 정식명:"})," ",e.fullName||"-"]}),(0,t.jsxs)("div",{className:"col-span-2",children:[t.jsx("span",{className:"text-gray-500",children:"⚙️ 시설:"})," ",e.facilityType||"-"]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCCF 높이:"})," ",e.height??"-","m"]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-500",children:"⭕ 안지름:"})," ",e.diameter??"-","m"]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-500",children:"\uD83C\uDFF7️ 종별:"})," ",e.category||"-"]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCC5 생성:"})," ",new Date(e.createdAt).toLocaleDateString("ko-KR",{month:"2-digit",day:"2-digit"})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[t.jsx("span",{className:"text-gray-500",children:"\uD83C\uDFE2 고객사:"})," ",e.customer.name,e.customer.code&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[" (",e.customer.code,")"]}),!r&&t.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 ml-1",children:"비활성"})]})]})]},e.id)})}),t.jsx(d,{isOpen:k,onClose:()=>{v(!1),C(null)},onSuccess:()=>{A(),v(!1),C(null)},stack:w}),t.jsx(o.Z,{isOpen:D,onClose:()=>T(!1),title:"굴뚝 일괄업로드",templateHeaders:["고객사코드","굴뚝번호","굴뚝코드","굴뚝 정식 명칭","배출시설 종류","위치","굴뚝 높이(m)","굴뚝 안지름(m)","굴뚝 종별(종)"],exampleRow:["CUST001","ST-001","C-ST01001","1호 소각로 굴뚝","소각시설","공장동 옥상","25.5","0.8","1종"],templateFileName:"굴뚝_일괄업로드_양식.csv",onUpload:P,parseInstructions:"고객사코드와 굴뚝번호는 필수 항목입니다. 고객사코드는 기존에 등록된 고객사의 코드여야 합니다."})]})}},32743:(e,s,a)=>{"use strict";a.d(s,{Z:()=>c});var t=a(10326),r=a(17577),l=a(99837);function c({isOpen:e,onClose:s,title:a,templateHeaders:c,exampleRow:i,templateFileName:n,onUpload:d,parseInstructions:o="양식에 맞게 작성한 CSV 파일을 업로드하세요."}){let[x,m]=(0,r.useState)(null),[h,u]=(0,r.useState)(!1),[g,p]=(0,r.useState)(""),y=async()=>{if(!x){p("파일을 선택해주세요.");return}u(!0),p("");try{let e=await d(x);if(e.success){let s=e.message||"업로드 완료";p(`✅ ${s}`),m(null)}else p(`❌ ${e.message||"업로드 실패"}`)}catch(e){p(`❌ 오류: ${e.message||"업로드 중 문제가 발생했습니다."}`)}finally{u(!1)}},b=()=>{h||(m(null),p(""),s())};return e?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:b,children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold",children:a}),t.jsx("button",{onClick:b,disabled:h,className:"text-gray-500 hover:text-gray-700 disabled:opacity-50",children:"✕"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded",children:[t.jsx("p",{className:"font-medium mb-1",children:"\uD83D\uDCCB 업로드 절차"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-xs",children:[t.jsx("li",{children:'아래 "업로드 양식 다운로드" 버튼을 클릭하여 CSV 양식을 다운로드합니다.'}),t.jsx("li",{children:"다운로드한 양식에 데이터를 입력합니다. (예시 행 참고)"}),t.jsx("li",{children:'"파일 선택" 버튼을 클릭하여 작성한 CSV 파일을 선택합니다.'}),t.jsx("li",{children:'"업로드" 버튼을 클릭하여 데이터를 등록합니다.'})]})]}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:o}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[t.jsx("div",{className:"flex gap-2",children:t.jsx(l.Z,{variant:"secondary",onClick:()=>{let e=new Blob(["\uFEFF"+c.map(e=>`"${e}"`).join(",")+"\n"+i.map(e=>`"${e}"`).join(",")+"\n"],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=n,a.click(),URL.revokeObjectURL(s)},disabled:h,className:"flex-1",children:"\uD83D\uDCE5 업로드 양식 다운로드"})}),t.jsx("div",{className:"flex gap-2",children:(0,t.jsxs)("label",{className:"flex-1",children:[t.jsx("div",{className:`px-4 py-2 border-2 border-dashed rounded cursor-pointer text-center transition-colors ${x?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400"} ${h?"opacity-50 cursor-not-allowed":""}`,children:x?(0,t.jsxs)("span",{className:"text-sm",children:["\uD83D\uDCC4 ",x.name]}):t.jsx("span",{className:"text-sm text-gray-500",children:"\uD83D\uDCC1 파일 선택 (CSV)"})}),t.jsx("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>{let s=e.target.files?.[0];s&&(m(s),p(""))},disabled:h})]})}),t.jsx(l.Z,{onClick:y,disabled:!x||h,className:"w-full",children:h?"업로드 중...":"업로드"})]}),g&&t.jsx("div",{className:`text-sm p-4 rounded border-2 ${g.startsWith("✅")?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border-green-500":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border-red-500"}`,children:(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[t.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:g}),t.jsx(l.Z,{size:"sm",onClick:()=>{p(""),b()},className:"self-end",children:"확인"})]})})]}),!g&&t.jsx("div",{className:"mt-6 flex justify-end gap-2",children:t.jsx(l.Z,{variant:"secondary",onClick:b,disabled:h,children:"닫기"})})]})}):null}},99837:(e,s,a)=>{"use strict";a.d(s,{Z:()=>c});var t=a(10326);a(17577);let r={primary:"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90",secondary:"border border-gray-300 text-gray-900 hover:bg-gray-50 dark:border-white/20 dark:text-white dark:hover:bg-white/10",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-white/10"},l={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-11 px-5 text-base"};function c({variant:e="primary",size:s="md",className:a="",...c}){return t.jsx("button",{className:`inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ${r[e]} ${l[s]} ${a}`,...c})}},89175:(e,s,a)=>{"use strict";a.d(s,{Z:()=>r});var t=a(10326);function r({className:e="",...s}){return t.jsx("input",{className:`rounded-md border bg-transparent px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-white/20 ${e}`,...s})}a(17577)},94585:(e,s,a)=>{"use strict";a.d(s,{Td:()=>d,Th:()=>n,Tr:()=>i,hr:()=>l,iA:()=>r,p3:()=>c});var t=a(10326);function r({className:e="",...s}){return t.jsx("table",{className:`w-full text-sm border-collapse ${e}`,...s})}function l(e){return t.jsx("thead",{...e})}function c(e){return t.jsx("tbody",{...e})}function i(e){return t.jsx("tr",{className:"border-b last:border-0 border-gray-200 dark:border-white/10",...e})}function n({className:e="",...s}){return t.jsx("th",{className:`text-left py-2 px-3 font-medium text-gray-600 dark:text-gray-300 ${e}`,...s})}function d({className:e="",...s}){return t.jsx("td",{className:`py-2 px-3 ${e}`,...s})}a(17577)},73043:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>t});let t=(0,a(68570).createProxy)(String.raw`C:\Users\User\boaz\frontend\src\app\masters\stacks\page.tsx#default`)},73881:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>r});var t=a(66621);let r=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,t.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[8948,9975,6621,5736],()=>a(9199));module.exports=t})();