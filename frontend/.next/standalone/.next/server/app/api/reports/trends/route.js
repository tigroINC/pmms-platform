"use strict";(()=>{var e={};e.id=3165,e.ids=[3165],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},17656:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>c,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>d});var n=r(49303),s=r(88716),o=r(60670),i=r(87070),u=r(20728);async function d(e){let{searchParams:t}=new URL(e.url),r=t.get("customerId")||void 0,a=t.get("stack")||void 0,n=t.get("itemKey")||void 0,s=t.get("start")||void 0,o=t.get("end")||void 0;if(!n)return i.NextResponse.json({error:"itemKey is required"},{status:400});let d={itemKey:n};r&&(d.customerId=r),(s||o)&&(d.measuredAt={gte:s?new Date(s):void 0,lte:o?new Date(o):void 0}),a&&(d.stack={name:a});let p=await u._.measurement.findMany({where:d,include:{item:!0},orderBy:{measuredAt:"asc"}}),l=s?new Date(s):p[0]?new Date(p[0].measuredAt):new Date,m=o?new Date(o):p[p.length-1]?new Date(p[p.length-1].measuredAt):new Date;l.setDate(1),m.setDate(1);let g=[],c=[],h={},v=new Date(l);for(;v<=m;){let e=`${v.getFullYear()}-${(v.getMonth()+1).toString().padStart(2,"0")}`;c.push(e),g.push(`${v.getMonth()+1}ì›”`),h[e]=[],v.setMonth(v.getMonth()+1)}for(let e of p){let t=new Date(e.measuredAt),r=`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}`;r in h&&h[r].push(Number(e.value))}let w=c.map(e=>{let t=h[e];return t&&0!==t.length?Number((t.reduce((e,t)=>e+t,0)/t.length).toFixed(1)):0}),x=p[0]?.item?.limit??0;return i.NextResponse.json({data:{labels:g,data:w,limit:x}})}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/reports/trends/route",pathname:"/api/reports/trends",filename:"route",bundlePath:"app/api/reports/trends/route"},resolvedPagePath:"C:\\Users\\User\\boaz\\frontend\\src\\app\\api\\reports\\trends\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:g}=p,c="/api/reports/trends/route";function h(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},20728:(e,t,r)=>{r.d(t,{_:()=>n});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient({log:["warn","error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972],()=>r(17656));module.exports=a})();