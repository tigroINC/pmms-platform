(()=>{var e={};e.id=8355,e.ids=[8355],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},1828:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>d.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>h,tree:()=>c}),a(5448),a(92553),a(35866);var r=a(23191),s=a(88716),i=a(37922),d=a.n(i),l=a(95231),n={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);a.d(t,n);let c=["",{children:["communications",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,5448)),"C:\\Users\\User\\boaz\\frontend\\src\\app\\communications\\[id]\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,92553)),"C:\\Users\\User\\boaz\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["C:\\Users\\User\\boaz\\frontend\\src\\app\\communications\\[id]\\page.tsx"],x="/communications/[id]/page",m={require:a,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/communications/[id]/page",pathname:"/communications/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},47127:(e,t,a)=>{Promise.resolve().then(a.bind(a,23256))},98091:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});let r=(0,a(62881).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},23256:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var r=a(10326),s=a(17577),i=a(77109),d=a(35047),l=a(99837),n=a(62881);let c=(0,n.Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var o=a(36728);let x=(0,n.Z)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var m=a(98091);let h=(0,n.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),g=(0,n.Z)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var y=a(68894);let u={PHONE:"\uD83D\uDCDE 전화",EMAIL:"\uD83D\uDCE7 이메일",VISIT:"\uD83D\uDC64 방문",KAKAO:"\uD83D\uDCAC 카톡",SMS:"\uD83D\uDCF1 SMS",FAX:"\uD83D\uDCE0 팩스",OTHER:"기타"},p={PENDING:{label:"답변대기",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"},IN_PROGRESS:{label:"대화중",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"},COMPLETED:{label:"완료",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"},REFERENCE:{label:"참고",color:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-300"}},b={URGENT:{label:"긴급",icon:"\uD83D\uDD34"},HIGH:{label:"높음",icon:"\uD83D\uDFE0"},NORMAL:{label:"보통",icon:"⚪"},LOW:{label:"낮음",icon:"\uD83D\uDD35"}},j=(e,t)=>"PENDING"!==e||t?p[e]:{label:"완료전",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"};function k(){let{data:e}=(0,i.useSession)(),t=(0,d.useRouter)(),a=(0,d.useParams)().id,[n,k]=(0,s.useState)(null),[v,w]=(0,s.useState)(!0),[f,N]=(0,s.useState)(""),[C,D]=(0,s.useState)(""),[S,E]=(0,s.useState)(!1),[P,M]=(0,s.useState)(!1),[T,O]=(0,s.useState)(!1),[A,_]=(0,s.useState)({subject:"",content:""}),[Z,R]=(0,s.useState)(!1),z=e?.user,U=z?.role==="CUSTOMER_ADMIN"||z?.role==="CUSTOMER_USER",q=n?.createdBy.id===z?.id,G=q&&(!n?.replies||0===n.replies.length),L=n?.status==="COMPLETED",H=async()=>{try{w(!0);let e=await fetch(`/api/communications/${a}`);if(!e.ok)return;let t=await e.json(),r=t.communication||t;r&&r.id&&(k(r),_({subject:r.subject||"",content:r.content||""}))}catch(e){}finally{w(!1)}},$=async e=>{if(confirm(`상태를 ${p[e].label}(으)로 변경하시겠습니까?`))try{let t=await fetch(`/api/communications/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})});if(t.ok)H();else{let e=await t.json();alert(e.error||"상태 변경 실패")}}catch(e){alert("상태 변경 중 오류가 발생했습니다")}},I=async()=>{if(!f.trim()){alert("답변 내용을 입력해주세요");return}try{E(!0);let e=await fetch(`/api/communications/${a}/replies`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:f})});if(e.ok)N(""),H();else{let t=await e.json();alert(t.error||"답변 추가 실패")}}catch(e){alert("답변 추가 중 오류가 발생했습니다")}finally{E(!1)}},F=async()=>{if(!C.trim()){alert("메모 내용을 입력해주세요");return}try{M(!0);let e=await fetch(`/api/communications/${a}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:C})});if(e.ok)D(""),H();else{let t=await e.json();alert(t.error||"메모 추가 실패")}}catch(e){alert("메모 추가 중 오류가 발생했습니다")}finally{M(!1)}},J=async e=>{try{let t=await fetch(`/api/communications/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isShared:e})});if(t.ok)alert("공유 범위가 변경되었습니다"),H();else{let e=await t.json();alert(e.error||"변경 실패")}}catch(e){alert("변경 중 오류가 발생했습니다")}},K=async()=>{if(!A.content.trim()){alert("내용을 입력해주세요");return}try{let e=await fetch(`/api/communications/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:A.subject,content:A.content})});if(e.ok)alert("수정되었습니다"),O(!1),H();else{let t=await e.json();alert(t.error||"수정 실패")}}catch(e){alert("수정 중 오류가 발생했습니다")}},B=async()=>{if(confirm("정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{let e=await fetch(`/api/communications/${a}`,{method:"DELETE"});if(e.ok)alert("삭제되었습니다"),t.push("/communications");else{let t=await e.json();alert(t.error||"삭제 실패")}}catch(e){alert("삭제 중 오류가 발생했습니다")}};return v?r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsx("div",{className:"text-gray-500",children:"로딩 중..."})}):n?(0,r.jsxs)("section",{className:"p-4 md:p-6 max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,r.jsxs)(l.Z,{variant:"secondary",onClick:()=>t.push("/communications"),children:[r.jsx(c,{className:"w-4 h-4 mr-2"}),"목록"]}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"커뮤니케이션 상세"}),(0,r.jsxs)("button",{onClick:()=>R(!0),className:"ml-auto px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors flex items-center gap-1",children:[r.jsx(o.Z,{className:"w-4 h-4"}),"도움말"]})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:`px-3 py-1 text-sm rounded ${j(n.status,n.isShared).color}`,children:j(n.status,n.isShared).label}),r.jsx("span",{className:"text-2xl",children:b[n.priority].icon}),r.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:b[n.priority].label})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:["COMPLETED"!==n.status&&r.jsx(l.Z,{size:"sm",onClick:()=>$("COMPLETED"),children:"완료 처리"}),G&&!T&&!L&&(0,r.jsxs)(l.Z,{size:"sm",variant:"secondary",onClick:()=>O(!0),children:[r.jsx(x,{className:"w-4 h-4 mr-1"}),"수정"]}),T&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(l.Z,{size:"sm",onClick:K,children:"저장"}),r.jsx(l.Z,{size:"sm",variant:"secondary",onClick:()=>{O(!1),_({subject:n.subject||"",content:n.content||""})},children:"취소"})]}),q&&r.jsx(l.Z,{size:"sm",variant:"secondary",onClick:B,children:r.jsx(m.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[!U&&(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"공유 범위"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("label",{className:"flex items-center cursor-pointer",children:[r.jsx("input",{type:"radio",checked:!0===n.isShared,onChange:async()=>{n.isShared||await J(!0)},className:"mr-2"}),r.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:"고객사 공유"})]}),(0,r.jsxs)("label",{className:"flex items-center cursor-pointer",children:[r.jsx("input",{type:"radio",checked:!1===n.isShared,disabled:!0===n.isShared,className:"mr-2"}),r.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"내부 전용"})]})]})]}),!1===n.isShared&&r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"* 내부 전용은 고객사 공유로만 변경 가능합니다"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:U?"환경측정기업":"고객사"}),r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:U?n.contactOrg||"-":n.customer.name})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"소통 일시"}),r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:new Date(n.contactAt).toLocaleString("ko-KR")})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"채널"}),r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:u[n.channel]})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"작성자"}),r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:n.createdBy.name})]}),n.assignedTo&&(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"담당자"}),r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:n.assignedTo.name})]})]}),T?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm text-gray-500 dark:text-gray-400 mb-1",children:"제목"}),r.jsx("input",{type:"text",value:A.subject,onChange:e=>_({...A,subject:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"제목 (선택사항)"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm text-gray-500 dark:text-gray-400 mb-1",children:["내용 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("textarea",{value:A.content,onChange:e=>_({...A,content:e.target.value}),rows:6,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"내용을 입력하세요",required:!0})]})]}):(0,r.jsxs)(r.Fragment,{children:[n.subject&&(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"제목"}),r.jsx("div",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n.subject})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"내용"}),r.jsx("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:n.content})]})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[r.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"\uD83D\uDCAC 대화 내역 (거래처 공유)"}),r.jsx("div",{className:"space-y-4 mb-4 max-h-[500px] overflow-y-auto",children:n.replies&&n.replies.length>0?n.replies.map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[r.jsx("div",{children:r.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.createdBy.name})}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.createdAt).toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),r.jsx("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:e.content})]},e.id)):r.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"아직 답변이 없습니다"})}),!L&&n.isShared&&(0,r.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[r.jsx("textarea",{value:f,onChange:e=>N(e.target.value),placeholder:"답변을 입력하세요...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),r.jsx("div",{className:"flex justify-end mt-2",children:(0,r.jsxs)(l.Z,{onClick:I,disabled:S,children:[r.jsx(h,{className:"w-4 h-4 mr-2"}),S?"전송 중...":"답변 전송"]})})]}),!L&&!n.isShared&&r.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-700 rounded-lg p-4 text-center",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"내부 전용 커뮤니케이션은 거래처 공유 답변을 전송할 수 없습니다."}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"공유 범위를 '고객사 공유'로 변경하면 답변을 전송할 수 있습니다."})]})})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[r.jsx(g,{className:"w-5 h-5"}),"내부 메모 (비공개)"]}),r.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded p-2 mb-4",children:r.jsx("p",{className:"text-xs text-yellow-800 dark:text-yellow-300",children:"우리 조직 내부에서만 공유되며, 거래처에는 노출되지 않습니다."})}),r.jsx("div",{className:"space-y-3 mb-4 max-h-[500px] overflow-y-auto",children:0===n.notes.length?r.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"등록된 내부 메모가 없습니다"}):n.notes.map(e=>(0,r.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.createdBy.name}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.createdAt).toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),r.jsx("div",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:e.note})]},e.id))}),!L&&(0,r.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[r.jsx("textarea",{value:C,onChange:e=>D(e.target.value),placeholder:"내부 메모를 입력하세요...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),r.jsx("div",{className:"flex justify-end mt-2",children:(0,r.jsxs)(l.Z,{onClick:F,disabled:P,children:[r.jsx(g,{className:"w-4 h-4 mr-2"}),P?"저장 중...":"메모 저장"]})})]})]})]}),r.jsx(y.Z,{isOpen:Z,onClose:()=>R(!1)})]}):null}},5448:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(68570).createProxy)(String.raw`C:\Users\User\boaz\frontend\src\app\communications\[id]\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,9975,6621,5736,1330],()=>a(1828));module.exports=r})();