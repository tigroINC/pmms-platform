# 메뉴별 수정 기능 현황 및 개선 계획

## 📊 현재 상태

### ✅ 수정 기능 있음

#### 1. 고객사 관리 (`/masters/customers`)
- **활성화/비활성화**: ✅ 구현됨
- **삭제**: ✅ 구현됨 (측정 기록 없을 때만)
- **수정**: ❌ 없음
- **필요한 개선**: 
  - 고객사 정보 수정 기능 추가 (이름, 주소, 업종 등)
  - 수정 모달 필요

#### 2. 배출허용기준 (`/masters/limits`)
- **저장/수정**: ✅ 구현됨 (upsert 방식)
- **삭제**: ✅ 구현됨 (모달에서)
- **조회**: ✅ 구현됨
- **상태**: 완벽

---

### ❌ 수정 기능 없음

#### 3. 굴뚝 관리 (`/masters/stacks`)
- **현재 기능**: 조회, 추가만 가능
- **필요한 기능**:
  - 굴뚝 정보 수정 (이름, 높이, 직경 등)
  - 활성화/비활성화
  - 삭제 (측정 기록 없을 때만)

#### 4. 측정항목 관리 (`/masters/items`)
- **현재 기능**: 조회, 추가만 가능
- **필요한 기능**:
  - 측정항목 정보 수정 (이름, 단위, 기준값 등)
  - 활성화/비활성화
  - 삭제 (측정 기록 없을 때만)

#### 5. 측정이력 (`/measure/history`)
- **현재 기능**: 조회, 필터링, Excel 다운로드
- **필요한 기능**:
  - 측정값 수정 (오입력 정정)
  - 측정 기록 삭제 (관리자만)
  - 수정 이력 추적

#### 6. 측정입력 (`/measure/input`)
- **현재 기능**: 신규 입력만 가능
- **필요한 기능**:
  - 입력 후 즉시 수정 가능
  - 최근 입력 내역 표시 및 수정

---

## 🎯 우선순위별 구현 계획

### 높음 (즉시 필요)
1. **고객사 수정 기능**
   - 사용 빈도 높음
   - 정보 변경 필요성 높음
   - 구현: 수정 모달 + PATCH API

2. **굴뚝 수정 기능**
   - 고객사와 연계되어 자주 사용
   - 구현: 수정 모달 + PATCH API

3. **측정이력 수정 기능**
   - 오입력 정정 필요
   - 데이터 품질 관리 필수
   - 구현: 수정 모달 + PATCH API + 이력 추적

### 중간 (필요 시)
4. **측정항목 수정 기능**
   - 변경 빈도 낮음
   - 구현: 수정 모달 + PATCH API

### 낮음 (선택적)
5. **측정입력 수정 기능**
   - 측정이력에서 수정 가능하면 충분
   - 중복 기능일 수 있음

---

## 📝 구현 방법

### 공통 패턴

#### 1. 테이블에 수정 버튼 추가
```tsx
<button
  onClick={() => handleEdit(item)}
  className="text-blue-600 hover:underline text-sm"
>
  수정
</button>
```

#### 2. 수정 모달 컴포넌트
```tsx
<EditModal
  isOpen={isEditModalOpen}
  onClose={() => setIsEditModalOpen(false)}
  item={selectedItem}
  onSuccess={() => {
    refetch();
    setIsEditModalOpen(false);
  }}
/>
```

#### 3. PATCH API 엔드포인트
```typescript
export async function PATCH(request: Request, { params }: { params: { id: string } }) {
  const body = await request.json();
  const updated = await prisma.model.update({
    where: { id: params.id },
    data: body,
  });
  return NextResponse.json({ data: updated });
}
```

#### 4. 권한 제어
- 관리자만 수정 가능
- 측정 기록이 있으면 일부 필드만 수정 가능

---

## 🔒 데이터 무결성 고려사항

### 1. 고객사 수정
- 이름 변경 시 중복 체크
- 측정 기록이 있으면 코드 변경 불가

### 2. 굴뚝 수정
- 이름 변경 시 중복 체크 (같은 고객사 내)
- 측정 기록이 있으면 고객사 변경 불가

### 3. 측정항목 수정
- 키 변경 불가 (측정 기록 참조)
- 단위 변경 시 경고 메시지

### 4. 측정이력 수정
- 수정 이력 기록 (누가, 언제, 무엇을)
- 원본 값 보존
- 수정 사유 입력 필수

---

## 🚀 다음 단계

1. 고객사 수정 기능 구현
2. 굴뚝 수정 기능 구현
3. 측정이력 수정 기능 구현
4. 측정항목 수정 기능 구현 (필요 시)
