# 전체 메뉴 구조 및 권한 체계

## 📊 현재 메뉴 구조도

```
Navbar (상단 네비게이션)
│
├─ 📊 대시보드 (/dashboard)
│   └─ 역할: SUPER_ADMIN, ORG_ADMIN, OPERATOR, CUSTOMER_ADMIN, CUSTOMER_USER
│
├─ 📝 측정 업무
│   ├─ 측정 입력 (/measure/input)
│   │   └─ 역할: SUPER_ADMIN, ORG_ADMIN, OPERATOR
│   └─ 측정 이력 (/measure/history)
│       └─ 역할: SUPER_ADMIN, ORG_ADMIN, OPERATOR, CUSTOMER_ADMIN, CUSTOMER_USER
│
├─ 👥 고객사 관리 (환경측정기업 전용)
│   ├─ 고객사 관리 (/masters/customers)
│   │   └─ 역할: SUPER_ADMIN, ORG_ADMIN, OPERATOR (읽기 전용)
│   └─ 굴뚝 관리 (/masters/stacks)
│       └─ 역할: SUPER_ADMIN, ORG_ADMIN, OPERATOR (읽기 전용)
│
├─ 📋 기준 정보
│   ├─ 측정항목 (/masters/items)
│   │   └─ 역할: SUPER_ADMIN, ORG_ADMIN, OPERATOR (읽기 전용)
│   └─ 배출허용기준 (/masters/limits)
│       └─ 역할: SUPER_ADMIN, ORG_ADMIN, OPERATOR (읽기 전용)
│
├─ 🏢 고객사 메뉴 (고객사 사용자 전용)
│   ├─ 굴뚝 관리 (/customer/stacks)
│   │   └─ 역할: SUPER_ADMIN, CUSTOMER_ADMIN
│   ├─ 환경측정기업 관리 (/customer/organizations)
│   │   └─ 역할: SUPER_ADMIN, CUSTOMER_ADMIN, CUSTOMER_USER
│   └─ 직원 관리 (/customer/staff)
│       └─ 역할: SUPER_ADMIN, CUSTOMER_ADMIN
│
├─ 👨‍💼 직원 관리 (환경측정기업)
│   └─ 직원 관리 (/org/staff)
│       └─ 역할: SUPER_ADMIN, ORG_ADMIN
│
├─ 📄 보고서 (/report) ⚠️ 메뉴 없음 (페이지만 존재)
│   └─ 역할: 미정의 (추가 필요)
│
└─ ⚙️ 시스템 관리 (드롭다운)
    └─ 역할: SUPER_ADMIN
    ├─ 환경측정기업 관리 (/admin/organizations)
    ├─ 사용자 관리 (/admin/users)
    ├─ 역할 관리 (/org/settings/roles)
    └─ 권한 관리 (/org/settings/users)
```

---

## 🔍 기능별 역할 및 중복 분석

### 1. 고객사 관리 (중복 ❌)
| 메뉴 | 경로 | 대상 | 역할 |
|------|------|------|------|
| 고객사 관리 | `/masters/customers` | 환경측정기업 | 모든 고객사 관리 |
| 환경측정기업 관리 | `/customer/organizations` | 고객사 | 연결된 환경측정기업 조회 |

**중복 없음**: 관점이 다름 (공급자 vs 고객)

---

### 2. 굴뚝 관리 (중복 ⚠️)
| 메뉴 | 경로 | 대상 | 역할 |
|------|------|------|------|
| 굴뚝 관리 | `/masters/stacks` | 환경측정기업 | 모든 고객사의 굴뚝 관리 |
| 굴뚝 관리 | `/customer/stacks` | 고객사 | 자사 굴뚝만 관리 |

**중복**: 이름 동일, 기능 유사
**해결**: 메뉴명 변경 제안
- `/masters/stacks` → "전체 굴뚝 관리"
- `/customer/stacks` → "우리 굴뚝 관리"

---

### 3. 직원 관리 (중복 ⚠️)
| 메뉴 | 경로 | 대상 | 역할 |
|------|------|------|------|
| 직원 관리 | `/org/staff` | 환경측정기업 | 자사 직원 관리 |
| 직원 관리 | `/customer/staff` | 고객사 | 자사 직원 관리 |

**중복**: 이름 동일, 기능 동일
**해결**: 메뉴명 변경 제안
- `/org/staff` → "우리 직원 관리"
- `/customer/staff` → "우리 직원 관리"
- 역할에 따라 자동으로 다른 페이지 표시

---

### 4. 사용자 관리 vs 직원 관리 vs 권한 관리 (중복 ⚠️⚠️⚠️)
| 메뉴 | 경로 | 대상 | 역할 |
|------|------|------|------|
| 사용자 관리 | `/admin/users` | SUPER_ADMIN | 전체 시스템 사용자 관리 |
| 직원 관리 | `/org/staff` | ORG_ADMIN | 자사 직원 관리 |
| 권한 관리 | `/org/settings/users` | SUPER_ADMIN | 사용자별 권한 설정 |

**중복**: 기능 혼재
**문제점**:
- `/admin/users`: 전체 사용자 CRUD
- `/org/staff`: 조직 내 직원 CRUD
- `/org/settings/users`: 권한/역할 할당

**해결 제안**:
1. `/admin/users` → "전체 사용자 관리" (시스템 관리자)
2. `/org/staff` → "직원 관리" (조직 관리자)
3. `/org/settings/users` → "권한 설정" (명확한 구분)

---

### 5. 역할 관리 (중복 ❌)
| 메뉴 | 경로 | 대상 | 역할 |
|------|------|------|------|
| 역할 관리 | `/org/settings/roles` | SUPER_ADMIN | 커스텀 역할 생성/관리 |

**중복 없음**: 단일 기능

---

### 6. 보고서 (메뉴 없음 ⚠️)
| 메뉴 | 경로 | 대상 | 역할 |
|------|------|------|------|
| 보고서 | `/report` | 미정의 | 측정 결과 보고서 출력 |

**문제**: 페이지는 있지만 Navbar에 메뉴 없음
**해결**: Navbar에 추가 필요

---

### 7. 설정 (부분적 존재)
| 메뉴 | 경로 | 대상 | 역할 |
|------|------|------|------|
| 역할 관리 | `/org/settings/roles` | SUPER_ADMIN | 역할 설정 |
| 권한 관리 | `/org/settings/users` | SUPER_ADMIN | 권한 설정 |
| 조직 설정 | `/org/settings` | 미구현 | 조직 정보 설정 |

**문제**: `/org/settings` 메인 페이지 없음
**해결**: 조직 설정 페이지 개발 또는 리다이렉트

---

## 🎯 권한 코드 정리

### 고객사 관리
```
customer.tab.all          - 전체탭 보기
customer.tab.internal     - 내부탭 보기
customer.tab.connected    - 연결탭 보기
customer.tab.search       - 검색탭 보기
customer.view             - 고객사 조회
customer.create           - 고객사 등록
customer.update           - 고객사 수정
customer.delete           - 고객사 삭제
customer.activate         - 활성화/비활성화
customer.search           - 검색 기능
customer.filter           - 필터 기능
customer.bulk_upload      - 일괄업로드
customer.export           - Excel 내보내기
customer.invite           - 고객사 초대
```

### 굴뚝 관리
```
stack.view                - 굴뚝 조회
stack.create              - 굴뚝 등록
stack.update              - 굴뚝 수정
stack.delete              - 굴뚝 삭제
```

### 측정 데이터
```
measurement.view          - 측정 데이터 조회
measurement.create        - 측정 데이터 입력
measurement.update        - 측정 데이터 수정
measurement.delete        - 측정 데이터 삭제
measurement.export        - 측정 데이터 내보내기
```

### 사용자 관리
```
user.view                 - 사용자 조회
user.create               - 사용자 등록
user.update               - 사용자 수정
user.delete               - 사용자 삭제
user.role                 - 역할 관리 (중복? role.* 와 통합 검토)
```

### 역할 관리
```
role.view                 - 역할 조회
role.create               - 역할 생성
role.update               - 역할 수정
role.delete               - 역할 삭제
```

### 보고서
```
report.view               - 보고서 조회
report.create             - 보고서 생성
report.update             - 보고서 수정
report.delete             - 보고서 삭제
```

### 설정
```
settings.view             - 설정 조회
settings.update           - 설정 변경
```

---

## ⚠️ 발견된 문제점

### 1. 메뉴명 중복
- "굴뚝 관리" 2개 (환경측정기업용, 고객사용)
- "직원 관리" 2개 (환경측정기업용, 고객사용)

### 2. 기능 중복/혼재
- 사용자 관리 vs 직원 관리 vs 권한 관리
- 역할 관리 vs 사용자 역할 설정

### 3. 메뉴 누락
- 보고서 페이지 존재하지만 메뉴 없음

### 4. 권한 코드 불일치
- `user.role` vs `role.*` (역할 관리 권한 중복)

---

## 💡 개선 제안

### 1. 메뉴명 명확화
```
환경측정기업:
- "전체 고객사 관리" (/masters/customers)
- "전체 굴뚝 관리" (/masters/stacks)
- "직원 관리" (/org/staff)

고객사:
- "연결 환경측정기업" (/customer/organizations)
- "우리 굴뚝" (/customer/stacks)
- "직원 관리" (/customer/staff)
```

### 2. 시스템 관리 메뉴 재구성
```
시스템 관리 (SUPER_ADMIN)
├─ 환경측정기업 관리
├─ 전체 사용자 관리
├─ 역할 및 권한
│   ├─ 역할 관리
│   └─ 권한 설정
└─ 시스템 설정
```

### 3. 보고서 메뉴 추가
```
Navbar에 추가:
{ href: "/report", label: "보고서", roles: ["SUPER_ADMIN", "ORG_ADMIN", "CUSTOMER_ADMIN", "CUSTOMER_USER"] }
```

### 4. 권한 코드 통합
```
삭제: user.role
유지: role.view, role.create, role.update, role.delete
```

---

## 📋 최종 권한 목록 (중복 제거)

### CreateRoleModal.tsx 권한 정의
```typescript
// 고객사 관리 - 탭
customer.tab.all
customer.tab.internal
customer.tab.connected
customer.tab.search

// 고객사 관리 - 기본 기능
customer.view
customer.create
customer.update
customer.delete
customer.activate

// 고객사 관리 - 고급 기능
customer.search
customer.filter
customer.bulk_upload
customer.export
customer.invite

// 굴뚝 관리
stack.view
stack.create
stack.update
stack.delete

// 측정 데이터
measurement.view
measurement.create
measurement.update
measurement.delete
measurement.export

// 사용자 관리
user.view
user.create
user.update
user.delete

// 역할 관리
role.view
role.create
role.update
role.delete

// 보고서 (메뉴 추가 필요)
report.view
report.create
report.update
report.delete

// 설정 (향후 확장)
settings.view
settings.update
```
